<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14&nbsp; ExposiciÃ³n y vulnerabilidad â€“ Human-Scale Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../en/conclusion.html" rel="next">
<link href="../../en/cookbooks/la-plata.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../en/cookbooks/pergamino.html">Cookbooks</a></li><li class="breadcrumb-item"><a href="../../en/cookbooks/villa-del-rosario.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">ExposiciÃ³n y vulnerabilidad</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../public/book-logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Human-Scale Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/nlebovits/datos-escala-humana" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Geospatial Python</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/python-geospatial/fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Geoespacial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/python-geospatial/vector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Datos vectoriales</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/python-geospatial/raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datos raster</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/python-geospatial/spatial-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">AnÃ¡lisis espacial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/python-geospatial/unit_1b_solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ACP 166: Datos abiertos para ciudades resilientes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Climate Risk for Cities</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/climate-risk/fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Riesgo ClimÃ¡tico para Ciudades</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/climate-risk/exposure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">ExposiciÃ³n</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/climate-risk/vulnerability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vulnerabilidad</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/climate-risk/hazard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Peligro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/climate-risk/risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Riesgo</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Open Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/open-data/open-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Datos Abiertos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Data to Action</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/data-to-action/data-to-action.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Datos a la AcciÃ³n</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Cookbooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/cookbooks/pergamino.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pergamino</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/cookbooks/esperanza.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Esperanza</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/cookbooks/la-plata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">La Plata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/cookbooks/villa-del-rosario.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">ExposiciÃ³n y vulnerabilidad</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conclusion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../en/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p><strong>Language:</strong> <a href="../../es/index.html">ðŸ‡ªðŸ‡¸ ES</a> | <a href="../../en/index.html">ðŸ‡ºðŸ‡¸ EN</a></p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#incendios" id="toc-incendios" class="nav-link active" data-scroll-target="#incendios"><span class="header-section-number">14.1</span> Incendios</a></li>
  <li><a href="#incendios-1" id="toc-incendios-1" class="nav-link" data-scroll-target="#incendios-1"><span class="header-section-number">14.2</span> Incendios</a></li>
  <li><a href="#cobertura-del-suelo" id="toc-cobertura-del-suelo" class="nav-link" data-scroll-target="#cobertura-del-suelo"><span class="header-section-number">14.3</span> Cobertura del suelo</a></li>
  <li><a href="#loss-to-fire" id="toc-loss-to-fire" class="nav-link" data-scroll-target="#loss-to-fire"><span class="header-section-number">14.4</span> Loss to fire</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../en/cookbooks/pergamino.html">Cookbooks</a></li><li class="breadcrumb-item"><a href="../../en/cookbooks/villa-del-rosario.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">ExposiciÃ³n y vulnerabilidad</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">ExposiciÃ³n y vulnerabilidad</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="43a102fc" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterstats</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> BytesIO</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> owslib.wfs <span class="im">import</span> WebFeatureService</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geemap</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>USE_CRS <span class="op">=</span> <span class="st">"EPSG:5347"</span>  <span class="co"># posgar para esperanza</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>WEB_MERCATOR_CRS <span class="op">=</span> <span class="st">"EPSG:3857"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>DEFAULT_FIGSIZE <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>MAP_PADDING <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>PLASMA_CMAP <span class="op">=</span> plt.cm.plasma</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>ee.Initialize()</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_base_map(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span><span class="va">None</span>, bounds<span class="op">=</span><span class="va">None</span>, boundary_gdf<span class="op">=</span><span class="va">None</span>, padding_x<span class="op">=</span><span class="va">None</span>, padding_y<span class="op">=</span><span class="va">None</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create figure and set up basic map boundaries with padding."""</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> figsize <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        figsize <span class="op">=</span> DEFAULT_FIGSIZE</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> padding_x <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        padding_x <span class="op">=</span> MAP_PADDING</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> padding_y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        padding_y <span class="op">=</span> MAP_PADDING</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">is</span> <span class="va">None</span> <span class="kw">and</span> boundary_gdf <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        bounds <span class="op">=</span> boundary_gdf.total_bounds</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert bounds to Web Mercator for basemap compatibility</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a temporary GeoDataFrame with the bounds to reproject</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        temp_bounds <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            geometry<span class="op">=</span>[box(bounds[<span class="dv">0</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">3</span>])], crs<span class="op">=</span>USE_CRS</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        bounds_3857 <span class="op">=</span> temp_bounds.to_crs(WEB_MERCATOR_CRS).total_bounds</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        bounds_3857 <span class="op">=</span> bounds</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(bounds_3857[<span class="dv">0</span>] <span class="op">-</span> padding_x, bounds_3857[<span class="dv">2</span>] <span class="op">+</span> padding_x)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(bounds_3857[<span class="dv">1</span>] <span class="op">-</span> padding_y, bounds_3857[<span class="dv">3</span>] <span class="op">+</span> padding_y)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, ax</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_basemap(ax, zoom<span class="op">=</span><span class="dv">13</span>):</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add CartoDB basemap to the axes."""</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        ax,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>ctx.providers.CartoDB.PositronNoLabels,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        zoom<span class="op">=</span>zoom,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_north_arrow(ax, x<span class="op">=</span><span class="fl">0.95</span>, y<span class="op">=</span><span class="fl">0.05</span>, arrow_length<span class="op">=</span><span class="fl">0.04</span>):</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add a north arrow to the map."""</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    ax.annotate(</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">"N"</span>,</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>(x, y),</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        xytext<span class="op">=</span>(x, y <span class="op">-</span> arrow_length),</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">"black"</span>, width<span class="op">=</span><span class="dv">3</span>, headwidth<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        ha<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        va<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        xycoords<span class="op">=</span>ax.transAxes,</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_boundary_outline(ax, boundary_gdf, crs<span class="op">=</span><span class="st">"EPSG:3857"</span>):</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add the outline of a boundary geodataframe to a map."""</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    boundary_3857 <span class="op">=</span> boundary_gdf.to_crs(crs)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    boundary_3857.plot(</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_consistent_map(title, boundary_gdf, bounds<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a map with consistent styling and basemap."""</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> setup_base_map(bounds<span class="op">=</span>bounds, boundary_gdf<span class="op">=</span>boundary_gdf)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    add_basemap(ax)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    add_north_arrow(ax)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    add_boundary_outline(ax, boundary_gdf)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, ax</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> wfs_to_gdf(</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    wfs_url: <span class="bu">str</span>, layer_name: <span class="bu">str</span>, srs: <span class="bu">str</span> <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> gpd.GeoDataFrame:</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co">    Descarga una capa WFS y la devuelve como GeoDataFrame.</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="co">        wfs_url (str): URL del servicio WFS.</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co">        layer_name (str): Nombre de la capa (typename).</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="co">        srs (str): CÃ³digo EPSG del sistema de referencia de coordenadas.</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a><span class="co">        gpd.GeoDataFrame: Capa descargada como GeoDataFrame.</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    wfs <span class="op">=</span> WebFeatureService(url<span class="op">=</span>wfs_url, version<span class="op">=</span><span class="st">"2.0.0"</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> wfs.getfeature(typename<span class="op">=</span>layer_name, srsname<span class="op">=</span>srs)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gpd.read_file(BytesIO(response.read()))</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>parquet_path <span class="op">=</span> <span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/rio_segundo.parquet"</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://wms.ign.gob.ar/geoserver/ign/ows"</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(parquet_path):</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># aoi = gpd.read_parquet(parquet_path)</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    aoi <span class="op">=</span> gpd.read_file(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/coolviros/poligonal_coovilros.shp"</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    aoi <span class="op">=</span> aoi.to_crs(USE_CRS)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the union result back to a GeoDataFrame</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    unioned_geometry <span class="op">=</span> aoi.union_all()</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    aoi <span class="op">=</span> gpd.GeoDataFrame({<span class="st">'id'</span>: [<span class="st">'aoi'</span>]}, geometry<span class="op">=</span>[unioned_geometry], crs<span class="op">=</span>USE_CRS)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    dptos <span class="op">=</span> wfs_to_gdf(wfs_url<span class="op">=</span>base_url, layer_name<span class="op">=</span><span class="st">"ign:departamento"</span>, srs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    aoi <span class="op">=</span> dptos[dptos[<span class="st">"nam"</span>] <span class="op">==</span> <span class="st">"RÃ­o Segundo"</span>]</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    aoi <span class="op">=</span> aoi.to_crs(USE_CRS)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    os.makedirs(os.path.dirname(parquet_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    aoi.to_parquet(parquet_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="667b7d08" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>aoi.to_file(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/coolviros/poligonal_coovilros.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="5aa35587" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>aoi.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-4-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="villa-del-rosario_files/figure-html/cell-4-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="ececacd5" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup DuckDB and query</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> duckdb.<span class="ex">connect</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cmd <span class="kw">in</span> [</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"INSTALL spatial"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LOAD spatial"</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"INSTALL httpfs"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LOAD httpfs"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SET s3_region='us-east-2'"</span>,  <span class="co"># Note: different region for your data</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    con.execute(cmd)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>temp_file <span class="op">=</span> <span class="st">"privacion_data.parquet"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>WGS84_CRS <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> aoi.to_crs(WGS84_CRS).total_bounds</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="ss">COPY (</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="ss">    WITH privacion_data AS (</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT </span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="ss">            id_geo,</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="ss">            SUM(CASE WHEN valor_categoria IN ('2', '3', '4') THEN conteo ELSE 0 END) AS hogares_con_privacion,</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="ss">            SUM(conteo) AS total_hogares,</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="ss">            ROUND((hogares_con_privacion * 100.0) / total_hogares, 2) AS porcentaje_privacion</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM 's3://arg-fulbright-data/censo-argentino-2022/censo-2022-largo.parquet'</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="ss">        WHERE codigo_variable = 'HOGAR_IPMH'</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY id_geo</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="ss">        HAVING total_hogares &gt; 0</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="ss">    )</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT </span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="ss">        g.cod_2022,</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="ss">        g.prov,</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="ss">        g.depto, </span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="ss">        g.pob_tot_p,</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="ss">        g.geometry,</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="ss">        p.hogares_con_privacion,</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="ss">        p.total_hogares,</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="ss">        p.porcentaje_privacion</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM 's3://arg-fulbright-data/censo-argentino-2022/radios-2022.parquet' g</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN privacion_data p ON g.cod_2022 = p.id_geo</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="ss">    WHERE ST_XMax(g.geometry) &gt;= </span><span class="sc">{</span>bounds[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> </span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="ss">      AND ST_XMin(g.geometry) &lt;= </span><span class="sc">{</span>bounds[<span class="dv">2</span>]<span class="sc">}</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="ss">      AND ST_YMax(g.geometry) &gt;= </span><span class="sc">{</span>bounds[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> </span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="ss">      AND ST_YMin(g.geometry) &lt;= </span><span class="sc">{</span>bounds[<span class="dv">3</span>]<span class="sc">}</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="ss">) TO '</span><span class="sc">{</span>temp_file<span class="sc">}</span><span class="ss">' (FORMAT PARQUET);</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>con.execute(query)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet(temp_file)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"geometry"</span>] <span class="op">=</span> gpd.GeoSeries.from_wkb(df[<span class="st">"geometry"</span>])</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"4326"</span>)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.to_crs(USE_CRS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9ebbcf956acb4d559acaeace92cbd688","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="940de99e" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gdf.plot(<span class="st">"porcentaje_privacion"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-6-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="villa-del-rosario_files/figure-html/cell-6-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="a24444da" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stac.openlandmap.org/pop.count_ghs.jrc/pop.count_ghs.jrc_20210101_20211231/pop.count_ghs.jrc_20210101_20211231.json</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="66ace57c" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/GHSL/GHS_POP_GLOBE_R2023A/GHS_POP_E2025_GLOBE_R2023A_54009_100/V1-0/tiles/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R13_C13.zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="992163e3" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ghsl_ruta <span class="op">=</span> <span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/notebooks/data/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R13_C13/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R13_C13.tif"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ghsl <span class="op">=</span> rioxarray.open_rasterio(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    ghsl_ruta,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>ghsl <span class="op">=</span> ghsl.rio.reproject(dst_crs<span class="op">=</span>USE_CRS)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>ghsl_clipped <span class="op">=</span> ghsl.rio.clip(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    [aoi.geometry.iloc[<span class="dv">0</span>]],</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    from_disk<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>ghsl_masked <span class="op">=</span> ghsl_clipped.where(ghsl_clipped <span class="op">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="f76826d2" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ghsl_masked.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-10-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="villa-del-rosario_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="63ae5045" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>raster_referencia <span class="op">=</span> ghsl_clipped</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>transformacion_referencia <span class="op">=</span> raster_referencia.rio.transform()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>crs_referencia <span class="op">=</span> raster_referencia.rio.crs</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>forma_referencia <span class="op">=</span> raster_referencia.shape[<span class="dv">1</span>:]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>raster_ghsl <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>geometrias <span class="op">=</span> [geom <span class="cf">for</span> geom <span class="kw">in</span> gdf.geometry]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Use the same method for both</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace zonal_stats with rasterize-based calculation</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>raster_ghsl_full <span class="op">=</span> rasterize(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    [(geom, i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i, geom <span class="kw">in</span> <span class="bu">enumerate</span>(gdf.geometry)],</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>forma_referencia,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transformacion_referencia,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.int32</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate totals from the rasterized version</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>totales_ghsl <span class="op">=</span> []</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gdf.geometry)):</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    polygon_mask <span class="op">=</span> raster_ghsl_full <span class="op">==</span> (i <span class="op">+</span> <span class="dv">1</span>)  <span class="co"># +1 because rasterize starts at 1</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply both polygon mask AND exclude nodata values</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> polygon_mask <span class="op">&amp;</span> (raster_ghsl <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (raster_ghsl <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> np.<span class="bu">sum</span>(raster_ghsl[valid_mask]) <span class="cf">if</span> np.<span class="bu">any</span>(valid_mask) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    totales_ghsl.append(total)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">"estimacion_pob_ghsl"</span>] <span class="op">=</span> totales_ghsl</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>geometrias_ghsl <span class="op">=</span> [</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    (geom, valor)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, valor <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        gdf.geometry,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        gdf[<span class="st">"estimacion_pob_ghsl"</span>],</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>geometrias_pob <span class="op">=</span> [</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    (geom, valor)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, valor <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        gdf.geometry, gdf[<span class="st">"POB_TOT_P"</span>]</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>raster_pob_ghsl <span class="op">=</span> rasterize(</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    geometrias_ghsl,</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>forma_referencia,</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transformacion_referencia,</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>raster_pob_censo <span class="op">=</span> rasterize(</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    geometrias_pob,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>forma_referencia,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transformacion_referencia,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>mascara <span class="op">=</span> (raster_ghsl <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (raster_ghsl <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span>) <span class="op">&amp;</span> (raster_pob_ghsl <span class="op">&gt;</span> <span class="fl">0.1</span>)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>ghsl_fraccional <span class="op">=</span> np.full_like(raster_ghsl, <span class="dv">0</span>, dtype<span class="op">=</span>np.float64)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>ghsl_fraccional[mascara] <span class="op">=</span> raster_ghsl[mascara] <span class="op">/</span> raster_pob_ghsl[mascara]</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>mascara2 <span class="op">=</span> (ghsl_fraccional <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (raster_pob_censo <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>pob_redistribuida <span class="op">=</span> np.full_like(raster_ghsl, <span class="dv">0</span>, dtype<span class="op">=</span>np.float64)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>pob_redistribuida[mascara2] <span class="op">=</span> ghsl_fraccional[mascara2] <span class="op">*</span> raster_pob_censo[mascara2]</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>pob_redistribuida_da <span class="op">=</span> xr.DataArray(</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    pob_redistribuida,</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{<span class="st">"y"</span>: ghsl_clipped.y, <span class="st">"x"</span>: ghsl_clipped.x},</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>[<span class="st">"y"</span>, <span class="st">"x"</span>],</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>ghsl_clipped.attrs.copy(),</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>pob_redistribuida_da <span class="op">=</span> pob_redistribuida_da.rio.write_crs(USE_CRS)</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>pob_redistribuida_enmascarada <span class="op">=</span> pob_redistribuida_da.where(pob_redistribuida_da <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>total_redistribuido <span class="op">=</span> pob_redistribuida[pob_redistribuida <span class="op">&gt;</span> <span class="dv">0</span>].<span class="bu">sum</span>()</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>total_censo <span class="op">=</span> gdf[<span class="st">"POB_TOT_P"</span>].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="96e805db" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create poverty proportions raster at 100m resolution</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>geometrias_privacion <span class="op">=</span> [</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    (geom, valor)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, valor <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        gdf.geometry, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        gdf[<span class="st">"porcentaje_privacion"</span>] <span class="op">/</span> <span class="dv">100</span>  <span class="co"># Convert percentage to proportion</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>raster_privacion <span class="op">=</span> rasterize(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    geometrias_privacion,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>forma_referencia,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transformacion_referencia,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create population in poverty raster by multiplying redistributed population by poverty proportions</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>mascara_pob_privacion <span class="op">=</span> (pob_redistribuida <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (raster_privacion <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>pob_privacion <span class="op">=</span> np.full_like(pob_redistribuida, <span class="dv">0</span>, dtype<span class="op">=</span>np.float64)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>pob_privacion[mascara_pob_privacion] <span class="op">=</span> pob_redistribuida[mascara_pob_privacion] <span class="op">*</span> raster_privacion[mascara_pob_privacion]</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create xarray DataArray for the poverty population raster</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>pob_privacion_da <span class="op">=</span> xr.DataArray(</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    pob_privacion,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{<span class="st">"y"</span>: ghsl_clipped.y, <span class="st">"x"</span>: ghsl_clipped.x},</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>[<span class="st">"y"</span>, <span class="st">"x"</span>],</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    attrs<span class="op">=</span>ghsl_clipped.attrs.copy(),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>pob_privacion_da <span class="op">=</span> pob_privacion_da.rio.write_crs(USE_CRS)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask zero values</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>pob_privacion_enmascarada <span class="op">=</span> pob_privacion_da.where(pob_privacion_da <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total population in poverty</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>total_pob_privacion <span class="op">=</span> pob_privacion[pob_privacion <span class="op">&gt;</span> <span class="dv">0</span>].<span class="bu">sum</span>()</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total population in poverty: </span><span class="sc">{</span>total_pob_privacion<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of redistributed population in poverty: </span><span class="sc">{</span>(total_pob_privacion<span class="op">/</span>total_redistribuido)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Total population in poverty: 5,597
Percentage of redistributed population in poverty: 28.3%</code></pre>
</div>
</div>
<div id="8ee1b8e5" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of poverty population values</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pob_privacion_values <span class="op">=</span> pob_privacion[pob_privacion <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.hist(pob_privacion_values, bins<span class="op">=</span><span class="dv">50</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Population in Poverty per 100m pixel'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Population in Poverty at 100m Resolution'</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-13-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="villa-del-rosario_files/figure-html/cell-13-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="668582c4" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pob_privacion_da.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-14-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="villa-del-rosario_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="8be03d09" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Map of population in poverty at 100m resolution</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> create_consistent_map(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PoblaciÃ³n en PrivaciÃ³n a 100m"</span>, aoi</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>pob_privacion_3857 <span class="op">=</span> pob_privacion_enmascarada.rio.reproject(WEB_MERCATOR_CRS)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>pob_privacion_3857 <span class="op">=</span> pob_privacion_3857.where(pob_privacion_3857 <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>pob_privacion_3857.plot(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, cmap<span class="op">=</span>PLASMA_CMAP, alpha<span class="op">=</span><span class="fl">0.75</span>, add_colorbar<span class="op">=</span><span class="va">False</span>, add_labels<span class="op">=</span><span class="va">False</span>, zorder<span class="op">=</span><span class="dv">2</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PoblaciÃ³n en PrivaciÃ³n a 100m"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-15-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="villa-del-rosario_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<section id="incendios" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="incendios"><span class="header-section-number">14.1</span> Incendios</h2>
<div id="bf78f68a" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create lists of all available years</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>modis_years <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2000</span>, <span class="dv">2021</span>))  <span class="co"># 2000-2020</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>viirs_years <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2012</span>, <span class="dv">2022</span>))  <span class="co"># 2012-2021</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create FeatureCollection for a specific year and dataset</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_fire_collection(dataset, year):</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a FeatureCollection for a specific dataset and year"""</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dataset <span class="op">==</span> <span class="st">'modis'</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> <span class="ss">f"projects/sat-io/open-datasets/MODIS_MCD14DL/MCD14DL_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> dataset <span class="op">==</span> <span class="st">'viirs'</span>:</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> <span class="ss">f"projects/sat-io/open-datasets/VIIRS/VNP14IMGTDL_NRT_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Dataset must be 'modis' or 'viirs'"</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ee.FeatureCollection(path)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: Could not load </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss"> data for year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all MODIS data (2000-2020)</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading MODIS data (2000-2020)..."</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>modis_collections <span class="op">=</span> []</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> modis_years:</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    collection <span class="op">=</span> create_fire_collection(<span class="st">'modis'</span>, year)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> collection <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        modis_collections.append(collection)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all VIIRS data (2012-2021)</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading VIIRS data (2012-2021)..."</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>viirs_collections <span class="op">=</span> []</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> viirs_years:</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    collection <span class="op">=</span> create_fire_collection(<span class="st">'viirs'</span>, year)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> collection <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        viirs_collections.append(collection)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all collections into single FeatureCollections</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Combining all years..."</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>all_modis <span class="op">=</span> ee.FeatureCollection(modis_collections).flatten()</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>all_viirs <span class="op">=</span> ee.FeatureCollection(viirs_collections).flatten()</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by area of interest</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>ee_aoi <span class="op">=</span> geemap.geopandas_to_ee(aoi)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtering by area of interest..."</span>)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>all_modis_aoi <span class="op">=</span> all_modis.filterBounds(ee_aoi)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>all_viirs_aoi <span class="op">=</span> all_viirs.filterBounds(ee_aoi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading MODIS data (2000-2020)...
Loading VIIRS data (2012-2021)...
Combining all years...
Filtering by area of interest...</code></pre>
</div>
</div>
<div id="afb3dc3a" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a color from a day or night</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>class_color <span class="op">=</span> ee.Dictionary({</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'D'</span>: <span class="st">'0565A6'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'N'</span>: <span class="st">'229A00'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> [<span class="st">'D'</span>, <span class="st">'N'</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_style(pt):</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add styling properties to each point based on brightness and day/night"""</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    size <span class="op">=</span> ee.Number(pt.get(<span class="st">'bright_ti4'</span>)).divide(<span class="dv">100</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> class_color.get(pt.get(<span class="st">'daynight'</span>))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pt.<span class="bu">set</span>(<span class="st">'styleProperty'</span>, ee.Dictionary({<span class="st">'pointSize'</span>: size, <span class="st">'color'</span>: color}))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Style both MODIS and VIIRS data</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>modis_styled <span class="op">=</span> all_modis_aoi.<span class="bu">map</span>(add_style)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>viirs_styled <span class="op">=</span> all_viirs_aoi.<span class="bu">map</span>(add_style)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day and night fire layers for MODIS</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>modis_daytime <span class="op">=</span> modis_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'D'</span>)).style(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    styleProperty<span class="op">=</span><span class="st">'styleProperty'</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    neighborhood<span class="op">=</span><span class="dv">50</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>modis_nighttime <span class="op">=</span> modis_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'N'</span>)).style(</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    styleProperty<span class="op">=</span><span class="st">'styleProperty'</span>, </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    neighborhood<span class="op">=</span><span class="dv">50</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day and night fire layers for VIIRS</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>viirs_daytime <span class="op">=</span> viirs_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'D'</span>)).style(</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    styleProperty<span class="op">=</span><span class="st">'styleProperty'</span>,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    neighborhood<span class="op">=</span><span class="dv">50</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>viirs_nighttime <span class="op">=</span> viirs_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'N'</span>)).style(</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    styleProperty<span class="op">=</span><span class="st">'styleProperty'</span>, </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    neighborhood<span class="op">=</span><span class="dv">50</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="9d2fca59" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> geemap.Map()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add all fire layers</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>m.addLayer(modis_daytime, {}, <span class="st">'MODIS Daytime Fires'</span>, <span class="va">True</span>, <span class="fl">0.65</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>m.addLayer(modis_nighttime, {}, <span class="st">'MODIS Nighttime Fires'</span>, <span class="va">True</span>, <span class="fl">0.65</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>m.addLayer(viirs_daytime, {}, <span class="st">'VIIRS Daytime Fires'</span>, <span class="va">True</span>, <span class="fl">0.65</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>m.addLayer(viirs_nighttime, {}, <span class="st">'VIIRS Nighttime Fires'</span>, <span class="va">True</span>, <span class="fl">0.65</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"030109cd1e9f44fcb737fa851fa5e06d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="dab083d9" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load GABAM dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gabam <span class="op">=</span> ee.ImageCollection(<span class="st">"projects/sat-io/open-datasets/GABAM"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by area of interest and date</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>gabam_aoi <span class="op">=</span> gabam.filterBounds(ee_aoi)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>gabam_aoi <span class="op">=</span> gabam_aoi.filterDate(<span class="st">'2005-01-01'</span>,<span class="st">'2021-12-31'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: Select only the burn band, not all properties</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># GABAM has a single band 'b1' with values 0 or 1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>burn_count <span class="op">=</span> gabam_aoi.select(<span class="st">'b1'</span>).<span class="bu">sum</span>()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip to AOI</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>burn_count_clipped <span class="op">=</span> burn_count.clip(ee_aoi)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now check the actual burn count statistics</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> burn_count_clipped.reduceRegion(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    reducer<span class="op">=</span>ee.Reducer.minMax().combine(ee.Reducer.mean(), sharedInputs<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>ee_aoi,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    maxPixels<span class="op">=</span><span class="fl">1e9</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Actual burn count statistics:"</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min: </span><span class="sc">{</span>stats<span class="sc">.</span>get(<span class="st">'b1_min'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max: </span><span class="sc">{</span>stats<span class="sc">.</span>get(<span class="st">'b1_max'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean: </span><span class="sc">{</span>stats<span class="sc">.</span>get(<span class="st">'b1_mean'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geometry from the FeatureCollection</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>ee_aoi_geometry <span class="op">=</span> ee_aoi.geometry()</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Then use it in the export</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    burn_count_clipped, </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/gabam_2005_2021_30m.tif"</span>, </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">30</span>, </span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>ee_aoi_geometry</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to the existing map</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>m.addLayer(</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    burn_count_clipped, </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="dv">1</span>, </span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="dv">5</span>,  <span class="co"># Adjust max based on your data range</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">'palette'</span>: [<span class="st">'white'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>, <span class="st">'darkred'</span>, <span class="st">'purple'</span>, <span class="st">'black'</span>]</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GABAM Burn Count (Cumulative)'</span>, </span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">True</span>, </span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.7</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Actual burn count statistics:
Min: 1
Max: 4
Mean: 1.0688405672193306
Generating URL ...
Downloading data from https://earthengine.googleapis.com/v1/projects/grand-magpie-459819-i5/thumbnails/65c3fa7ede783bc0dd9b85572131c50b-3da7a5c1388bd688b01170030cbc563f:getPixels
Please wait ...
Data downloaded to /home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/gabam_2005_2021_30m.tif</code></pre>
</div>
</div>
<div id="f6cb0f1c" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load separate ESA collections</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading ESA AVHRR-LTDR burned area and confidence level..."</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ba_collection <span class="op">=</span> ee.ImageCollection(<span class="st">"projects/sat-io/open-datasets/ESA/AVHRR-LTDR/BA"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>cl_collection <span class="op">=</span> ee.ImageCollection(<span class="st">"projects/sat-io/open-datasets/ESA/AVHRR-LTDR/CL"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by AOI</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>ba_aoi <span class="op">=</span> ba_collection.filterBounds(ee_aoi_geometry)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>cl_aoi <span class="op">=</span> cl_collection.filterBounds(ee_aoi_geometry)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create binary mask based on confidence level &gt; 50 AND burned area &gt; 0</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Creating binary burn masks with confidence &gt; 50..."</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to filter by confidence and burned area</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_confident_burn_mask(img):</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the corresponding CL image for the same date</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> img.date()</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    cl_img <span class="op">=</span> cl_aoi.filterDate(date).first()</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create mask: BA &gt; 0 AND CL &gt; 50</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    burn_mask <span class="op">=</span> img.select(<span class="st">'b1'</span>).gt(<span class="dv">0</span>)  <span class="co"># BA &gt; 0</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    conf_mask <span class="op">=</span> cl_img.select(<span class="st">'b1'</span>).gt(<span class="dv">0</span>)  <span class="co"># CL &gt; 50</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine both conditions</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> burn_mask.And(conf_mask).rename(<span class="st">'burned'</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to create confident burn masks</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>binary_burns <span class="op">=</span> ba_aoi.<span class="bu">map</span>(create_confident_burn_mask)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum the binary masks to get burn frequency</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>burn_frequency <span class="op">=</span> binary_burns.<span class="bu">sum</span>().clip(ee_aoi_geometry)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Get stats</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>freq_stats <span class="op">=</span> burn_frequency.reduceRegion(</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    reducer<span class="op">=</span>ee.Reducer.minMax().combine(ee.Reducer.mean(), sharedInputs<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>ee_aoi_geometry,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    maxPixels<span class="op">=</span><span class="fl">1e9</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Burn frequency (times burned with confidence &gt; 50):"</span>)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min: </span><span class="sc">{</span>freq_stats<span class="sc">.</span>get(<span class="st">'burned_min'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max: </span><span class="sc">{</span>freq_stats<span class="sc">.</span>get(<span class="st">'burned_max'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean: </span><span class="sc">{</span>freq_stats<span class="sc">.</span>get(<span class="st">'burned_mean'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to map</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>m.addLayer(</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    burn_frequency.updateMask(burn_frequency.gte(<span class="dv">0</span>)), </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="dv">0</span>, </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="dv">12</span>,  <span class="co"># Adjust based on your stats</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'palette'</span>: [<span class="st">'white'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>, <span class="st">'darkred'</span>, <span class="st">'purple'</span>, <span class="st">'black'</span>]</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ESA Burn Frequency (Confidence &gt; 50)'</span>, </span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    <span class="va">True</span>, </span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.7</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading ESA AVHRR-LTDR burned area and confidence level...
Creating binary burn masks with confidence &gt; 50...
Burn frequency (times burned with confidence &gt; 50):
Min: 0
Max: 6
Mean: 2.1728753843046604</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"030109cd1e9f44fcb737fa851fa5e06d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="4e91c620" class="cell" data-execution_count="70">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load separate ESA collections</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading ESA AVHRR-LTDR burned area and confidence level..."</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ba_collection <span class="op">=</span> ee.ImageCollection(<span class="st">"projects/sat-io/open-datasets/ESA/AVHRR-LTDR/BA"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>cl_collection <span class="op">=</span> ee.ImageCollection(<span class="st">"projects/sat-io/open-datasets/ESA/AVHRR-LTDR/CL"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by AOI and date range (2000-2021)</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ba_aoi <span class="op">=</span> ba_collection.filterBounds(ee_aoi_geometry).filterDate(<span class="st">'2000-01-01'</span>, <span class="st">'2021-12-31'</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>cl_aoi <span class="op">=</span> cl_collection.filterBounds(ee_aoi_geometry).filterDate(<span class="st">'2000-01-01'</span>, <span class="st">'2021-12-31'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create function to filter burned area by confidence level &gt; 50</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_by_confidence(img):</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the corresponding CL image for the same date</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> img.date()</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    cl_img <span class="op">=</span> cl_aoi.filterDate(date).first()</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create confidence mask: CL &gt; 50</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    conf_mask <span class="op">=</span> cl_img.select(<span class="st">'b1'</span>).gt(<span class="dv">0</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply confidence mask to burned area</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> img.select(<span class="st">'b1'</span>).updateMask(conf_mask).rename(<span class="st">'burned_area'</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply confidence filtering and sum total burned area over time</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>total_burned_area <span class="op">=</span> ba_aoi.<span class="bu">map</span>(filter_by_confidence).<span class="bu">sum</span>().clip(ee_aoi_geometry)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Get stats</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>area_stats <span class="op">=</span> total_burned_area.reduceRegion(</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    reducer<span class="op">=</span>ee.Reducer.minMax().combine(ee.Reducer.mean(), sharedInputs<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>ee_aoi_geometry,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">250</span>,  <span class="co"># Use 250m scale to match the dataset resolution</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    maxPixels<span class="op">=</span><span class="fl">1e9</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total burned area (square meters, 2000-2021):"</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min: </span><span class="sc">{</span>area_stats<span class="sc">.</span>get(<span class="st">'burned_area_min'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max: </span><span class="sc">{</span>area_stats<span class="sc">.</span>get(<span class="st">'burned_area_max'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean: </span><span class="sc">{</span>area_stats<span class="sc">.</span>get(<span class="st">'burned_area_mean'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to map</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>m.addLayer(</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    total_burned_area.updateMask(total_burned_area.gt(<span class="dv">0</span>)), </span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="dv">0</span>, </span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="dv">1000000</span>,  <span class="co"># Adjust based on your stats (square meters)</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'palette'</span>: [<span class="st">'white'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>, <span class="st">'darkred'</span>, <span class="st">'purple'</span>, <span class="st">'black'</span>]</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Total Burned Area (Confidence &gt; 50, 2000-2021)'</span>, </span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    <span class="va">True</span>, </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.7</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading ESA AVHRR-LTDR burned area and confidence level...
Total burned area (square meters, 2000-2021):
Min: 0
Max: 2636580.25
Mean: 760765.8292555296</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="70">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"030109cd1e9f44fcb737fa851fa5e06d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="f51a7a8a" class="cell" data-execution_count="71">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Then use it in the export</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    total_burned_area, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/avhrr_ltdr_burned_area_1km_2000_2021.tif"</span>, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>ee_aoi_geometry</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating URL ...
Downloading data from https://earthengine.googleapis.com/v1/projects/grand-magpie-459819-i5/thumbnails/a64b971daa331c7f2cb3221bce589b57-b2485e1bc6e02b95c2e41479883434f7:getPixels
Please wait ...
Data downloaded to /home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/avhrr_ltdr_burned_area_1km_2000_2021.tif</code></pre>
</div>
</div>
<div id="b236be89" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any, Dict</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># STAC API root URL</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"https://cds.climate.copernicus.eu/api/catalogue/v1/"</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> Client.<span class="bu">open</span>(URL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="9e278704" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom headers</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> []</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cat <span class="op">=</span> Client.<span class="bu">open</span>(URL, headers<span class="op">=</span>headers)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>cat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="54">


<style>
.pystac-summary {
    cursor: pointer;
    display: list-item;
    list-style: revert;
    margin-bottom: 0 !important;

    .pystac-l {
        padding-left: 0.5em;
        color: rgb(64, 128, 128);
        font-style: italic;
    }
}
.pystac-row {
    overflow-wrap: break-word;
    padding-left: .825em;

    .pystac-k {
        display: inline-block;
        margin: 0px 0.5em 0px 0px;
    }
    .pystac-v {
        color: rgb(186, 33, 33);
    }
}
.pystac-k {
    color: rgb(0, 128, 0);
    font-weight: 700;
}
</style>
<div class="jp-RenderedJSON jp-mod-trusted jp-OutputArea-output">
    <div class="container" style="line-height: normal;">
        <ul style="padding: 0px; margin: 0px; list-style: none; display: block;">
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"Catalog"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">id</span>
            <span class="pystac-v">"cds-stac-api"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">stac_version</span>
            <span class="pystac-v">"1.1.0"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">description</span>
            <span class="pystac-v">"A STAC (https://stacspec.org/) compliant API to access ECMWF Data Stores catalogues."</span>
        </li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">links</span><span class="pystac-l">[] 130 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">0</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"self"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">1</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"root"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ECMWF Data Stores STAC Catalogue API"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">2</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"data"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">3</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"conformance"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/conformance"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"STAC/WFS3 conformance classes implemented by this server"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">4</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-land-timeseries"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 Land hourly time-series data from 1950 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">5</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 hourly data on pressure levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">6</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-era5-land-daily-statistics"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5-Land post-processed daily statistics from 1950 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">7</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 hourly data on single levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">8</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-era5-pressure-levels-daily-statistics"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 post-processed daily statistics on pressure levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">9</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-land"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5-Land hourly data from 1950 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">10</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-era5-single-levels-daily-statistics"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 post-processed daily statistics on single levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">11</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-utci-historical"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Thermal comfort indices derived from ERA5 reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">12</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-surface-land"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global land surface atmospheric variables from 1755 to present from comprehensive in-situ observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">13</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-agrometeorological-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Agrometeorological indicators from 1979 to present derived from reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">14</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-sea-ice-edge-type"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sea ice edge and type daily gridded data from 1978 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">15</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-sea-ice-concentration"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sea ice concentration daily gridded data from 1978 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">16</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-carra-height-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Arctic regional reanalysis on height levels from 1991 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">17</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-carra-model-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Arctic regional reanalysis on model levels from 1991 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">18</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-carra-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Arctic regional reanalysis on pressure levels from 1991 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">19</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-sea-ice-thickness"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sea ice thickness gridded data for the Arctic derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">20</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-carra-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Arctic regional reanalysis on single levels from 1991 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">21</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-monthly-ocean"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast monthly averages of ocean variables"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">22</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-pressure-levels-monthly-means"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 monthly averaged data on pressure levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">23</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-cerra-height-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CERRA sub-daily regional reanalysis data for Europe on height levels from 1984 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">24</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-cerra-model-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CERRA sub-daily regional reanalysis data for Europe on model levels from 1984 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">25</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-cerra-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CERRA sub-daily regional reanalysis data for Europe on pressure levels from 1984 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">26</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-single-levels-monthly-means"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 monthly averaged data on single levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">27</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-land-monthly-means"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5-Land monthly averaged data from 1950 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">28</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-monthly-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast monthly statistics on single levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">29</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-postprocessed-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast anomalies on single levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">30</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-original-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast daily and subdaily data on single levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">31</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-original-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast subdaily data on pressure levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">32</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/ecv-for-climate-change"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Essential climate variables for assessment of climate variability from 1979 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">33</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-monthly-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast monthly statistics on pressure levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">34</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/seasonal-postprocessed-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast anomalies on pressure levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">35</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-cerra-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CERRA sub-daily regional reanalysis data for Europe on single levels from 1984 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">36</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-sea-level-global"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sea level gridded data from satellite observations for the global ocean from 1993 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">37</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-soil-moisture"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Soil moisture gridded data from 1978 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">38</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cmip6"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CMIP6 climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">39</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-gridded-observations-nordic"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Nordic gridded temperature and precipitation data from 1961 to present derived from in-situ observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">40</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-european-wind-storm-reanalysis"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Windstorm tracks and footprints derived from reanalysis over Europe between 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">41</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-aerosol-properties"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Aerosol properties gridded data from 1995 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">42</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-oras5"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ORAS5 global ocean reanalysis monthly data from 1958 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">43</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-energy-derived-reanalysis"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Climate and energy indicators for Europe from 1979 to present derived from reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">44</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-greenland-ice-sheet-velocity"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Ice sheet velocity for Antarctica and Greenland derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">45</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-hydrology-variables-derived-seasonal-forecast"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Multi-model seasonal forecasts of river discharge for Europe from January 2021 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">46</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-ozone-v1"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Ozone monthly gridded data from 1970 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">47</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-earth-radiation-budget"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Earth's radiation budget from 1979 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">48</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-humidity-profiles"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Tropospheric humidity profiles averaged monthly and zonally from 2006 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">49</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-water-level-change-timeseries-cmip6"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global sea level change time series from 1950 to 2050 derived from reanalysis and high resolution CMIP6 climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">50</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-woudc-ozone-total-column-and-profiles"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"In situ total column ozone and ozone soundings from 1924 to present from the World Ozone and Ultraviolet Radiation Data Centre"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">51</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-near-surface-temperature-us-climate-reference-network"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"In situ observations of meteorological and soil variables from the US Climate Reference Network near the surface from 2006 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">52</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-carra-means"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Arctic regional reanalysis daily and monthly data from 1991 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">53</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-gnss"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"In-situ observations of water vapour and atmospheric delay from the ground-based GNSS network from 1996 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">54</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-lake-water-level"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Lake water levels from 1992 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">55</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-gruan-reference-network"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"In situ temperature, relative humidity and wind profiles from 2006 to March 2020 from the GRUAN reference network"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">56</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-igra-baseline-network"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"In situ observations of meteorological variables from the Integrated Global Radiosounding Archive and the Radiosounding Harmonization dataset from 1978 onward"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">57</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-cloud-properties"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Cloud properties global gridded monthly and daily data from 1979 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">58</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-burned-area"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Fire burned area from 2001 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">59</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-surface-radiation-budget"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Surface radiation budget from 1979 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">60</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-lake-water-temperature"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Lake surface water temperature from 1995 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">61</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-energy-pecd"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Climate and energy related variables from the Pan-European Climate Database derived from reanalysis and climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">62</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-total-column-water-vapour-land-ocean"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global monthly and daily high-spatial resolution of total column water vapour from 2002 to 2017 derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">63</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-precipitation"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Precipitation monthly and daily gridded data from 1979 to present derived from satellite measurements"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">64</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/multi-origin-c3s-atlas"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Gridded dataset underpinning the Copernicus Interactive Climate Atlas"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">65</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-ocean-colour"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Ocean colour daily data from 1997 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">66</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-albedo"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Surface albedo 10-daily gridded data from 1981 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">67</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-lai-fapar"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Leaf area index and fraction absorbed of photosynthetically active radiation 10-daily gridded data from 1981 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">68</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-energy-derived-projections"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Climate and energy indicators for Europe from 2005 to 2100 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">69</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-land-cover"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Land cover classification gridded maps from 1992 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">70</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-gridded-observations-global-and-regional"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Temperature and precipitation gridded data for global and regional domains derived from in-situ and satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">71</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-single-levels-timeseries"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ERA5 hourly time-series data on single levels from 1940 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">72</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-sea-surface-temperature"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sea surface temperature daily data from 1981 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">73</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-ice-sheet-elevation-change"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Ice sheet surface elevation change rate for Greenland and Antarctica from 1992 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">74</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-gridded-observations-europe"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"E-OBS daily gridded meteorological data for Europe from 1950 to present derived from in-situ observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">75</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-upper-troposphere-humidity"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Upper tropospheric humidity gridded data from 1999 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">76</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-methane"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Methane data from 2002 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">77</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-carbon-dioxide"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Carbon dioxide data from 2002 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">78</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-radiative-power"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Fire radiative power and active fire pixels from 2020 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">79</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-ocean-wave-timeseries"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Ocean surface wave time series for the European coast from 1976 to 2100 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">80</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-ecde-climate-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Climate indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">81</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-european-risk-extreme-precipitation-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Extreme precipitation risk indicators for Europe and European cities from 1950 to 2019"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">82</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-european-wind-storm-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Winter windstorm indicators for Europe from 1979 to 2021 derived from reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">83</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-biodiversity-cmip5-regional"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Downscaled bioclimatic indicators for selected regions from 1950 to 2100 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">84</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-european-wind-storm-synthetic-events"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Synthetic windstorm events for Europe from 1986 to 2011"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">85</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-extreme-indices-cmip6"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Climate extreme indices and heat stress indicators derived from CMIP6 global climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">86</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-health-vector"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Climatic suitability for the presence and seasonal activity of the Aedes albopictus mosquito for Europe derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">87</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-heat-and-cold-spells"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Heat waves and cold spells in  Europe derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">88</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-hydrology-meteorology-derived-projections"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Temperature and precipitation climate impact indicators from 1970 to 2100 derived from European climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">89</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-hydrology-variables-derived-projections"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Hydrology-related climate impact indicators from 1970 to 2100 derived from bias adjusted European climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">90</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-hydrology-variables-derived-seasonal-reforecast"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Multi-model seasonal reforecasts of river discharge for Europe"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">91</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-temperature-statistics"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Temperature statistics for Europe derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">92</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-tourism-fire-danger-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Fire danger indicators for Europe from 1970 to 2098 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">93</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-tourism-snow-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Mountain tourism meteorological and snow indicators for Europe from 1950 to 2100 derived from reanalysis and climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">94</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-water-level-change-indicators-cmip6"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global sea level change indicators from 1950 to 2050 derived from reanalysis and high resolution CMIP6 climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">95</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-agroclimatic-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Agroclimatic indicators from 1951 to 2099 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">96</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-biodiversity-cmip5-global"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global bioclimatic indicators from 1950 to 2100 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">97</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-biodiversity-era5-global"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global bioclimatic indicators from 1979 to 2018 derived from reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">98</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-biodiversity-era5-regional"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Downscaled bioclimatic indicators for selected regions from 1979 to 2018 derived from reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">99</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-marine-properties"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Marine biogeochemistry data for the Northwest European Shelf and Mediterranean Sea from 2006 up to 2100 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">100</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-ocean-wave-indicators"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Ocean surface wave indicators for the European coast from 1977 to 2100 derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">101</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/sis-ecv-cmip5-bias-corrected"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Essential climate variables for water sector applications derived from climate projections"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">102</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-observations-surface-marine"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Global marine surface meteorological variables from 1851 to 2010 from comprehensive in-situ observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">103</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-total-column-water-vapour-ocean"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Monthly and 6-hourly total column water vapour over ocean from 1988 to 2020 derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">104</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-sea-surface-temperature-ensemble-product"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sea surface temperature daily gridded data from 1981 to 2016 derived from a multi-product satellite-based ensemble"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">105</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-precipitation-microwave"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Precipitation monthly and daily gridded data from 2000 to 2017 derived from satellite microwave observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">106</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-precipitation-microwave-infrared"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Daily and monthly Global Interpolated RAinFall Estimation (GIRAFE) data derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">107</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-gridded-glacier-mass-change"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Glacier mass change gridded data from 1976 to present derived from the Fluctuations of Glaciers Database"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">108</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-ice-sheet-mass-balance"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Gravimetric mass balance data for the Antarctic and Greenland ice sheets from 2003 to 2022 derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">109</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-gridded-observations-alpine-precipitation"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Alpine gridded monthly precipitation data since 1871 derived from in-situ observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">110</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/insitu-glaciers-extent"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Glaciers distribution data from the Randolph Glacier Inventory for year 2000"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">111</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-era5-complete"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Complete ERA5 global atmospheric reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">112</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-climate-atlas"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Gridded monthly climate projection dataset underpinning the IPCC AR6 Interactive Atlas"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">113</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-cerra-land"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CERRA-Land sub-daily regional reanalysis data for Europe from 1984 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">114</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-reanalysis-energy-moisture-budget"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Mass-consistent atmospheric energy and moisture budget monthly data from 1979 to present derived from ERA5 reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">115</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cmip6-decadal-prototype"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CMIP6 predictions underpinning the C3S decadal prediction prototypes"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">116</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/derived-near-surface-meteorological-variables"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Near surface meteorological variables from 1979 to 2019 derived from bias-corrected reanalysis"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">117</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cmip5-daily-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CMIP5 daily data on single levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">118</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-uerra-europe-complete"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Complete UERRA regional reanalysis for Europe from 1961 to 2019"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">119</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cordex-domains-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CORDEX regional climate model data on single levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">120</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-uerra-europe-height-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"UERRA regional reanalysis for Europe on height levels from 1961 to 2019"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">121</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-uerra-europe-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"UERRA regional reanalysis for Europe on pressure levels from 1961 to 2019"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">122</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-uerra-europe-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"UERRA regional reanalysis for Europe on single levels from 1961 to 2019"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">123</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/reanalysis-uerra-europe-soil-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"UERRA regional reanalysis for Europe on soil levels from 1961 to 2019"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">124</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cmip5-daily-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CMIP5 daily data on pressure levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">125</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cmip5-monthly-pressure-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CMIP5 monthly data on pressure levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">126</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/projections-cmip5-monthly-single-levels"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CMIP5 monthly data on single levels"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">127</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/provider-c3s-data-rescue-without"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Data Rescue Service from the Copernicus Climate Change Service"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">128</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"service-desc"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/openapi.json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/vnd.oai.openapi+json;version=3.0"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"OpenAPI service description"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">129</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"service-doc"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/docs"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"text/html"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"OpenAPI service documentation"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">conformsTo</span><span class="pystac-l">[] 6 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"https://github.com/stac-extensions/scientific/tree/v1.0.0"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0-rc.1/collections"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">"https://github.com/ecmwf-projects/cads-catalogue-api-service/stac-extentions/cads-dataset"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">3</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0-rc.1/core"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">4</span>
            <span class="pystac-v">"https://github.com/ecmwf-projects/cads-catalogue-api-service/stac-extentions/datasets-search"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">5</span>
            <span class="pystac-v">"https://github.com/stac-extensions/timestamps/tree/v1.1.0"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ECMWF Data Stores STAC Catalogue API"</span>
        </li>
    
                
            
        </ul>
    </div>
</div>
</div>
</div>
<div id="3e6b5b34" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>collection_search <span class="op">=</span> cat.collection_search(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="st">"satellite-fire-burned-area"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="3963ab80" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> collection_search.collections():</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(result.<span class="bu">id</span>, <span class="ss">f"</span><span class="sc">{</span>collection<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span>, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="6f91beb9" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> cat.get_collection(<span class="st">"satellite-fire-burned-area"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>collection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="61">


<style>
.pystac-summary {
    cursor: pointer;
    display: list-item;
    list-style: revert;
    margin-bottom: 0 !important;

    .pystac-l {
        padding-left: 0.5em;
        color: rgb(64, 128, 128);
        font-style: italic;
    }
}
.pystac-row {
    overflow-wrap: break-word;
    padding-left: .825em;

    .pystac-k {
        display: inline-block;
        margin: 0px 0.5em 0px 0px;
    }
    .pystac-v {
        color: rgb(186, 33, 33);
    }
}
.pystac-k {
    color: rgb(0, 128, 0);
    font-weight: 700;
}
</style>
<div class="jp-RenderedJSON jp-mod-trusted jp-OutputArea-output">
    <div class="container" style="line-height: normal;">
        <ul style="padding: 0px; margin: 0px; list-style: none; display: block;">
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"Collection"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">id</span>
            <span class="pystac-v">"satellite-fire-burned-area"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">stac_version</span>
            <span class="pystac-v">"1.1.0"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">description</span>
            <span class="pystac-v">"The Burned Area products provide global information of total burned area (BA) at pixel and grid scale. The BA is identified with the date of first detection of the burned signal in the case of the pixel product, and with the total BA per grid cell in the case of the grid product. The products were obtained through the analysis of reflectance changes from medium resolution sensors (Terra MODIS, Sentinel-3 OLCI), supported by the use of MODIS thermal information. The burned area products also include information related to the land cover that has been burned, which has been extracted from the Copernicus Climate Change Service (C3S) land cover dataset, thus assuring consistency between the datasets.
The algorithms for BA retrieval were developed by the University of Alcala (Spain), and processed by Brockmann Consult GmbH (Germany).
Different product versions are available. FireCCI v5.0cds and FireCCI v5.1cds were developed as part of the Fire ECV Climate Change Initiative Project (Fire CCI) and brokered to C3S, offering the first global burned area time series at 250m spatial resolution. FireCCI v5.1cds used a more mature algorithm than the previous version. This algorithm was adapted to Sentinel-3 OLCI data to create the C3S v1.0 burned area product, extending the BA database to the present.
During July 2020, an error in some files in the version v5.1cds were identified, affecting the files of the grid product of January 2018, and the pixel and grid products of October, November and December 2019. These errors were fixed, and a new version, v5.1.1cds, was created for the whole time series, to replace version v5.1cds. The latter product has been deprecated, but it is temporally kept in the database for transparency and traceability reasons. Only version v5.1.1cds should be used.
The BA products are useful for researchers studying climate change, as they provide crucial information on burned biomass, which can be translated to greenhouse gases emissions amongst other contaminants. Burned area is also useful for land cover change studies, fire management and risk analysis."</span>
        </li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">links</span><span class="pystac-l">[] 19 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">0</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"self"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-burned-area"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">1</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"parent"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">2</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"root"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"ECMWF Data Stores STAC Catalogue API"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">3</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"qa"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/datasets/satellite-fire-burned-area?tab=quality_assurance_tab"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"text/html"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Quality assessment of the dataset"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">4</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"license"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/ec-sentinel/ec-sentinel_fa2955ff48a1d82e77fc7296d63681670ecdb9d2811a0505ae60d0683b62fa64.pdf"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Copernicus Sentinel data licence"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">5</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"license"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/modis_for_satellite-burned-area/modis_for_satellite-burned-area_f405357f982746c428a3cc743c4d5b6a65a3fdcd133e1cb46d60670c53eb1f79.pdf"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"MODIS licence"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">6</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"license"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/fire-cci_for_satellite-burned-area/fire-cci_for_satellite-burned-area_1d67ceed006da6c6e29d22ba90cc6c4bf1924508df43d6110cf5bec61aa0a956.pdf"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Fire CCI licence"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">7</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"license"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://spdx.org/licenses/CC-BY-4.0"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"CC-BY licence"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">8</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"form"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/form_9f074b7e2e4e066a66104b253886608de06fae1236483e060d308ecdab040514.json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">9</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"constraints"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/constraints_650f2557a7cbff0bc7491d644cc47a9c0413942aa47b4ee81da90d7bd96fb61b.json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">10</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"retrieve"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/retrieve/v1/processes/satellite-fire-burned-area"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">11</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"costing_api"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/retrieve/v1/processes/satellite-fire-burned-area/costing"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">12</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"layout"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/layout_03bec5634dd62115e9c582fedb9da8ffa53091a1b70a54d5113c0869d9ce5a41.json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">13</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"related"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/cems-fire-seasonal"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Seasonal forecast of fire danger indices from the Copernicus Emergency Management Service"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">14</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"related"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-radiative-power"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Fire radiative power and active fire pixels from 2020 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">15</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"related"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-albedo"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Surface albedo 10-daily gridded data from 1981 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">16</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"related"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-lai-fapar"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Leaf area index and fraction absorbed of photosynthetically active radiation 10-daily gridded data from 1981 to present"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">17</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"related"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-land-cover"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Land cover classification gridded maps from 1992 to present derived from satellite observations"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">18</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"messages"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-burned-area/messages"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"All messages related to the selected dataset"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">published</span>
            <span class="pystac-v">"2019-11-22T00:00:00Z"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">updated</span>
            <span class="pystac-v">"2025-07-21T00:00:00Z"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">sci:doi</span>
            <span class="pystac-v">"10.24381/cds.f333cf85"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">cads:disabled_reason</span>
            <span class="pystac-v">None</span>
        </li>
    
                
            
                
                    
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">cads:sanity_check</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">status</span>
            <span class="pystac-v">"unknown"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">timestamp</span>
            <span class="pystac-v">None</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Fire burned area from 2001 to present derived from satellite observations"</span>
        </li>
    
                
            
                
                    
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">extent</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">spatial</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">bbox</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">0</span><span class="pystac-l">[] 4 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">0.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">-90.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">360.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">3</span>
            <span class="pystac-v">90.0</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
            
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">temporal</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">interval</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">0</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"2001-01-01T00:00:00Z"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">"2022-04-01T00:00:00Z"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        </details></li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">license</span>
            <span class="pystac-v">"other"</span>
        </li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">keywords</span><span class="pystac-l">[] 4 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"Temporal coverage: Past"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">"Spatial coverage: Global"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">"Variable domain: Land (biosphere)"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">3</span>
            <span class="pystac-v">"Product type: Satellite observations"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">assets</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">thumbnail</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/overview_c94d258587b882647a42ad195dc9ff81010bb60af2f70c6ba4b2042044743bd8.png"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"image/jpg"</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">roles</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"thumbnail"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        </details></li>
    
                
            
        </ul>
    </div>
</div>
</div>
</div>
<div id="13599419" class="cell" data-execution_count="62">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for the specific collection</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> catalog.collection_search(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="st">"satellite-fire-burned-area"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the first matching collection</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> <span class="bu">next</span>(results.collections())</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found collection: </span><span class="sc">{</span>collection<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[62]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># Search for the specific collection</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> results = <span class="ansi-yellow-bg">catalog</span>.collection_search(
<span class="ansi-green-fg">      3</span>     q=<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">satellite-fire-burned-area</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">      4</span> )
<span class="ansi-green-fg">      6</span> <span style="font-style:italic;color:rgb(95,135,135)"># Get the first matching collection</span>
<span class="ansi-green-fg">      7</span> collection = <span style="color:rgb(0,135,0)">next</span>(results.collections())

<span class="ansi-red-fg">NameError</span>: name 'catalog' is not defined</pre>
</div>
</div>
</div>
<div id="378e2067" class="cell" data-execution_count="63">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check what links the collection has</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Collection links:"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> collection.links:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Rel: </span><span class="sc">{</span>link<span class="sc">.</span>rel<span class="sc">}</span><span class="ss">, Href: </span><span class="sc">{</span>link<span class="sc">.</span>href<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Look for item links specifically</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>item_links <span class="op">=</span> [link <span class="cf">for</span> link <span class="kw">in</span> collection.links <span class="cf">if</span> link.rel <span class="op">==</span> <span class="st">"items"</span>]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(item_links)<span class="sc">}</span><span class="ss"> item links"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Collection links:
Rel: self, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-burned-area
Rel: parent, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/
Rel: root, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/
Rel: qa, Href: https://cds.climate.copernicus.eu/datasets/satellite-fire-burned-area?tab=quality_assurance_tab
Rel: license, Href: https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/ec-sentinel/ec-sentinel_fa2955ff48a1d82e77fc7296d63681670ecdb9d2811a0505ae60d0683b62fa64.pdf
Rel: license, Href: https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/modis_for_satellite-burned-area/modis_for_satellite-burned-area_f405357f982746c428a3cc743c4d5b6a65a3fdcd133e1cb46d60670c53eb1f79.pdf
Rel: license, Href: https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/fire-cci_for_satellite-burned-area/fire-cci_for_satellite-burned-area_1d67ceed006da6c6e29d22ba90cc6c4bf1924508df43d6110cf5bec61aa0a956.pdf
Rel: license, Href: https://spdx.org/licenses/CC-BY-4.0
Rel: form, Href: https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/form_9f074b7e2e4e066a66104b253886608de06fae1236483e060d308ecdab040514.json
Rel: constraints, Href: https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/constraints_650f2557a7cbff0bc7491d644cc47a9c0413942aa47b4ee81da90d7bd96fb61b.json
Rel: retrieve, Href: https://cds.climate.copernicus.eu/api/retrieve/v1/processes/satellite-fire-burned-area
Rel: costing_api, Href: https://cds.climate.copernicus.eu/api/retrieve/v1/processes/satellite-fire-burned-area/costing
Rel: layout, Href: https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/layout_03bec5634dd62115e9c582fedb9da8ffa53091a1b70a54d5113c0869d9ce5a41.json
Rel: related, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/cems-fire-seasonal
Rel: related, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-radiative-power
Rel: related, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-albedo
Rel: related, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-lai-fapar
Rel: related, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-land-cover
Rel: messages, Href: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/satellite-fire-burned-area/messages
Found 0 item links</code></pre>
</div>
</div>
<div id="84f8443e" class="cell" data-execution_count="65">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the form definition to understand what parameters are needed</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>form_url <span class="op">=</span> <span class="st">"https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/resources/satellite-fire-burned-area/form_9f074b7e2e4e066a66104b253886608de06fae1236483e060d308ecdab040514.json"</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(form_url)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>form_data <span class="op">=</span> response.json()</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Form data structure:"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(form_data, indent<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Available parameters:"</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The parameters might be directly in the form_data or in a different structure</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'form'</span> <span class="kw">in</span> form_data:</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">=</span> form_data[<span class="st">'form'</span>].get(<span class="st">'parameters'</span>, [])</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="st">'parameters'</span> <span class="kw">in</span> form_data:</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">=</span> form_data[<span class="st">'parameters'</span>]</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">=</span> []</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> param <span class="kw">in</span> parameters:</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(param, <span class="bu">dict</span>):</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- </span><span class="sc">{</span>param<span class="sc">.</span>get(<span class="st">'name'</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>param<span class="sc">.</span>get(<span class="st">'description'</span>, <span class="st">'No description'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- </span><span class="sc">{</span>param<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Form data structure:
[
  {
    "name": "origin",
    "label": "Origin",
    "help": "Service, project or organisation in charge of the production of the data.",
    "required": true,
    "css": "todo",
    "type": "StringChoiceWidget",
    "details": {
      "values": [
        "c3s",
        "esa_cci"
      ],
      "columns": 2,
      "labels": {
        "c3s": "C3S (Copernicus Climate Change Service)",
        "esa_cci": "ESA-CCI (European Space Agency  Climate Change Initiative)"
      }
    },
    "id": "origin"
  },
  {
    "name": "sensor",
    "label": "Sensor",
    "help": null,
    "required": true,
    "css": "todo",
    "type": "StringChoiceWidget",
    "details": {
      "values": [
        "modis",
        "olci"
      ],
      "columns": 2,
      "labels": {
        "modis": "MODIS (Moderate Resolution Imaging Spectroradiometer)",
        "olci": "OLCI (Ocean and Land Colour Instrument)"
      }
    },
    "id": "sensor"
  },
  {
    "name": "variable",
    "label": "Variable",
    "help": "&lt;p&gt; The selction of individual variables from this dataset will be implemented at a later stage. &lt;/p&gt; &lt;p&gt;  &lt;strong&gt; Pixel product variables:&lt;/strong&gt; &lt;br&gt;  Day of detection&lt;br&gt; Confidence level&lt;br&gt; Land cover&lt;br&gt;\n     &lt;strong&gt;Grid product variables:&lt;/strong&gt; &lt;br&gt;   Burned area&lt;br&gt; Standard error&lt;br&gt; Fraction of burnable area&lt;br&gt; Fraction of observed area&lt;br&gt; Number of patches&lt;br&gt; Burned area in vegetation class &lt;/p&gt;",
    "required": true,
    "css": "todo",
    "type": "StringChoiceWidget",
    "details": {
      "values": [
        "grid_variables",
        "pixel_variables"
      ],
      "columns": 2,
      "labels": {
        "grid_variables": "Grid variables",
        "pixel_variables": "Pixel variables"
      }
    },
    "id": "variable"
  },
  {
    "name": "version",
    "label": "Version",
    "help": "&lt;p&gt;&lt;strong&gt;ESA-CCI product: &lt;/strong&gt; Version 5.0cds and 5.1.1cds &lt;br&gt;\n  These versions have the same information as the FireCCI50 and FireCCI51 burned area products from the Fire ECV Climate Change Initiative Project (Fire CCI), the latter being the one with the longer time series and the more mature algorithm.   The added string  'cds' is to indicate the changes in file format to comply with the Copernicus standards. These versions will no longer be updated. The most mature algorithm, and with the longest  time series, is version 5.1.1cds, based on Terra MODIS reflectance information.\n  Version 5.1.1cds replaces version 5.1cds, which has been deprecated, but kept available for transparency and traceability reasons. Version 5.1.1cds should be the selected product for download instead of 5.1cds.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;C3S product:&lt;/strong&gt; Version 1.0  &lt;br&gt;\n   Version 1.0 is the first burned area product developed especifically for the C3S Programme, and it is a continuation of the v5.1cds product, but using Sentinel-3 OLCI reflectance instead of Terra MODIS. This product partially overlaps with v5.1cds to assure an uninterrupted time series and allow for consistency assessment, starting in 2017.&lt;/p&gt;",
    "required": true,
    "css": "todo",
    "type": "StringChoiceWidget",
    "details": {
      "values": [
        "5_1_1cds",
        "1_0",
        "1_1",
        "5_0cds",
        "5_1cds"
      ],
      "columns": 2,
      "labels": {
        "5_1_1cds": "5.1.1cds",
        "1_0": "1.0 (deprecated)",
        "1_1": "1.1",
        "5_0cds": "5.0cds",
        "5_1cds": "5.1cds (deprecated)"
      }
    },
    "id": "version"
  },
  {
    "name": "region",
    "label": "Region",
    "help": null,
    "required": true,
    "css": "todo",
    "type": "StringListWidget",
    "details": {
      "values": [
        "north_america",
        "south_america",
        "europe",
        "asia",
        "africa",
        "australia"
      ],
      "columns": 3,
      "labels": {
        "north_america": "North America",
        "south_america": "South America",
        "europe": "Europe",
        "asia": "Asia",
        "africa": "Africa",
        "australia": "Australia"
      }
    },
    "id": "region"
  },
  {
    "name": "year",
    "label": "Year",
    "help": null,
    "required": true,
    "css": "todo",
    "type": "StringListWidget",
    "details": {
      "values": [
        "2001",
        "2002",
        "2003",
        "2004",
        "2005",
        "2006",
        "2007",
        "2008",
        "2009",
        "2010",
        "2011",
        "2012",
        "2013",
        "2014",
        "2015",
        "2016",
        "2017",
        "2018",
        "2019",
        "2020",
        "2021",
        "2022",
        "2023"
      ],
      "columns": 6,
      "labels": {
        "2001": "2001",
        "2002": "2002",
        "2003": "2003",
        "2004": "2004",
        "2005": "2005",
        "2006": "2006",
        "2007": "2007",
        "2008": "2008",
        "2009": "2009",
        "2010": "2010",
        "2011": "2011",
        "2012": "2012",
        "2013": "2013",
        "2014": "2014",
        "2015": "2015",
        "2016": "2016",
        "2017": "2017",
        "2018": "2018",
        "2019": "2019",
        "2020": "2020",
        "2021": "2021",
        "2022": "2022",
        "2023": "2023"
      }
    },
    "id": "year"
  },
  {
    "name": "month",
    "label": "Month",
    "help": null,
    "required": true,
    "css": "todo",
    "type": "StringListWidget",
    "details": {
      "values": [
        "01",
        "02",
        "03",
        "04",
        "05",
        "06",
        "07",
        "08",
        "09",
        "10",
        "11",
        "12"
      ],
      "columns": 6,
      "labels": {
        "01": "January",
        "02": "February",
        "03": "March",
        "04": "April",
        "05": "May",
        "06": "June",
        "07": "July",
        "08": "August",
        "09": "September",
        "10": "October",
        "11": "November",
        "12": "December"
      }
    },
    "id": "month"
  },
  {
    "name": "nominal_day",
    "label": "Nominal day",
    "help": "&lt;p&gt; For &lt;strong&gt;monthly &lt;/strong&gt; products, the value is always 01, representing the first day of the month &lt;br&gt;\n    For &lt;strong&gt;biweekly &lt;/strong&gt; products the values are 07 (middle of the first fortnight) and 22 (middle of the second fortnight). &lt;/p&gt;",
    "required": true,
    "css": "todo",
    "type": "StringListWidget",
    "details": {
      "values": [
        "01",
        "07",
        "22"
      ],
      "columns": 3,
      "labels": {
        "01": "01",
        "07": "07",
        "22": "22"
      }
    },
    "id": "nominal_day"
  },
  {
    "type": "LicenceWidget",
    "name": "licences",
    "label": "Terms of use",
    "help": null,
    "details": {
      "licences": [
        {
          "id": "cc-by",
          "revision": 1,
          "label": "CC-BY licence",
          "contents_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/cc-by/cc-byv1_2b61eb0b42e053566cb9447c1d2847a69a275c095e00fca00bad1bf5326a9432.md",
          "attachment_url": "https://spdx.org/licenses/CC-BY-4.0",
          "spdx_identifier": "CC-BY-4.0"
        },
        {
          "id": "ec-sentinel",
          "revision": 1,
          "label": "Copernicus Sentinel data licence",
          "contents_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/ec-sentinel/ec-sentinelv1_33996372dfdcdc99b1c22cbd15dbd86fec730b420d81cf3bf8a35461b50c00ef.md",
          "attachment_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/ec-sentinel/ec-sentinel_fa2955ff48a1d82e77fc7296d63681670ecdb9d2811a0505ae60d0683b62fa64.pdf",
          "spdx_identifier": null
        },
        {
          "id": "fire-cci_for_satellite-burned-area",
          "revision": 1,
          "label": "Fire CCI licence",
          "contents_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/fire-cci_for_satellite-burned-area/fire-cci_for_satellite-burned-areav1_84f2e5fb64ebcaf9edf7fccccc8ec60f322eb2b3b4ca22594ed6d7e4062f4f40.md",
          "attachment_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/fire-cci_for_satellite-burned-area/fire-cci_for_satellite-burned-area_1d67ceed006da6c6e29d22ba90cc6c4bf1924508df43d6110cf5bec61aa0a956.pdf",
          "spdx_identifier": null
        },
        {
          "id": "modis_for_satellite-burned-area",
          "revision": 1,
          "label": "MODIS licence",
          "contents_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/modis_for_satellite-burned-area/modis_for_satellite-burned-areav1_7087e888986674b24b5cf225dd592638646612001d23e28c03877ed234f0593e.md",
          "attachment_url": "https://object-store.os-api.cci2.ecmwf.int:443/cci2-prod-catalogue/licences/modis_for_satellite-burned-area/modis_for_satellite-burned-area_f405357f982746c428a3cc743c4d5b6a65a3fdcd133e1cb46d60670c53eb1f79.pdf",
          "spdx_identifier": null
        }
      ]
    }
  }
]

Available parameters:</code></pre>
</div>
</div>
<div id="8e8487b6" class="cell" data-execution_count="66">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Available parameters:"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> param <span class="kw">in</span> form_data:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(param, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">'name'</span> <span class="kw">in</span> param:</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- </span><span class="sc">{</span>param[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>param<span class="sc">.</span>get(<span class="st">'label'</span>, <span class="st">'No label'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'help'</span> <span class="kw">in</span> param <span class="kw">and</span> param[<span class="st">'help'</span>]:</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Help: </span><span class="sc">{</span>param[<span class="st">'help'</span>][:<span class="dv">100</span>]<span class="sc">}</span><span class="ss">..."</span>)  <span class="co"># First 100 chars</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'details'</span> <span class="kw">in</span> param <span class="kw">and</span> <span class="st">'values'</span> <span class="kw">in</span> param[<span class="st">'details'</span>]:</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Options: </span><span class="sc">{</span>param[<span class="st">'details'</span>][<span class="st">'values'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Available parameters:
- origin: Origin
  Help: Service, project or organisation in charge of the production of the data....
  Options: ['c3s', 'esa_cci']

- sensor: Sensor
  Options: ['modis', 'olci']

- variable: Variable
  Help: &lt;p&gt; The selction of individual variables from this dataset will be implemented at a later stage. &lt;/p...
  Options: ['grid_variables', 'pixel_variables']

- version: Version
  Help: &lt;p&gt;&lt;strong&gt;ESA-CCI product: &lt;/strong&gt; Version 5.0cds and 5.1.1cds &lt;br&gt;
  These versions have the sam...
  Options: ['5_1_1cds', '1_0', '1_1', '5_0cds', '5_1cds']

- region: Region
  Options: ['north_america', 'south_america', 'europe', 'asia', 'africa', 'australia']

- year: Year
  Options: ['2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023']

- month: Month
  Options: ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12']

- nominal_day: Nominal day
  Help: &lt;p&gt; For &lt;strong&gt;monthly &lt;/strong&gt; products, the value is always 01, representing the first day of th...
  Options: ['01', '07', '22']

- licences: Terms of use
</code></pre>
</div>
</div>
<div id="525e69d9" class="cell" data-execution_count="67">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CDS API endpoint for data requests</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>retrieve_url <span class="op">=</span> <span class="st">"https://cds.climate.copernicus.eu/api/retrieve/v1/processes/satellite-fire-burned-area"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Request parameters for South America, all years, all months</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>request_data <span class="op">=</span> {</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"origin"</span>: <span class="st">"esa_cci"</span>,  <span class="co"># ESA-CCI has longer time series</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sensor"</span>: <span class="st">"modis"</span>,    <span class="co"># MODIS has longer time series than OLCI</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"variable"</span>: <span class="st">"grid_variables"</span>,  <span class="co"># Grid variables include burned area</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"version"</span>: <span class="st">"5_1_1cds"</span>,  <span class="co"># Most mature version</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>: <span class="st">"south_america"</span>,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year"</span>: [<span class="st">"2001"</span>, <span class="st">"2002"</span>, <span class="st">"2003"</span>, <span class="st">"2004"</span>, <span class="st">"2005"</span>, <span class="st">"2006"</span>, <span class="st">"2007"</span>, <span class="st">"2008"</span>, <span class="st">"2009"</span>, <span class="st">"2010"</span>, <span class="st">"2011"</span>, <span class="st">"2012"</span>, <span class="st">"2013"</span>, <span class="st">"2014"</span>, <span class="st">"2015"</span>, <span class="st">"2016"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>],</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"month"</span>: [<span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"03"</span>, <span class="st">"04"</span>, <span class="st">"05"</span>, <span class="st">"06"</span>, <span class="st">"07"</span>, <span class="st">"08"</span>, <span class="st">"09"</span>, <span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"12"</span>],</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nominal_day"</span>: <span class="st">"01"</span>,  <span class="co"># Monthly products</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"licences"</span>: [<span class="st">"cc-by"</span>]  <span class="co"># CC-BY license</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the request</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.post(retrieve_url, json<span class="op">=</span>request_data)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> response.json()</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Request submitted successfully!"</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Request ID: </span><span class="sc">{</span>result<span class="sc">.</span>get(<span class="st">'request_id'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Status: </span><span class="sc">{</span>result<span class="sc">.</span>get(<span class="st">'status'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(response.text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: 405
{"detail":"Method Not Allowed"}</code></pre>
</div>
</div>
<div id="139e0942" class="cell" data-execution_count="68">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cdsapi</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">"cds_burned_area_data"</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> <span class="st">"satellite-fire-burned-area"</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>request <span class="op">=</span> {</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"origin"</span>: <span class="st">"c3s"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sensor"</span>: <span class="st">"olci"</span>, </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"variable"</span>: <span class="st">"grid_variables"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"version"</span>: <span class="st">"1_1"</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year"</span>: [</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2019"</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2023"</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"month"</span>: [</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"03"</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"04"</span>, <span class="st">"05"</span>, <span class="st">"06"</span>, </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"07"</span>, <span class="st">"08"</span>, <span class="st">"09"</span>,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"12"</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nominal_day"</span>: [<span class="st">"01"</span>]</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> cdsapi.Client()</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Download with a specific filename</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join(output_dir, <span class="st">"burned_area_south_america_2017_2023.nc"</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>client.retrieve(dataset, request, output_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">Exception</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[68]</span><span class="ansi-green-fg">, line 28</span>
<span class="ansi-green-fg">      8</span> dataset = <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">satellite-fire-burned-area</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">      9</span> request = {
<span class="ansi-green-fg">     10</span>     <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">origin</span><span class="ansi-yellow-fg">"</span>: <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">c3s</span><span class="ansi-yellow-fg">"</span>,
<span class="ansi-green-fg">     11</span>     <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">sensor</span><span class="ansi-yellow-fg">"</span>: <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">olci</span><span class="ansi-yellow-fg">"</span>, 
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">     25</span>     <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">nominal_day</span><span class="ansi-yellow-fg">"</span>: [<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">01</span><span class="ansi-yellow-fg">"</span>]
<span class="ansi-green-fg">     26</span> }
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">28</span> client = <span class="ansi-yellow-bg">cdsapi</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">Client</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     30</span> <span style="font-style:italic;color:rgb(95,135,135)"># Download with a specific filename</span>
<span class="ansi-green-fg">     31</span> output_file = os.path.join(output_dir, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">burned_area_south_america_2017_2023.nc</span><span class="ansi-yellow-fg">"</span>)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Documents/dev/fulbright/ciut-riesgo/.venv/lib/python3.12/site-packages/cdsapi/api.py:281</span>, in <span class="ansi-cyan-fg">Client.__new__</span><span class="ansi-blue-fg">(cls, url, key, *args, **kwargs)</span>
<span class="ansi-green-fg">    280</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">__new__</span>(<span style="color:rgb(0,135,0)">cls</span>, url=<span style="font-weight:bold;color:rgb(0,135,0)">None</span>, key=<span style="font-weight:bold;color:rgb(0,135,0)">None</span>, *args, **kwargs):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">281</span>     _, token, _ = <span class="ansi-yellow-bg">get_url_key_verify</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">None</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    282</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">:</span><span class="ansi-yellow-fg">"</span> <span style="font-weight:bold;color:rgb(175,0,255)">in</span> token:
<span class="ansi-green-fg">    283</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>().<span class="ansi-blue-fg">__new__</span>(<span style="color:rgb(0,135,0)">cls</span>)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Documents/dev/fulbright/ciut-riesgo/.venv/lib/python3.12/site-packages/cdsapi/api.py:69</span>, in <span class="ansi-cyan-fg">get_url_key_verify</span><span class="ansi-blue-fg">(url, key, verify)</span>
<span class="ansi-green-fg">     66</span>             verify = <span style="color:rgb(0,135,0)">bool</span>(<span style="color:rgb(0,135,0)">int</span>(config.get(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">verify</span><span class="ansi-yellow-fg">"</span>, <span class="ansi-green-fg">1</span>)))
<span class="ansi-green-fg">     68</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> url <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="font-weight:bold;color:rgb(175,0,255)">or</span> key <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">69</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span>(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Missing/incomplete configuration file: </span><span style="font-weight:bold;color:rgb(175,95,135)">%s</span><span class="ansi-yellow-fg">"</span> % (dotrc))
<span class="ansi-green-fg">     71</span> <span style="font-style:italic;color:rgb(95,135,135)"># If verify is still None, then we set to default value of True</span>
<span class="ansi-green-fg">     72</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> verify <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:

<span class="ansi-red-fg">Exception</span>: Missing/incomplete configuration file: /home/nissim/.cdsapirc</pre>
</div>
</div>
</div>
<div id="b16aa5e2" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapely.geometry</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>aoi_as_shapely_shape <span class="op">=</span> aoi.geometry.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="008a5659" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>search <span class="op">=</span> client.search(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    max_items<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span><span class="st">"satellite-fire-burned-area"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>aoi_as_shapely_shape,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AOI as Shapely Geometry object from shape(), "</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"found </span><span class="sc">{</span><span class="bu">len</span>(<span class="bu">list</span>(search.items()))<span class="sc">}</span><span class="ss"> items"</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">DoesNotConformTo</span>                          Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[53]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> search = <span class="ansi-yellow-bg">client</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">search</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">      2</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">max_items</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">25</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">collections</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">satellite-fire-burned-area</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      4</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">intersects</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">aoi_as_shapely_shape</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      7</span> <span style="color:rgb(0,135,0)">print</span>(
<span class="ansi-green-fg">      8</span>     <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">AOI as Shapely Geometry object from shape(), </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">      9</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">found </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">len</span>(<span style="color:rgb(0,135,0)">list</span>(search.items()))<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> items</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">     10</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Documents/dev/fulbright/ciut-riesgo/.venv/lib/python3.12/site-packages/pystac_client/client.py:612</span>, in <span class="ansi-cyan-fg">Client.search</span><span class="ansi-blue-fg">(self, method, max_items, limit, ids, collections, bbox, intersects, datetime, query, filter, filter_lang, sortby, fields)</span>
<span class="ansi-green-fg">    510</span> <span style="font-style:italic" class="ansi-yellow-fg">"""Query the ``/search`` endpoint using the given parameters.</span>
<span class="ansi-green-fg">    511</span> 
<span class="ansi-green-fg">    512</span> <span style="font-style:italic" class="ansi-yellow-fg">This method returns an :class:`~pystac_client.ItemSearch` instance. See that</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    608</span> <span style="font-style:italic" class="ansi-yellow-fg">        a ``"rel"`` type of ``"search"``.</span>
<span class="ansi-green-fg">    609</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    611</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">self</span>.conforms_to(ConformanceClasses.ITEM_SEARCH):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">612</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> DoesNotConformTo(
<span class="ansi-green-fg">    613</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">ITEM_SEARCH</span><span class="ansi-yellow-fg">"</span>, <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">There is no fallback option available for search.</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    614</span>     )
<span class="ansi-green-fg">    616</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> ItemSearch(
<span class="ansi-green-fg">    617</span>     url=<span style="color:rgb(0,135,0)">self</span>._search_href(),
<span class="ansi-green-fg">    618</span>     method=method,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    632</span>     modifier=<span style="color:rgb(0,135,0)">self</span>.modifier,
<span class="ansi-green-fg">    633</span> )

<span class="ansi-red-fg">DoesNotConformTo</span>: Server does not conform to ITEM_SEARCH, There is no fallback option available for search.</pre>
</div>
</div>
</div>
<div id="a7010d90" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geometry from the FeatureCollection</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>ee_aoi_geometry <span class="op">=</span> ee_aoi.geometry()</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then use it in the export</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    burn_count_clipped, </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/gabam.tif"</span>, </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">90</span>, </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>ee_aoi_geometry</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating URL ...
Downloading data from https://earthengine.googleapis.com/v1/projects/grand-magpie-459819-i5/thumbnails/dcf2f87e6814532d41268adb9acb5a80-d56f7d28b8d5aa397573330182b8f258:getPixels
Please wait ...
Data downloaded to /home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/gabam.tif</code></pre>
</div>
</div>
<div id="661accb6" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load ESA AVHRR-LTDR observations dataset</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading ESA AVHRR-LTDR observations..."</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ob_collection <span class="op">=</span> ee.ImageCollection(<span class="st">"projects/sat-io/open-datasets/ESA/AVHRR-LTDR/OB"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by AOI and sum all observations across all years</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>ob_aoi <span class="op">=</span> ob_collection.filterBounds(ee_aoi_geometry)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>total_observations <span class="op">=</span> ob_aoi.<span class="bu">sum</span>().clip(ee_aoi_geometry)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get stats</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>obs_stats <span class="op">=</span> total_observations.reduceRegion(</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    reducer<span class="op">=</span>ee.Reducer.minMax().combine(ee.Reducer.mean(), sharedInputs<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>ee_aoi_geometry,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    maxPixels<span class="op">=</span><span class="fl">1e9</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min observations: </span><span class="sc">{</span>obs_stats<span class="sc">.</span>get(<span class="st">'b1_min'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max observations: </span><span class="sc">{</span>obs_stats<span class="sc">.</span>get(<span class="st">'b1_max'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean observations: </span><span class="sc">{</span>obs_stats<span class="sc">.</span>get(<span class="st">'b1_mean'</span>)<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to map</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>m.addLayer(</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    total_observations.updateMask(total_observations.gte(<span class="dv">0</span>)), </span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="dv">0</span>, </span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="dv">100</span>,  <span class="co"># Adjust based on your stats</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'palette'</span>: [<span class="st">'#7f3b08'</span>,<span class="st">'#b35806'</span>,<span class="st">'#e08214'</span>,<span class="st">'#fdb863'</span>,<span class="st">'#fee0b6'</span>,<span class="st">'#f7f7f7'</span>,<span class="st">'#d8daeb'</span>,<span class="st">'#b2abd2'</span>,<span class="st">'#8073ac'</span>,<span class="st">'#542788'</span>,<span class="st">'#2d004b'</span>]</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ESA Total Observations (All Years)'</span>, </span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    <span class="va">True</span>, </span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.7</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading ESA AVHRR-LTDR observations...
Min observations: 8595
Max observations: 8936
Mean observations: 8741.492012692937</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9815d1df9a7f4bea8e3c8f9e14df893f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="868aa58b" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total MODIS fires in AOI: </span><span class="sc">{</span>all_modis_aoi<span class="sc">.</span>size()<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total VIIRS fires in AOI: </span><span class="sc">{</span>all_viirs_aoi<span class="sc">.</span>size()<span class="sc">.</span>getInfo()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Total MODIS fires in AOI: 486
Total VIIRS fires in AOI: 561</code></pre>
</div>
</div>
<div id="38838a08" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert styled layers back to feature collections</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>modis_day_fc <span class="op">=</span> modis_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'D'</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>modis_night_fc <span class="op">=</span> modis_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'N'</span>))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>viirs_day_fc <span class="op">=</span> viirs_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'D'</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>viirs_night_fc <span class="op">=</span> viirs_styled.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'N'</span>))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Add styling properties as attributes for export</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_export_properties(fc):</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add styling properties as regular attributes for easier export"""</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_props(feature):</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        style_props <span class="op">=</span> feature.get(<span class="st">'styleProperty'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> feature.<span class="bu">set</span>({</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'pointSize'</span>: ee.Dictionary(style_props).get(<span class="st">'pointSize'</span>),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'color'</span>: ee.Dictionary(style_props).get(<span class="st">'color'</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fc.<span class="bu">map</span>(add_props)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to all collections</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>modis_day_fc <span class="op">=</span> add_export_properties(modis_day_fc)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>modis_night_fc <span class="op">=</span> add_export_properties(modis_night_fc)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>viirs_day_fc <span class="op">=</span> add_export_properties(viirs_day_fc)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>viirs_night_fc <span class="op">=</span> add_export_properties(viirs_night_fc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="12910a4d" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>modis_day_fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre>&lt;ee.featurecollection.FeatureCollection object at 0x7ba6a4485ca0&gt;</pre>
</div>
</div>
<div id="3128c3cb" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to geodataframes directly from the original feature collections</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>modis_day_gdf <span class="op">=</span> geemap.ee_to_gdf(all_modis_aoi.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'D'</span>)))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>modis_night_gdf <span class="op">=</span> geemap.ee_to_gdf(all_modis_aoi.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'N'</span>)))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>viirs_day_gdf <span class="op">=</span> geemap.ee_to_gdf(all_viirs_aoi.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'D'</span>)))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>viirs_night_gdf <span class="op">=</span> geemap.ee_to_gdf(all_viirs_aoi.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">'daynight'</span>, <span class="st">'N'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="71fa6dcc" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>modis_gdf<span class="op">=</span>geemap.ee_to_gdf(all_modis_aoi)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>viirs_gdf<span class="op">=</span>geemap.ee_to_gdf(all_viirs_aoi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="f84938d9" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>modis_gdf.to_file(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/_all_modis.geojson"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>viirs_gdf.to_file(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/_all_viirs.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="c0b2c218" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>modis_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">acq_date</th>
<th data-quarto-table-cell-role="th">acq_time</th>
<th data-quarto-table-cell-role="th">bright_t31</th>
<th data-quarto-table-cell-role="th">brightness</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">daynight</th>
<th data-quarto-table-cell-role="th">frp</th>
<th data-quarto-table-cell-role="th">instrument</th>
<th data-quarto-table-cell-role="th">satellite</th>
<th data-quarto-table-cell-role="th">scan</th>
<th data-quarto-table-cell-role="th">track</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>POINT (-62.9187 -32.019)</td>
<td>2000-11-14</td>
<td>1439</td>
<td>295.600006</td>
<td>308.200012</td>
<td>49</td>
<td>D</td>
<td>4.800000</td>
<td>MODIS</td>
<td>Terra</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>6.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>POINT (-63.6187 -31.5323)</td>
<td>2001-07-28</td>
<td>1433</td>
<td>273.799988</td>
<td>307.299988</td>
<td>49</td>
<td>D</td>
<td>10.400000</td>
<td>MODIS</td>
<td>Terra</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>6.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>POINT (-63.6081 -31.5338)</td>
<td>2001-07-28</td>
<td>1433</td>
<td>277.100006</td>
<td>303.100006</td>
<td>55</td>
<td>D</td>
<td>7.800000</td>
<td>MODIS</td>
<td>Terra</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>6.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>POINT (-63.6317 -31.5596)</td>
<td>2002-07-12</td>
<td>1811</td>
<td>296.100006</td>
<td>307.200012</td>
<td>32</td>
<td>D</td>
<td>4.200000</td>
<td>MODIS</td>
<td>Aqua</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>6.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>POINT (-63.6423 -31.5612)</td>
<td>2002-07-12</td>
<td>1811</td>
<td>299.700012</td>
<td>366.799988</td>
<td>100</td>
<td>D</td>
<td>104.300003</td>
<td>MODIS</td>
<td>Aqua</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>6.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="83f8c52d" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>viirs_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">acq_date</th>
<th data-quarto-table-cell-role="th">acq_time</th>
<th data-quarto-table-cell-role="th">bright_ti4</th>
<th data-quarto-table-cell-role="th">bright_ti5</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">daynight</th>
<th data-quarto-table-cell-role="th">frp</th>
<th data-quarto-table-cell-role="th">instrument</th>
<th data-quarto-table-cell-role="th">satellite</th>
<th data-quarto-table-cell-role="th">scan</th>
<th data-quarto-table-cell-role="th">track</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>POINT (-63.36078 -31.46117)</td>
<td>2012-10-24</td>
<td>1847</td>
<td>367.000000</td>
<td>293.230011</td>
<td>h</td>
<td>D</td>
<td>20.32</td>
<td>VIIRS</td>
<td>N</td>
<td>0.45</td>
<td>0.63</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>POINT (-63.84928 -31.62288)</td>
<td>2012-07-25</td>
<td>1854</td>
<td>367.000000</td>
<td>293.890015</td>
<td>h</td>
<td>D</td>
<td>28.65</td>
<td>VIIRS</td>
<td>N</td>
<td>0.52</td>
<td>0.67</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>POINT (-63.83323 -31.66405)</td>
<td>2012-06-27</td>
<td>515</td>
<td>301.040009</td>
<td>283.869995</td>
<td>n</td>
<td>N</td>
<td>0.61</td>
<td>VIIRS</td>
<td>N</td>
<td>0.38</td>
<td>0.36</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>POINT (-63.83244 -31.66419)</td>
<td>2012-05-10</td>
<td>516</td>
<td>300.690002</td>
<td>286.739990</td>
<td>n</td>
<td>N</td>
<td>0.61</td>
<td>VIIRS</td>
<td>N</td>
<td>0.38</td>
<td>0.36</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>POINT (-63.83203 -31.66506)</td>
<td>2012-07-18</td>
<td>522</td>
<td>297.760010</td>
<td>277.149994</td>
<td>n</td>
<td>N</td>
<td>0.83</td>
<td>VIIRS</td>
<td>N</td>
<td>0.39</td>
<td>0.36</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="1c09504c" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract just geometry and date from both gdfs (year is stored in acq_date as YYYY-MM-DD in both)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># concatenate into a single dataframe</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># group by geometry, year</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a hex grid with 2.5 radis</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># count number of years per hex with at least one observation (total number of years)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="62c89daf" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>combined_gdf.to_parquet(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/combined_gdf.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="e13493f4" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geohexgrid <span class="im">as</span> ghg</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Extract just geometry and date from both gdfs</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Extracting geometry and date from MODIS data..."</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>modis_subset <span class="op">=</span> modis_gdf[[<span class="st">'geometry'</span>, <span class="st">'acq_date'</span>]].copy()</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>modis_subset[<span class="st">'source'</span>] <span class="op">=</span> <span class="st">'MODIS'</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Extracting geometry and date from VIIRS data..."</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>viirs_subset <span class="op">=</span> viirs_gdf[[<span class="st">'geometry'</span>, <span class="st">'acq_date'</span>]].copy()</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>viirs_subset[<span class="st">'source'</span>] <span class="op">=</span> <span class="st">'VIIRS'</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Concatenate into a single dataframe</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Concatenating dataframes..."</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>combined_gdf <span class="op">=</span> pd.concat([modis_subset, viirs_subset], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure we're working in the correct CRS</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>combined_gdf <span class="op">=</span> combined_gdf.to_crs(USE_CRS)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract year from acq_date and group by geometry, year</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Processing dates and grouping..."</span>)</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>combined_gdf[<span class="st">'acq_date'</span>] <span class="op">=</span> pd.to_datetime(combined_gdf[<span class="st">'acq_date'</span>])</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>combined_gdf[<span class="st">'year'</span>] <span class="op">=</span> combined_gdf[<span class="st">'acq_date'</span>].dt.year</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by geometry and year to get unique observations per year</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> combined_gdf.groupby([<span class="st">'geometry'</span>, <span class="st">'year'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>grouped_gdf <span class="op">=</span> gpd.GeoDataFrame(grouped, geometry<span class="op">=</span><span class="st">'geometry'</span>, crs<span class="op">=</span>USE_CRS)</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total unique geometry-year combinations: </span><span class="sc">{</span><span class="bu">len</span>(grouped_gdf)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Create a hex grid with 2.5km radius using geohexgrid</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Creating hex grid..."</span>)</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>hex_gdf <span class="op">=</span> ghg.make_grid_from_gdf(grouped_gdf, R<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Created </span><span class="sc">{</span><span class="bu">len</span>(hex_gdf)<span class="sc">}</span><span class="ss"> hex cells"</span>)</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Count number of years per hex with at least one observation</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Counting years per hex..."</span>)</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial join to assign each point to a hex</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>points_in_hex <span class="op">=</span> gpd.sjoin(grouped_gdf, hex_gdf, how<span class="op">=</span><span class="st">'left'</span>, predicate<span class="op">=</span><span class="st">'within'</span>)</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Count unique years per hex</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>years_per_hex <span class="op">=</span> points_in_hex.groupby(<span class="st">'cell_id'</span>)[<span class="st">'year'</span>].nunique().reset_index(name<span class="op">=</span><span class="st">'years_with_observations'</span>)</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge back with hex geometry</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>hex_with_counts <span class="op">=</span> hex_gdf.merge(years_per_hex, on<span class="op">=</span><span class="st">'cell_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>hex_with_counts[<span class="st">'years_with_observations'</span>] <span class="op">=</span> hex_with_counts[<span class="st">'years_with_observations'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Count total observations per hex (regardless of year)</span></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Counting total observations per hex..."</span>)</span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Count total observations per hex</span></span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>total_obs_per_hex <span class="op">=</span> points_in_hex.groupby(<span class="st">'cell_id'</span>)[<span class="st">'count'</span>].<span class="bu">sum</span>().reset_index(name<span class="op">=</span><span class="st">'total_observations'</span>)</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge back with hex geometry</span></span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>hex_with_total_obs <span class="op">=</span> hex_gdf.merge(total_obs_per_hex, on<span class="op">=</span><span class="st">'cell_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>hex_with_total_obs[<span class="st">'total_observations'</span>] <span class="op">=</span> hex_with_total_obs[<span class="st">'total_observations'</span>].fillna(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Extracting geometry and date from MODIS data...
Extracting geometry and date from VIIRS data...
Concatenating dataframes...
Processing dates and grouping...
Total unique geometry-year combinations: 1047
Creating hex grid...
Created 442 hex cells
Counting years per hex...
Counting total observations per hex...</code></pre>
</div>
</div>
<div id="67c62111" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: Years with observations</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>hex_with_counts.plot(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'years_with_observations'</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlOrRd'</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax1,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>grouped_gdf.plot(ax<span class="op">=</span>ax1, color<span class="op">=</span><span class="st">'blue'</span>, markersize<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Years with Data per Hex (1km radius)'</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'X (meters)'</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Y (meters)'</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-49-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="villa-del-rosario_files/figure-html/cell-49-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="8cd8f990" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Total observations</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>fig, ax2 <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>hex_with_total_obs.plot(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'total_observations'</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlOrRd'</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax2,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>grouped_gdf.plot(ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">'blue'</span>, markersize<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Total Observations per Hex (1km radius)'</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'X (meters)'</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Y (meters)'</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-50-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="villa-del-rosario_files/figure-html/cell-50-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="be7610de" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>hex_with_counts.to_parquet(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/hex_grid_annual_counts_1km.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="f2864bf7" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>hex_with_counts.hist(<span class="st">"years_with_observations"</span>, bins<span class="op">=</span><span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array([[&lt;Axes: title={'center': 'years_with_observations'}&gt;]],
      dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-52-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="villa-del-rosario_files/figure-html/cell-52-output-3.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="98ac2da8" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot hexes colored by number of years with observations</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>hex_with_counts.plot(</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'years_with_observations'</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlOrRd'</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the original points</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>grouped_gdf.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'blue'</span>, markersize<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Fire Observations: Years with Data per Hex (2.5km radius)'</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'X (meters)'</span>)</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Y (meters)'</span>)</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-53-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="villa-del-rosario_files/figure-html/cell-53-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results saved to 'fire_observations_hex_grid.geojson'</code></pre>
</div>
</div>
<div id="84ac1658" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.ops <span class="im">import</span> unary_union</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both dataframes</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> pd.concat([modis_gdf[[<span class="st">'geometry'</span>]], viirs_gdf[[<span class="st">'geometry'</span>]]], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Round coordinates to ~100m precision (0.001 degrees â‰ˆ 100m)</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> round_geometry(geom):</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Point(<span class="bu">round</span>(geom.x, <span class="dv">2</span>), <span class="bu">round</span>(geom.y, <span class="dv">2</span>))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>combined[<span class="st">'rounded_geom'</span>] <span class="op">=</span> combined[<span class="st">'geometry'</span>].<span class="bu">apply</span>(round_geometry)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicates based on rounded geometry</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>unique_points <span class="op">=</span> combined.drop_duplicates(subset<span class="op">=</span>[<span class="st">'rounded_geom'</span>]).drop(columns<span class="op">=</span>[<span class="st">'rounded_geom'</span>])</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original points: </span><span class="sc">{</span><span class="bu">len</span>(modis_gdf) <span class="op">+</span> <span class="bu">len</span>(viirs_gdf)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique points: </span><span class="sc">{</span><span class="bu">len</span>(unique_points)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Original points: 187
Unique points: 92</code></pre>
</div>
</div>
<div id="7e418aed" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique_points.to_parquet("/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/unique_points.parquet")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="7856a183" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in unique points and create 1km buffers</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all data has the same CRS (USE_CRS = "EPSG:5347")</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate population statistics within the unioned buffer</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.ops <span class="im">import</span> unary_union</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Read in unique points (if not already in memory)</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># unique_points = gpd.read_parquet("/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/unique_points.parquet")</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Ensure unique_points has the correct CRS</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> unique_points.crs <span class="op">!=</span> USE_CRS:</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    unique_points <span class="op">=</span> unique_points.to_crs(USE_CRS)</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create 1km buffers around each point</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Creating 1km buffers around </span><span class="sc">{</span><span class="bu">len</span>(unique_points)<span class="sc">}</span><span class="ss"> unique points..."</span>)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>unique_points[<span class="st">'buffer_1km'</span>] <span class="op">=</span> unique_points.geometry.<span class="bu">buffer</span>(<span class="dv">2000</span>)  <span class="co"># 1000 meters = 1km</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Union all buffers into a single geometry</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Creating union of all buffers..."</span>)</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>unioned_buffer <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>[unary_union(unique_points[<span class="st">'buffer_1km'</span>].values)],</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>USE_CRS</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Ensure population rasters have the same CRS as the unioned buffer</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Ensuring CRS consistency..."</span>)</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pob_redistribuida_da.rio.crs <span class="op">!=</span> USE_CRS:</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    pob_redistribuida_da <span class="op">=</span> pob_redistribuida_da.rio.reproject(USE_CRS)</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pob_privacion_da.rio.crs <span class="op">!=</span> USE_CRS:</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    pob_privacion_da <span class="op">=</span> pob_privacion_da.rio.reproject(USE_CRS)</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Calculate population statistics within the unioned buffer</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Calculating population statistics within unioned buffer..."</span>)</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Use rasterstats to calculate zonal statistics</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert unioned buffer to a format that rasterstats can use</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>buffer_geom <span class="op">=</span> unioned_buffer.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total population within buffer</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>pop_stats <span class="op">=</span> zonal_stats(</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>    buffer_geom,</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>    pob_redistribuida_da.values,</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>pob_redistribuida_da.rio.transform(),</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">'sum'</span>, <span class="st">'count'</span>],</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=</span><span class="dv">0</span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate population in poverty within buffer</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>poverty_stats <span class="op">=</span> zonal_stats(</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>    buffer_geom,</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>    pob_privacion_da.values,</span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>pob_privacion_da.rio.transform(),</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">'sum'</span>, <span class="st">'count'</span>],</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=</span><span class="dv">0</span></span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Report results</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"POPULATION ANALYSIS WITHIN 1KM FIRE BUFFERS"</span>)</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of unique fire points: </span><span class="sc">{</span><span class="bu">len</span>(unique_points)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Buffer radius: 1 km"</span>)</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinate Reference System: </span><span class="sc">{</span>USE_CRS<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total population within unioned buffer: </span><span class="sc">{</span>pop_stats[<span class="dv">0</span>][<span class="st">'sum'</span>]<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Population in poverty within unioned buffer: </span><span class="sc">{</span>poverty_stats[<span class="dv">0</span>][<span class="st">'sum'</span>]<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pop_stats[<span class="dv">0</span>][<span class="st">'sum'</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>    poverty_rate <span class="op">=</span> (poverty_stats[<span class="dv">0</span>][<span class="st">'sum'</span>] <span class="op">/</span> pop_stats[<span class="dv">0</span>][<span class="st">'sum'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Poverty rate within buffer: </span><span class="sc">{</span>poverty_rate<span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No population found within the buffer area"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating 1km buffers around 92 unique points...
Creating union of all buffers...
Ensuring CRS consistency...
Calculating population statistics within unioned buffer...

==================================================
POPULATION ANALYSIS WITHIN 1KM FIRE BUFFERS
==================================================
Number of unique fire points: 92
Buffer radius: 1 km
Coordinate Reference System: EPSG:5347
Total population within unioned buffer: 18882
Population in poverty within unioned buffer: 5245
Poverty rate within buffer: 27.78%</code></pre>
</div>
</div>
<div id="e72100e1" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="dv">18882</span> <span class="op">/</span> total_redistribuido</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>np.float64(0.9553250713214301)</code></pre>
</div>
</div>
<div id="012b1550" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>unioned_buffer.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-58-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="villa-del-rosario_files/figure-html/cell-58-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="30a7d805" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>unioned_buffer.to_parquet(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/unioned_buffer_1km.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="2d453cd4" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>np.float64(0.5814747719447617)</code></pre>
</div>
</div>
<div id="b78034f9" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in unique points </span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># buffer 1km around them</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># union the buffers</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure population (pob_redistribuida_da), pop in poverty (pob_privacion_da) rasters and the unioned buffer have the same CRS</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the pop, pop in poverty within the unioned buffer</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># report</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># unique_points.to_parquet("/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/unique_points.parquet")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="17c60309" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(modis_gdf.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                    geometry    acq_date  acq_time  bright_t31  brightness  \
0   POINT (-62.9187 -32.019)  2000-11-14      1439  295.600006  308.200012   
1  POINT (-63.6187 -31.5323)  2001-07-28      1433  273.799988  307.299988   
2  POINT (-63.6081 -31.5338)  2001-07-28      1433  277.100006  303.100006   
3  POINT (-63.6317 -31.5596)  2002-07-12      1811  296.100006  307.200012   
4  POINT (-63.6423 -31.5612)  2002-07-12      1811  299.700012  366.799988   

   confidence daynight         frp instrument satellite  scan  track  type  \
0          49        D    4.800000      MODIS     Terra   1.0    1.0     0   
1          49        D   10.400000      MODIS     Terra   1.0    1.0     0   
2          55        D    7.800000      MODIS     Terra   1.0    1.0     0   
3          32        D    4.200000      MODIS      Aqua   1.0    1.0     0   
4         100        D  104.300003      MODIS      Aqua   1.0    1.0     0   

   version  
0      6.2  
1      6.2  
2      6.2  
3      6.2  
4      6.2  </code></pre>
</div>
</div>
<div id="4c8d8299" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(viirs_gdf.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      geometry    acq_date  acq_time  bright_ti4  bright_ti5  \
0  POINT (-63.36078 -31.46117)  2012-10-24      1847  367.000000  293.230011   
1  POINT (-63.84928 -31.62288)  2012-07-25      1854  367.000000  293.890015   
2  POINT (-63.83323 -31.66405)  2012-06-27       515  301.040009  283.869995   
3  POINT (-63.83244 -31.66419)  2012-05-10       516  300.690002  286.739990   
4  POINT (-63.83203 -31.66506)  2012-07-18       522  297.760010  277.149994   

  confidence daynight    frp instrument satellite  scan  track  type  version  
0          h        D  20.32      VIIRS         N  0.45   0.63     0        1  
1          h        D  28.65      VIIRS         N  0.52   0.67     0        1  
2          n        N   0.61      VIIRS         N  0.38   0.36     0        1  
3          n        N   0.61      VIIRS         N  0.38   0.36     0        1  
4          n        N   0.83      VIIRS         N  0.39   0.36     0        1  </code></pre>
</div>
</div>
<div id="62ef76d2" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MODIS - Filter for confidence &gt; 50</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>modis_filtered <span class="op">=</span> modis_gdf[modis_gdf[<span class="st">'confidence'</span>] <span class="op">&gt;</span> <span class="dv">50</span>].copy()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>modis_filtered[<span class="st">'acq_date'</span>] <span class="op">=</span> pd.to_datetime(modis_filtered[<span class="st">'acq_date'</span>])</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>modis_filtered[<span class="st">'year'</span>] <span class="op">=</span> modis_filtered[<span class="st">'acq_date'</span>].dt.year</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>modis_filtered[<span class="st">'month'</span>] <span class="op">=</span> modis_filtered[<span class="st">'acq_date'</span>].dt.month</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get date range for MODIS</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>modis_start <span class="op">=</span> modis_filtered[<span class="st">'acq_date'</span>].<span class="bu">min</span>().strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>modis_end <span class="op">=</span> modis_filtered[<span class="st">'acq_date'</span>].<span class="bu">max</span>().strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Count observations per month per year</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>modis_monthly_counts <span class="op">=</span> modis_filtered.groupby([<span class="st">'year'</span>, <span class="st">'month'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete year-month combinations and fill missing months with 0</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>modis_years <span class="op">=</span> <span class="bu">sorted</span>(modis_filtered[<span class="st">'year'</span>].unique())</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>modis_complete_data <span class="op">=</span> []</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> modis_years:</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>):</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>        existing <span class="op">=</span> modis_monthly_counts[(modis_monthly_counts[<span class="st">'year'</span>] <span class="op">==</span> year) <span class="op">&amp;</span> </span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>                                       (modis_monthly_counts[<span class="st">'month'</span>] <span class="op">==</span> month)]</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> existing[<span class="st">'count'</span>].iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(existing) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>        modis_complete_data.append({<span class="st">'year'</span>: year, <span class="st">'month'</span>: month, <span class="st">'count'</span>: count})</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>modis_complete_df <span class="op">=</span> pd.DataFrame(modis_complete_data)</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average across all years for each month</span></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>modis_monthly_avg <span class="op">=</span> modis_complete_df.groupby(<span class="st">'month'</span>)[<span class="st">'count'</span>].mean().reset_index()</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create MODIS plot</span></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot individual years in grey</span></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> modis_years:</span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>    year_data <span class="op">=</span> modis_complete_df[modis_complete_df[<span class="st">'year'</span>] <span class="op">==</span> year]</span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>    ax.plot(year_data[<span class="st">'month'</span>], year_data[<span class="st">'count'</span>], </span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'lightgrey'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot average line in dark red</span></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>ax.plot(modis_monthly_avg[<span class="st">'month'</span>], modis_monthly_avg[<span class="st">'count'</span>], </span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'darkred'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, label<span class="op">=</span><span class="st">'Promedio'</span>)</span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Mes'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NÃºmero de Observaciones'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Serie Temporal de Incendios MODIS</span><span class="ch">\n</span><span class="ss">(Confianza &gt; 50%) - </span><span class="sc">{</span>modis_start<span class="sc">}</span><span class="ss"> a </span><span class="sc">{</span>modis_end<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Set month labels</span></span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>month_names <span class="op">=</span> [<span class="st">'Ene'</span>, <span class="st">'Feb'</span>, <span class="st">'Mar'</span>, <span class="st">'Abr'</span>, <span class="st">'May'</span>, <span class="st">'Jun'</span>,</span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Jul'</span>, <span class="st">'Ago'</span>, <span class="st">'Sep'</span>, <span class="st">'Oct'</span>, <span class="st">'Nov'</span>, <span class="st">'Dic'</span>]</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(month_names)</span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for minimalist look</span></span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Set grid</span></span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a><span class="co"># VIIRS - Filter for confidence = 'h' or 'n'</span></span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a>viirs_filtered <span class="op">=</span> viirs_gdf[viirs_gdf[<span class="st">'confidence'</span>].isin([<span class="st">'h'</span>, <span class="st">'n'</span>])].copy()</span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a>viirs_filtered[<span class="st">'acq_date'</span>] <span class="op">=</span> pd.to_datetime(viirs_filtered[<span class="st">'acq_date'</span>])</span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a>viirs_filtered[<span class="st">'year'</span>] <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].dt.year</span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a>viirs_filtered[<span class="st">'month'</span>] <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].dt.month</span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Get date range for VIIRS</span></span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>viirs_start <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].<span class="bu">min</span>().strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>viirs_end <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].<span class="bu">max</span>().strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Count observations per month per year</span></span>
<span id="cb85-78"><a href="#cb85-78" aria-hidden="true" tabindex="-1"></a>viirs_monthly_counts <span class="op">=</span> viirs_filtered.groupby([<span class="st">'year'</span>, <span class="st">'month'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb85-79"><a href="#cb85-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-80"><a href="#cb85-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete year-month combinations and fill missing months with 0</span></span>
<span id="cb85-81"><a href="#cb85-81" aria-hidden="true" tabindex="-1"></a>viirs_years <span class="op">=</span> <span class="bu">sorted</span>(viirs_filtered[<span class="st">'year'</span>].unique())</span>
<span id="cb85-82"><a href="#cb85-82" aria-hidden="true" tabindex="-1"></a>viirs_complete_data <span class="op">=</span> []</span>
<span id="cb85-83"><a href="#cb85-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> viirs_years:</span>
<span id="cb85-84"><a href="#cb85-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>):</span>
<span id="cb85-85"><a href="#cb85-85" aria-hidden="true" tabindex="-1"></a>        existing <span class="op">=</span> viirs_monthly_counts[(viirs_monthly_counts[<span class="st">'year'</span>] <span class="op">==</span> year) <span class="op">&amp;</span> </span>
<span id="cb85-86"><a href="#cb85-86" aria-hidden="true" tabindex="-1"></a>                                        (viirs_monthly_counts[<span class="st">'month'</span>] <span class="op">==</span> month)]</span>
<span id="cb85-87"><a href="#cb85-87" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> existing[<span class="st">'count'</span>].iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(existing) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb85-88"><a href="#cb85-88" aria-hidden="true" tabindex="-1"></a>        viirs_complete_data.append({<span class="st">'year'</span>: year, <span class="st">'month'</span>: month, <span class="st">'count'</span>: count})</span>
<span id="cb85-89"><a href="#cb85-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-90"><a href="#cb85-90" aria-hidden="true" tabindex="-1"></a>viirs_complete_df <span class="op">=</span> pd.DataFrame(viirs_complete_data)</span>
<span id="cb85-91"><a href="#cb85-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-92"><a href="#cb85-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average across all years for each month</span></span>
<span id="cb85-93"><a href="#cb85-93" aria-hidden="true" tabindex="-1"></a>viirs_monthly_avg <span class="op">=</span> viirs_complete_df.groupby(<span class="st">'month'</span>)[<span class="st">'count'</span>].mean().reset_index()</span>
<span id="cb85-94"><a href="#cb85-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-95"><a href="#cb85-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Create VIIRS plot</span></span>
<span id="cb85-96"><a href="#cb85-96" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb85-97"><a href="#cb85-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-98"><a href="#cb85-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot individual years in grey</span></span>
<span id="cb85-99"><a href="#cb85-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> viirs_years:</span>
<span id="cb85-100"><a href="#cb85-100" aria-hidden="true" tabindex="-1"></a>    year_data <span class="op">=</span> viirs_complete_df[viirs_complete_df[<span class="st">'year'</span>] <span class="op">==</span> year]</span>
<span id="cb85-101"><a href="#cb85-101" aria-hidden="true" tabindex="-1"></a>    ax.plot(year_data[<span class="st">'month'</span>], year_data[<span class="st">'count'</span>], </span>
<span id="cb85-102"><a href="#cb85-102" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'lightgrey'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb85-103"><a href="#cb85-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-104"><a href="#cb85-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot average line in dark red</span></span>
<span id="cb85-105"><a href="#cb85-105" aria-hidden="true" tabindex="-1"></a>ax.plot(viirs_monthly_avg[<span class="st">'month'</span>], viirs_monthly_avg[<span class="st">'count'</span>], </span>
<span id="cb85-106"><a href="#cb85-106" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'darkred'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, label<span class="op">=</span><span class="st">'Promedio'</span>)</span>
<span id="cb85-107"><a href="#cb85-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-108"><a href="#cb85-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb85-109"><a href="#cb85-109" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Mes'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb85-110"><a href="#cb85-110" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NÃºmero de Observaciones'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb85-111"><a href="#cb85-111" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Serie Temporal de Incendios VIIRS</span><span class="ch">\n</span><span class="ss">(Confianza Alta/Nominal) - </span><span class="sc">{</span>viirs_start<span class="sc">}</span><span class="ss"> a </span><span class="sc">{</span>viirs_end<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb85-112"><a href="#cb85-112" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb85-113"><a href="#cb85-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-114"><a href="#cb85-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Set month labels</span></span>
<span id="cb85-115"><a href="#cb85-115" aria-hidden="true" tabindex="-1"></a>month_names <span class="op">=</span> [<span class="st">'Ene'</span>, <span class="st">'Feb'</span>, <span class="st">'Mar'</span>, <span class="st">'Abr'</span>, <span class="st">'May'</span>, <span class="st">'Jun'</span>,</span>
<span id="cb85-116"><a href="#cb85-116" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Jul'</span>, <span class="st">'Ago'</span>, <span class="st">'Sep'</span>, <span class="st">'Oct'</span>, <span class="st">'Nov'</span>, <span class="st">'Dic'</span>]</span>
<span id="cb85-117"><a href="#cb85-117" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb85-118"><a href="#cb85-118" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(month_names)</span>
<span id="cb85-119"><a href="#cb85-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-120"><a href="#cb85-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb85-121"><a href="#cb85-121" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb85-122"><a href="#cb85-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-123"><a href="#cb85-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for minimalist look</span></span>
<span id="cb85-124"><a href="#cb85-124" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb85-125"><a href="#cb85-125" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb85-126"><a href="#cb85-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-127"><a href="#cb85-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Set grid</span></span>
<span id="cb85-128"><a href="#cb85-128" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb85-129"><a href="#cb85-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-130"><a href="#cb85-130" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb85-131"><a href="#cb85-131" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-64-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="villa-del-rosario_files/figure-html/cell-64-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-64-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="villa-del-rosario_files/figure-html/cell-64-output-3.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="d0c945ce" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VIIRS - Filter for confidence = 'h' or 'n'</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>viirs_filtered <span class="op">=</span> viirs_gdf[viirs_gdf[<span class="st">'confidence'</span>].isin([<span class="st">'h'</span>, <span class="st">'n'</span>])].copy()</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>viirs_filtered[<span class="st">'acq_date'</span>] <span class="op">=</span> pd.to_datetime(viirs_filtered[<span class="st">'acq_date'</span>])</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>viirs_filtered[<span class="st">'year'</span>] <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].dt.year</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>viirs_filtered[<span class="st">'month'</span>] <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].dt.month</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get date range for VIIRS</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>viirs_start <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].<span class="bu">min</span>().strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>viirs_end <span class="op">=</span> viirs_filtered[<span class="st">'acq_date'</span>].<span class="bu">max</span>().strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Count observations per month per year</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>viirs_monthly_counts <span class="op">=</span> viirs_filtered.groupby([<span class="st">'year'</span>, <span class="st">'month'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete year-month combinations and fill missing months with 0</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>viirs_years <span class="op">=</span> <span class="bu">sorted</span>(viirs_filtered[<span class="st">'year'</span>].unique())</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>viirs_complete_data <span class="op">=</span> []</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> viirs_years:</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>):</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>        existing <span class="op">=</span> viirs_monthly_counts[(viirs_monthly_counts[<span class="st">'year'</span>] <span class="op">==</span> year) <span class="op">&amp;</span> </span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>                                        (viirs_monthly_counts[<span class="st">'month'</span>] <span class="op">==</span> month)]</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> existing[<span class="st">'count'</span>].iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(existing) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>        viirs_complete_data.append({<span class="st">'year'</span>: year, <span class="st">'month'</span>: month, <span class="st">'count'</span>: count})</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>viirs_complete_df <span class="op">=</span> pd.DataFrame(viirs_complete_data)</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average across all years for each month</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>viirs_monthly_avg <span class="op">=</span> viirs_complete_df.groupby(<span class="st">'month'</span>)[<span class="st">'count'</span>].mean().reset_index()</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create VIIRS plot with 1:1 aspect ratio</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot individual years in grey</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> viirs_years:</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>    year_data <span class="op">=</span> viirs_complete_df[viirs_complete_df[<span class="st">'year'</span>] <span class="op">==</span> year]</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>    ax.plot(year_data[<span class="st">'month'</span>], year_data[<span class="st">'count'</span>], </span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'lightgrey'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot average line in dark red</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>ax.plot(viirs_monthly_avg[<span class="st">'month'</span>], viirs_monthly_avg[<span class="st">'count'</span>], </span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'darkred'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, label<span class="op">=</span><span class="st">'Promedio'</span>)</span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Mes'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NÃºmero de Observaciones'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Serie Temporal de Incendios VIIRS</span><span class="ch">\n</span><span class="ss">(Confianza Alta/Nominal) - </span><span class="sc">{</span>viirs_start<span class="sc">}</span><span class="ss"> a </span><span class="sc">{</span>viirs_end<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Set month labels</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>month_names <span class="op">=</span> [<span class="st">'Ene'</span>, <span class="st">'Feb'</span>, <span class="st">'Mar'</span>, <span class="st">'Abr'</span>, <span class="st">'May'</span>, <span class="st">'Jun'</span>,</span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Jul'</span>, <span class="st">'Ago'</span>, <span class="st">'Sep'</span>, <span class="st">'Oct'</span>, <span class="st">'Nov'</span>, <span class="st">'Dic'</span>]</span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(month_names)</span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for minimalist look</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Set grid</span></span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as SVG with 300 DPI</span></span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/VIIRS_temporal_series.svg'</span>, </span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'svg'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-70"><a href="#cb86-70" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-65-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="villa-del-rosario_files/figure-html/cell-65-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="e683100b" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar chart of MODIS observations per month</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total observations per month across all years</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>monthly_totals <span class="op">=</span> modis_filtered.groupby(<span class="st">'month'</span>).size()</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar chart</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.bar(monthly_totals.index, monthly_totals.values, </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>              color<span class="op">=</span><span class="st">'darkred'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Mes'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NÃºmero Total de Observaciones'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Observaciones MODIS por Mes</span><span class="ch">\n</span><span class="ss">(Confianza &gt; 50%) - </span><span class="sc">{</span>modis_start<span class="sc">}</span><span class="ss"> a </span><span class="sc">{</span>modis_end<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set month labels</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>month_names <span class="op">=</span> [<span class="st">'Ene'</span>, <span class="st">'Feb'</span>, <span class="st">'Mar'</span>, <span class="st">'Abr'</span>, <span class="st">'May'</span>, <span class="st">'Jun'</span>,</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Jul'</span>, <span class="st">'Ago'</span>, <span class="st">'Sep'</span>, <span class="st">'Oct'</span>, <span class="st">'Nov'</span>, <span class="st">'Dic'</span>]</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(month_names)</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels on top of bars</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> bar.get_height()</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="fl">0.5</span>,</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for minimalist look</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Set grid</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-66-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="villa-del-rosario_files/figure-html/cell-66-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="56ee8e4b" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar chart of MODIS observations per year</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))  <span class="co"># Square figure for 1:1 aspect ratio</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total observations per year</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>yearly_totals <span class="op">=</span> modis_filtered.groupby(<span class="st">'year'</span>).size()</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar chart with integer years</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.bar(<span class="bu">range</span>(<span class="bu">len</span>(yearly_totals)), yearly_totals.values, </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>              color<span class="op">=</span><span class="st">'darkred'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'AÃ±o'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NÃºmero Total de Observaciones'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Observaciones MODIS por AÃ±o</span><span class="ch">\n</span><span class="ss">(Confianza &gt; 50%) - </span><span class="sc">{</span>modis_start<span class="sc">}</span><span class="ss"> a </span><span class="sc">{</span>modis_end<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set year labels as integers</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(yearly_totals)))</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(yearly_totals.index.astype(<span class="bu">int</span>))</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels on top of bars</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, bar <span class="kw">in</span> <span class="bu">enumerate</span>(bars):</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> bar.get_height()</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="fl">0.5</span>,</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for minimalist look</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Set grid</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as SVG with 300 DPI</span></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/mODIS_observations_per_year.svg'</span>, </span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'svg'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-67-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="villa-del-rosario_files/figure-html/cell-67-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="66932bd2" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export as a dataframe with dates and times for the observations</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># make a time series plot of observations per month per year</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add an average line to show typical burn months</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># then, figure out how to spatially visualize this based on the resolution of each dataset--375m? 750m?</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># how do I add in other stuff, e.g., from IDECOR? other resolutions?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c04326f8" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rio</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_fire_mask(gdf, resolution_m, crs<span class="op">=</span><span class="st">'EPSG:4326'</span>):</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Create a binary mask from fire observations at specified resolution</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co">    gdf: GeoDataFrame with fire observations</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co">    resolution_m: Resolution in meters</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co">    crs: Coordinate reference system</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get bounds of the data</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> gdf.total_bounds</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert resolution from meters to degrees (approximate)</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 degree â‰ˆ 111,000 meters at the equator</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    resolution_deg <span class="op">=</span> resolution_m <span class="op">/</span> <span class="dv">111000</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create coordinate arrays</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    lon_min, lat_min, lon_max, lat_max <span class="op">=</span> bounds</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>    lons <span class="op">=</span> np.arange(lon_min, lon_max <span class="op">+</span> resolution_deg, resolution_deg)</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>    lats <span class="op">=</span> np.arange(lat_min, lat_max <span class="op">+</span> resolution_deg, resolution_deg)</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create empty mask</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.zeros((<span class="bu">len</span>(lats), <span class="bu">len</span>(lons)), dtype<span class="op">=</span>np.uint8)</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create grid points</span></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>    lon_grid, lat_grid <span class="op">=</span> np.meshgrid(lons, lats)</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each fire observation, find the corresponding grid cell</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> gdf.iterrows():</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>        lon, lat <span class="op">=</span> row.geometry.x, row.geometry.y</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find closest grid cell</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>        lon_idx <span class="op">=</span> np.argmin(np.<span class="bu">abs</span>(lons <span class="op">-</span> lon))</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>        lat_idx <span class="op">=</span> np.argmin(np.<span class="bu">abs</span>(lats <span class="op">-</span> lat))</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set mask to 1 for this cell</span></span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>        mask[lat_idx, lon_idx] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create xarray DataArray with correct dimension names</span></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> xr.DataArray(</span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>        mask,</span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>        coords<span class="op">=</span>{</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">'y'</span>: lats,  <span class="co"># Use 'y' instead of 'lat'</span></span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">'x'</span>: lons   <span class="co"># Use 'x' instead of 'lon'</span></span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span>[<span class="st">'y'</span>, <span class="st">'x'</span>],  <span class="co"># Use 'y', 'x' instead of 'lat', 'lon'</span></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'fire_mask'</span></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CRS information</span></span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> da.rio.write_crs(crs)</span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> da</span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Create MODIS mask at 1km resolution (1000m)</span></span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a>modis_mask <span class="op">=</span> create_fire_mask(modis_gdf, resolution_m<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Create VIIRS mask at 375m resolution</span></span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>viirs_mask <span class="op">=</span> create_fire_mask(viirs_gdf, resolution_m<span class="op">=</span><span class="dv">375</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="af600c86" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>viirs_mask.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-70-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="villa-del-rosario_files/figure-html/cell-70-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="2967069e" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>modis_mask.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-71-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="villa-del-rosario_files/figure-html/cell-71-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="909e08f3" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>modis_mask.rio.to_raster(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/modis_fire_mask_1km.tif"</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>viirs_mask.rio.to_raster(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/viirs_fire_mask_375m.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
</section>
<section id="incendios-1" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="incendios-1"><span class="header-section-number">14.2</span> Incendios</h2>
<div id="e28c767d" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any, Dict</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac.item <span class="im">import</span> Item</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> shape</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="90fa653b" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">'https://cmr.earthdata.nasa.gov/stac/LANCEMODIS'</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>catalog <span class="op">=</span> Client.<span class="bu">open</span>(URL)  </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>catalog.get_collection(<span class="st">"MYD14_6.1NRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="dd793bd9" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersection_percent(item: Item, aoi_geometry) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""The percentage that the Item's geometry intersects the AOI geometry."""</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    geom_item <span class="op">=</span> shape(item.geometry)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    geom_aoi <span class="op">=</span> aoi_geometry  <span class="co"># Already a geometry object</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    intersected_geom <span class="op">=</span> geom_aoi.intersection(geom_item)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    intersection_percent <span class="op">=</span> (intersected_geom.area <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> geom_aoi.area</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> intersection_percent</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geometry once and reuse it</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>aoi_geometry <span class="op">=</span> aoi.to_crs(<span class="dv">4326</span>).geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>item_search <span class="op">=</span> catalog.search(</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">"MYD14_6.1NRT"</span>], intersects<span class="op">=</span>aoi_geometry, max_items<span class="op">=</span><span class="dv">10</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>intersection_percent(item, aoi_geometry)<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item <span class="kw">in</span> item_search.items()</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="669e478d" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Client and an ItemSearch representing our search</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co"># No search operations will be performed until we call the items() method</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> Client.<span class="bu">open</span>(URL)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>item_search <span class="op">=</span> client.search(</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">"MYD14_6.1NRT"</span>], intersects<span class="op">=</span>aoi, max_items<span class="op">=</span><span class="dv">10</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="f7bb4e24" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>catalog <span class="op">=</span> Client.<span class="bu">open</span>(<span class="st">"https://cmr.earthdata.nasa.gov/stac"</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> catalog.links:</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(link.href)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="f4d37293" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Search NASA's Earthdata for VIIRS collections</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>search_url <span class="op">=</span> <span class="st">"https://cmr.earthdata.nasa.gov/search/collections.json"</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"keyword"</span>: <span class="st">"VIIRS fire"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"page_size"</span>: <span class="dv">20</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(search_url, params<span class="op">=</span>params)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"VIIRS collections available through Earthdata:"</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> data.get(<span class="st">"feed"</span>, {}).get(<span class="st">"entry"</span>, []):</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>entry<span class="sc">.</span>get(<span class="st">'title'</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>entry<span class="sc">.</span>get(<span class="st">'id'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Provider: </span><span class="sc">{</span>entry<span class="sc">.</span>get(<span class="st">'provider'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Short name: </span><span class="sc">{</span>entry<span class="sc">.</span>get(<span class="st">'short_name'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="f0d0c0dd" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Try the LPCLOUD STAC endpoint directly</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    lpcloud_catalog <span class="op">=</span> Client.<span class="bu">open</span>(<span class="st">"https://cmr.earthdata.nasa.gov/stac/LPCLOUD"</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"LPCLOUD collections:"</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> link <span class="kw">in</span> lpcloud_catalog.links:</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> link.rel <span class="op">==</span> <span class="st">"child"</span>:</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>link<span class="sc">.</span>title<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>link<span class="sc">.</span>href<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try to access VNP14A1 collection</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    vnp14a1_collection <span class="op">=</span> Client.<span class="bu">open</span>(<span class="st">"https://cmr.earthdata.nasa.gov/stac/LPCLOUD/collections/VNP14A1"</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Search for items</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>    aoi_geometry <span class="op">=</span> aoi.to_crs(<span class="dv">4326</span>).geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>    item_search <span class="op">=</span> vnp14a1_collection.search(</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>        intersects<span class="op">=</span>aoi_geometry,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>        max_items<span class="op">=</span><span class="dv">10</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> item_search.items():</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"VIIRS item: </span><span class="sc">{</span>item<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c5b0d0f6" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Try using the collection concept ID</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>collection_id <span class="op">=</span> <span class="st">"C2545314541-LPCLOUD"</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try different STAC endpoints</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    endpoints <span class="op">=</span> [</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"https://cmr.earthdata.nasa.gov/stac/LPCLOUD/collections/</span><span class="sc">{</span>collection_id<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"https://cmr.earthdata.nasa.gov/stac/ALL/collections/</span><span class="sc">{</span>collection_id<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"https://cmr.earthdata.nasa.gov/stac/collections/</span><span class="sc">{</span>collection_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> endpoint <span class="kw">in</span> endpoints:</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>            collection <span class="op">=</span> Client.<span class="bu">open</span>(endpoint)</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Successfully opened: </span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Collection: </span><span class="sc">{</span>collection<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Failed </span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="4d584624" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_collection_info(collection_id):</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Get detailed information about a VIIRS collection</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://cmr.earthdata.nasa.gov/search/collections.json"</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {<span class="st">"concept_id"</span>: collection_id}</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>        collection <span class="op">=</span> data[<span class="st">'feed'</span>][<span class="st">'entry'</span>][<span class="dv">0</span>]</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Collection: </span><span class="sc">{</span>collection[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Short Name: </span><span class="sc">{</span>collection[<span class="st">'short_name'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Description: </span><span class="sc">{</span>collection[<span class="st">'summary'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Provider: </span><span class="sc">{</span>collection<span class="sc">.</span>get(<span class="st">'provider'</span>, <span class="st">'Unknown'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Temporal Range: </span><span class="sc">{</span>collection<span class="sc">.</span>get(<span class="st">'time_start'</span>)<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>collection<span class="sc">.</span>get(<span class="st">'time_end'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> collection</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Get info about VNP14A1</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>get_collection_info(<span class="st">"C2545314541-LPCLOUD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="628d7c03" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Open LPDAAC catalog and search for the specific collection</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>lpdaac_catalog <span class="op">=</span> Client.<span class="bu">open</span>(<span class="st">"https://cmr.earthdata.nasa.gov/stac/LPDAAC_ECS"</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the viirs-14a1-001 collection</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>viirs_link <span class="op">=</span> <span class="va">None</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> lpdaac_catalog.links:</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> link.rel <span class="op">==</span> <span class="st">"child"</span> <span class="kw">and</span> <span class="st">"VNP14A1 v001"</span> <span class="kw">in</span> link.href:</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>        viirs_link <span class="op">=</span> link</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> viirs_link:</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found VIIRS collection: </span><span class="sc">{</span>viirs_link<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"URL: </span><span class="sc">{</span>viirs_link<span class="sc">.</span>href<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open the collection and search for items</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    viirs_collection <span class="op">=</span> Client.<span class="bu">open</span>(viirs_link.href)</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    aoi_geometry <span class="op">=</span> aoi.to_crs(<span class="dv">4326</span>).geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    item_search <span class="op">=</span> viirs_collection.search(</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>        intersects<span class="op">=</span>aoi_geometry,</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>        max_items<span class="op">=</span><span class="dv">10</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> item_search.items():</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"VIIRS item: </span><span class="sc">{</span>item<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"VIIRS collection not found in ALL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="4ecd9a84" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>item_search</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="4535a2fc" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Try different potential VIIRS STAC endpoints</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>potential_endpoints <span class="op">=</span> [</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://cmr.earthdata.nasa.gov/stac/LPDAAC"</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://cmr.earthdata.nasa.gov/stac/MODIS"</span>,</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://cmr.earthdata.nasa.gov/stac/VIIRS"</span>,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://cmr.earthdata.nasa.gov/stac/FIRE"</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> endpoint <span class="kw">in</span> potential_endpoints:</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>        catalog <span class="op">=</span> Client.<span class="bu">open</span>(endpoint)</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Successfully opened: </span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Collections available:"</span>)</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> link <span class="kw">in</span> catalog.links:</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> link.rel <span class="op">==</span> <span class="st">"child"</span>:</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>link<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"---"</span>)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Failed to open </span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="2cd2ca2a" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>catalog <span class="op">=</span> Client.<span class="bu">open</span>(<span class="st">"https://cmr.earthdata.nasa.gov/stac/USGS"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> catalog.links:</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(link.href)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="f88e6eab" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">'https://cmr.earthdata.nasa.gov/stac/LANCEMODIS'</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>catalog <span class="op">=</span> Client.<span class="bu">open</span>(URL)  </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>catalog.get_collection(<span class="st">"MYD14_6.1NRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9bf1dba5" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geometry once and reuse it</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>aoi_geometry <span class="op">=</span> aoi.to_crs(<span class="dv">4326</span>).geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_earthdata_auth():</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Set up NASA Earthdata authentication</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="co">    You'll need to create an account at https://urs.earthdata.nasa.gov/</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>    username <span class="op">=</span> <span class="bu">input</span>(<span class="st">"Enter your NASA Earthdata username: "</span>)</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    password <span class="op">=</span> <span class="bu">input</span>(<span class="st">"Enter your NASA Earthdata password: "</span>)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store credentials (you might want to use environment variables instead)</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    os.environ[<span class="st">'EARTHDATA_USERNAME'</span>] <span class="op">=</span> username</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    os.environ[<span class="st">'EARTHDATA_PASSWORD'</span>] <span class="op">=</span> password</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> username, password</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_viirs_granules(collection_id, aoi_geometry, start_date, end_date, max_results<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a><span class="co">    Search for VIIRS granules using CMR API</span></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    cmr_url <span class="op">=</span> <span class="st">"https://cmr.earthdata.nasa.gov/search/granules.json"</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> aoi_geometry.bounds</span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"collection_concept_id"</span>: collection_id,</span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bounding_box"</span>: <span class="ss">f"</span><span class="sc">{</span>bbox[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>bbox[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>bbox[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>bbox[<span class="dv">3</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temporal"</span>: <span class="ss">f"</span><span class="sc">{</span>start_date<span class="sc">}</span><span class="ss">T00:00:00Z,</span><span class="sc">{</span>end_date<span class="sc">}</span><span class="ss">T23:59:59Z"</span>,</span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"page_size"</span>: max_results,</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sort_key"</span>: <span class="st">"-start_date"</span></span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(cmr_url, params<span class="op">=</span>params)</span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>        granules <span class="op">=</span> data[<span class="st">'feed'</span>][<span class="st">'entry'</span>]</span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(granules)<span class="sc">}</span><span class="ss"> VIIRS granules:"</span>)</span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, granule <span class="kw">in</span> <span class="bu">enumerate</span>(granules):</span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>granule[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"     Time: </span><span class="sc">{</span>granule[<span class="st">'time_start'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"     Size: </span><span class="sc">{</span>granule<span class="sc">.</span>get(<span class="st">'granule_size'</span>, <span class="st">'Unknown'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get cloud access URLs</span></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a>            cloud_urls <span class="op">=</span> []</span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> link <span class="kw">in</span> granule[<span class="st">'links'</span>]:</span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> link[<span class="st">'rel'</span>] <span class="op">==</span> <span class="st">'http://esipfed.org/ns/fedsearch/1.1/data#'</span>:</span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>                    cloud_urls.append(link[<span class="st">'href'</span>])</span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cloud_urls:</span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"     Cloud URL: </span><span class="sc">{</span>cloud_urls[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"---"</span>)</span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> granules</span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a>collection_id <span class="op">=</span> <span class="st">"C2545314541-LPCLOUD"</span>  <span class="co"># VNP14A1</span></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> <span class="st">"2023-01-01"</span></span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> <span class="st">"2025-01-31"</span></span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a>granules <span class="op">=</span> search_viirs_granules(collection_id, aoi_geometry, start_date, end_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Found 5 VIIRS granules:
  1. VNP14A1.A2025031.h12v12.002.2025032090653
     Time: 2025-01-31T00:00:00.000Z
     Size: 0.1575489044189453
     Cloud URL: https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/VNP14A1.002/VNP14A1.A2025031.h12v12.002.2025032090653/VNP14A1.A2025031.h12v12.002.2025032090653.h5
---
  2. VNP14A1.A2025030.h12v12.002.2025031094640
     Time: 2025-01-30T00:00:00.000Z
     Size: 0.15435218811035156
     Cloud URL: https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/VNP14A1.002/VNP14A1.A2025030.h12v12.002.2025031094640/VNP14A1.A2025030.h12v12.002.2025031094640.h5
---
  3. VNP14A1.A2025029.h12v12.002.2025030094347
     Time: 2025-01-29T00:00:00.000Z
     Size: 0.1571207046508789
     Cloud URL: https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/VNP14A1.002/VNP14A1.A2025029.h12v12.002.2025030094347/VNP14A1.A2025029.h12v12.002.2025030094347.h5
---
  4. VNP14A1.A2025028.h12v12.002.2025029084239
     Time: 2025-01-28T00:00:00.000Z
     Size: 0.16545581817626953
     Cloud URL: https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/VNP14A1.002/VNP14A1.A2025028.h12v12.002.2025029084239/VNP14A1.A2025028.h12v12.002.2025029084239.h5
---
  5. VNP14A1.A2025027.h12v12.002.2025028190753
     Time: 2025-01-27T00:00:00.000Z
     Size: 0.1768970489501953
     Cloud URL: https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/VNP14A1.002/VNP14A1.A2025027.h12v12.002.2025028190753/VNP14A1.A2025027.h12v12.002.2025028190753.h5
---</code></pre>
</div>
</div>
<div id="63e236f0" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> requests.auth <span class="im">import</span> HTTPBasicAuth</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the file</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> <span class="st">"nissimlebovits"</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>password <span class="op">=</span> <span class="st">"KNsna3qk6aPEEvk"</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Downloading VIIRS file..."</span>)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(cloud_url, auth<span class="op">=</span>HTTPBasicAuth(username, password))</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"temp_viirs.h5"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>        f.write(response.content)</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open with h5py</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> h5py.File(<span class="st">"temp_viirs.h5"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>        fire_mask <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VNP_Grid_1km_2D/Data Fields/FireMask'</span>][:]</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    plt.imshow(fire_mask)</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'VIIRS Fire Mask'</span>)</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    os.remove(<span class="st">"temp_viirs.h5"</span>)</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Download failed: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading VIIRS file...
Download failed: 401</code></pre>
</div>
</div>
<div id="221b2bed" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> earthaccess</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>auth <span class="op">=</span> earthaccess.login()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d7ba3f8c" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> earthaccess</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract individual bounding box values</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> aoi.to_crs(<span class="dv">4326</span>).bounds.iloc[<span class="dv">0</span>]</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>minx, miny, maxx, maxy <span class="op">=</span> bbox</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for VIIRS data</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>viirs_data <span class="op">=</span> earthaccess.search_data(</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    short_name<span class="op">=</span><span class="st">"VNP14A1"</span>,</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    bounding_box<span class="op">=</span>(minx, miny, maxx, maxy),  <span class="co"># Pass as tuple</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    cloud_hosted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    temporal<span class="op">=</span>(<span class="st">"2001-01"</span>, <span class="st">"2021-01"</span>),</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(viirs_data)<span class="sc">}</span><span class="ss"> granules"</span>)</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co"># First, get the coordinate system and find exact pixel bounds for your AOI</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> earthaccess.<span class="bu">open</span>([viirs_data[<span class="dv">0</span>]], show_progress<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> files[<span class="dv">0</span>]</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> h5py.File(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    xdim <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/XDim'</span>][:]</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    ydim <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/YDim'</span>][:]</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform AOI to sinusoidal projection</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>aoi_sinusoidal <span class="op">=</span> aoi.to_crs(<span class="st">"EPSG:4326"</span>).to_crs(<span class="st">"+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>aoi_bounds <span class="op">=</span> aoi_sinusoidal.bounds.iloc[<span class="dv">0</span>]</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Find exact pixel indices for your AOI</span></span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>x_indices <span class="op">=</span> np.where((xdim <span class="op">&gt;=</span> aoi_bounds.iloc[<span class="dv">0</span>]) <span class="op">&amp;</span> (xdim <span class="op">&lt;=</span> aoi_bounds.iloc[<span class="dv">2</span>]))[<span class="dv">0</span>]</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>y_indices <span class="op">=</span> np.where((ydim <span class="op">&gt;=</span> aoi_bounds.iloc[<span class="dv">1</span>]) <span class="op">&amp;</span> (ydim <span class="op">&lt;=</span> aoi_bounds.iloc[<span class="dv">3</span>]))[<span class="dv">0</span>]</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cropping to </span><span class="sc">{</span><span class="bu">len</span>(y_indices)<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span><span class="bu">len</span>(x_indices)<span class="sc">}</span><span class="ss"> pixels instead of full </span><span class="sc">{</span><span class="bu">len</span>(ydim)<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span><span class="bu">len</span>(xdim)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Found 3300 granules</code></pre>
</div>
</div>
<div id="de02ace7" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Let's check what file sizes we actually have</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="co"># file_sizes = [granule.get('Size(MB)', 0) for granule in viirs_data]</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"File size range: {min(file_sizes):.3f} - {max(file_sizes):.3f} MB")</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Average file size: {np.mean(file_sizes):.3f} MB")</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check the distribution</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.hist(file_sizes, bins=50)</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('File Size (MB)')</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Count')</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Distribution of VIIRS File Sizes')</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # Let's actually check a few files manually to see what's in them</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Manually checking first 5 files...")</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, granule in enumerate(viirs_data[:5]):</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"\nFile {i+1}:")</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Size: {granule.get('Size(MB)', 0):.3f} MB")</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     try:</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         files = earthaccess.open([granule], show_progress=False)</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="co">#         file_path = files[0]</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a><span class="co">#         with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a><span class="co">#             fire_mask = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'][:]</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(f"FireMask shape: {fire_mask.shape}")</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(f"FireMask unique values: {np.unique(fire_mask)}")</span></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(f"Fire pixels (&gt;=7): {np.sum(fire_mask &gt;= 7)}")</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a><span class="co">#             # Check if our AOI area has any fire</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a><span class="co">#             if len(y_indices) &gt; 0 and len(x_indices) &gt; 0:</span></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a><span class="co">#                 aoi_fire_mask = fire_mask[y_indices, :][:, x_indices]</span></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a><span class="co">#                 print(f"AOI fire pixels: {np.sum(aoi_fire_mask &gt;= 7)}")</span></span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     except Exception as e:</span></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Error: {e}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="d3ef5338" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Process in batches to avoid memory issues</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size = 100</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fire_counts = []</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in range(0, len(viirs_data), batch_size):</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     batch = viirs_data[i:i+batch_size]</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Processing batch {i//batch_size + 1}/{(len(viirs_data)-1)//batch_size + 1}")</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Your existing efficient processing</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     lazy_arrays = [process_granule_cropped(granule) for granule in batch]</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     fire_stack = da.stack([da.from_delayed(arr, dtype=np.int8, shape=(len(y_indices), len(x_indices))) </span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                           for arr in lazy_arrays if arr is not None])</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     fire_count_batch = da.sum(fire_stack, axis=0)</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     with ProgressBar():</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co">#         fire_counts.append(fire_count_batch.compute())</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Sum all batches</span></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a><span class="co"># final_fire_count = np.sum(fire_counts, axis=0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="083d3a6c" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Let's check what's happening with the AOI cropping</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print("AOI Debugging:")</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"AOI bounds (sinusoidal): {aoi_bounds}")</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"X indices range: {x_indices.min()} to {x_indices.max()}")</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Y indices range: {y_indices.min()} to {y_indices.max()}")</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"AOI size: {len(y_indices)} x {len(x_indices)} pixels")</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Let's see where the fires actually are</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nChecking fire locations in first file...")</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co"># files = earthaccess.open([viirs_data[0]], show_progress=False)</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co"># file_path = files[0]</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="co"># with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     fire_mask = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'][:]</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     xdim = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/XDim'][:]</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     ydim = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/YDim'][:]</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Find where the fires are</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     fire_locations = np.where(fire_mask &gt;= 7)</span></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Fire locations (y, x): {list(zip(fire_locations[0][:5], fire_locations[1][:5]))}")</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Check the coordinates of fire pixels</span></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     for i in range(min(5, len(fire_locations[0]))):</span></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="co">#         y_idx, x_idx = fire_locations[0][i], fire_locations[1][i]</span></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="co">#         fire_x = xdim[x_idx]</span></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a><span class="co">#         fire_y = ydim[y_idx]</span></span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Fire {i+1}: pixel ({y_idx}, {x_idx}) -&gt; coords ({fire_x:.0f}, {fire_y:.0f})")</span></span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"\nAOI coordinate bounds:")</span></span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"X: {xdim[x_indices].min():.0f} to {xdim[x_indices].max():.0f}")</span></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Y: {ydim[y_indices].min():.0f} to {ydim[y_indices].max():.0f}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="8fa86b36" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Use file size as a proxy (fire-active files are usually larger)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quick_fire_check_by_size(granules):</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Use file size as a proxy for fire activity - much faster"""</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    fire_active <span class="op">=</span> []</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> granule <span class="kw">in</span> granules:</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get file size from granule metadata</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>        size_mb <span class="op">=</span> granule.get(<span class="st">'Size(MB)'</span>, <span class="dv">0</span>)</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># VIIRS files with fire data are typically &gt; 1MB</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Files &lt; 0.5MB are usually empty/no-fire days</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> size_mb <span class="op">&gt;</span> <span class="fl">0.5</span>:  <span class="co"># Adjust threshold as needed</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>            fire_active.append(granule)</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fire_active</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Sample approach - check every 10th file first</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sample_check(granules, sample_rate<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Check a sample of files to estimate fire activity"""</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>    sample_granules <span class="op">=</span> granules[::sample_rate]  <span class="co"># Every 10th file</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>    fire_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> granule <span class="kw">in</span> sample_granules:</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>            files <span class="op">=</span> earthaccess.<span class="bu">open</span>([granule], show_progress<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> files[<span class="dv">0</span>]</span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> h5py.File(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>                fire_mask <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'</span>][y_indices, :][:, x_indices]</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> np.<span class="bu">any</span>(fire_mask <span class="op">&gt;=</span> <span class="dv">7</span>):</span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>                    fire_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a>    fire_rate <span class="op">=</span> fire_count <span class="op">/</span> <span class="bu">len</span>(sample_granules)</span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Estimated fire activity rate: </span><span class="sc">{</span>fire_rate<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fire_rate</span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Try the fast approach first</span></span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Quick check by file size..."</span>)</span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a>fire_active_by_size <span class="op">=</span> quick_fire_check_by_size(viirs_data)</span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(fire_active_by_size)<span class="sc">}</span><span class="ss"> potentially fire-active files"</span>)</span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample check to validate</span></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sampling to validate..."</span>)</span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a>fire_rate <span class="op">=</span> sample_check(viirs_data[:<span class="dv">100</span>])  <span class="co"># Check first 100 files</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quick check by file size...
Found 0 potentially fire-active files
Sampling to validate...
Estimated fire activity rate: 0.00%</code></pre>
</div>
</div>
<div id="cff789d9" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import earthaccess</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import h5py</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import dask.array as da</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from dask.delayed import delayed</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from dask.diagnostics import ProgressBar</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # 1. Check current cache settings</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="co"># files = earthaccess.open([viirs_data[0]], show_progress=False)</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="co"># file_handler = files[0]</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Current cache settings:")</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(file_handler.f.cache)</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # 2. Try optimized cache settings for HDF5</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Based on docs: align block size with HDF5 chunk size</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a><span class="co"># optimized_open_kwargs = {</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     'block_size': 16 * 1024 * 1024,  # 16MB blocks (for large files)</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     'cache_type': 'blockcache'  # Use blockcache instead of readahead</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a><span class="co"># files_optimized = earthaccess.open([viirs_data[0]], </span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  open_kwargs=optimized_open_kwargs, </span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  show_progress=False)</span></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a><span class="co"># file_handler_opt = files_optimized[0]</span></span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nOptimized cache settings:")</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print(file_handler_opt.f.cache)</span></span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3. Test different batch sizes</span></span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a><span class="co"># def test_batch_performance(batch_size):</span></span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"\nTesting batch size: {batch_size}")</span></span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-32"><a href="#cb120-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     @delayed</span></span>
<span id="cb120-33"><a href="#cb120-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     def process_batch(granules_batch):</span></span>
<span id="cb120-34"><a href="#cb120-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         results = []</span></span>
<span id="cb120-35"><a href="#cb120-35" aria-hidden="true" tabindex="-1"></a><span class="co">#         files = earthaccess.open(granules_batch, </span></span>
<span id="cb120-36"><a href="#cb120-36" aria-hidden="true" tabindex="-1"></a><span class="co">#                                open_kwargs=optimized_open_kwargs,</span></span>
<span id="cb120-37"><a href="#cb120-37" aria-hidden="true" tabindex="-1"></a><span class="co">#                                show_progress=False)</span></span>
<span id="cb120-38"><a href="#cb120-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb120-39"><a href="#cb120-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         for file_path in files:</span></span>
<span id="cb120-40"><a href="#cb120-40" aria-hidden="true" tabindex="-1"></a><span class="co">#             try:</span></span>
<span id="cb120-41"><a href="#cb120-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                 with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb120-42"><a href="#cb120-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                     fire_mask = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'][y_indices, :][:, x_indices]</span></span>
<span id="cb120-43"><a href="#cb120-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                     results.append((fire_mask &gt;= 7).astype(np.int8))</span></span>
<span id="cb120-44"><a href="#cb120-44" aria-hidden="true" tabindex="-1"></a><span class="co">#             except Exception as e:</span></span>
<span id="cb120-45"><a href="#cb120-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                 print(f"Error: {e}")</span></span>
<span id="cb120-46"><a href="#cb120-46" aria-hidden="true" tabindex="-1"></a><span class="co">#                 results.append(None)</span></span>
<span id="cb120-47"><a href="#cb120-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb120-48"><a href="#cb120-48" aria-hidden="true" tabindex="-1"></a><span class="co">#         return results</span></span>
<span id="cb120-49"><a href="#cb120-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-50"><a href="#cb120-50" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Test with first batch_size granules</span></span>
<span id="cb120-51"><a href="#cb120-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     test_granules = viirs_data[:batch_size]</span></span>
<span id="cb120-52"><a href="#cb120-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     batch_results = process_batch(test_granules)</span></span>
<span id="cb120-53"><a href="#cb120-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-54"><a href="#cb120-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     return batch_results</span></span>
<span id="cb120-55"><a href="#cb120-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-56"><a href="#cb120-56" aria-hidden="true" tabindex="-1"></a><span class="co"># # 4. Test different batch sizes</span></span>
<span id="cb120-57"><a href="#cb120-57" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_sizes = [1, 5, 10, 20]</span></span>
<span id="cb120-58"><a href="#cb120-58" aria-hidden="true" tabindex="-1"></a><span class="co"># for batch_size in batch_sizes:</span></span>
<span id="cb120-59"><a href="#cb120-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     if batch_size &lt;= len(viirs_data):</span></span>
<span id="cb120-60"><a href="#cb120-60" aria-hidden="true" tabindex="-1"></a><span class="co">#         result = test_batch_performance(batch_size)</span></span>
<span id="cb120-61"><a href="#cb120-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Batch size {batch_size}: {result}")</span></span>
<span id="cb120-62"><a href="#cb120-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-63"><a href="#cb120-63" aria-hidden="true" tabindex="-1"></a><span class="co"># # 5. Check if files are cloud-optimized</span></span>
<span id="cb120-64"><a href="#cb120-64" aria-hidden="true" tabindex="-1"></a><span class="co"># def check_file_optimization(file_handler):</span></span>
<span id="cb120-65"><a href="#cb120-65" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"\nFile optimization check:")</span></span>
<span id="cb120-66"><a href="#cb120-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     cache = file_handler.f.cache</span></span>
<span id="cb120-67"><a href="#cb120-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-68"><a href="#cb120-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Different cache types have different attributes</span></span>
<span id="cb120-69"><a href="#cb120-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     if hasattr(cache, 'block_size'):</span></span>
<span id="cb120-70"><a href="#cb120-70" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Block size: {cache.block_size}")</span></span>
<span id="cb120-71"><a href="#cb120-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     elif hasattr(cache, 'blocksize'):</span></span>
<span id="cb120-72"><a href="#cb120-72" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Block size: {cache.blocksize}")</span></span>
<span id="cb120-73"><a href="#cb120-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb120-74"><a href="#cb120-74" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Block size: Not available")</span></span>
<span id="cb120-75"><a href="#cb120-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-76"><a href="#cb120-76" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Cache type: {type(cache).__name__}")</span></span>
<span id="cb120-77"><a href="#cb120-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Cache info: {cache}")</span></span>
<span id="cb120-78"><a href="#cb120-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-79"><a href="#cb120-79" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Test metadata access speed</span></span>
<span id="cb120-80"><a href="#cb120-80" aria-hidden="true" tabindex="-1"></a><span class="co">#     import time</span></span>
<span id="cb120-81"><a href="#cb120-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     start = time.time()</span></span>
<span id="cb120-82"><a href="#cb120-82" aria-hidden="true" tabindex="-1"></a><span class="co">#     with h5py.File(file_handler, 'r') as f:</span></span>
<span id="cb120-83"><a href="#cb120-83" aria-hidden="true" tabindex="-1"></a><span class="co">#         # Try to access metadata</span></span>
<span id="cb120-84"><a href="#cb120-84" aria-hidden="true" tabindex="-1"></a><span class="co">#         attrs = f.attrs</span></span>
<span id="cb120-85"><a href="#cb120-85" aria-hidden="true" tabindex="-1"></a><span class="co">#         groups = list(f.keys())</span></span>
<span id="cb120-86"><a href="#cb120-86" aria-hidden="true" tabindex="-1"></a><span class="co">#     end = time.time()</span></span>
<span id="cb120-87"><a href="#cb120-87" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Metadata access time: {end - start:.2f} seconds")</span></span>
<span id="cb120-88"><a href="#cb120-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-89"><a href="#cb120-89" aria-hidden="true" tabindex="-1"></a><span class="co">#     return end - start</span></span>
<span id="cb120-90"><a href="#cb120-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-91"><a href="#cb120-91" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check optimization</span></span>
<span id="cb120-92"><a href="#cb120-92" aria-hidden="true" tabindex="-1"></a><span class="co"># metadata_time = check_file_optimization(file_handler_opt)</span></span>
<span id="cb120-93"><a href="#cb120-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-94"><a href="#cb120-94" aria-hidden="true" tabindex="-1"></a><span class="co"># # 6. Try different cache configurations</span></span>
<span id="cb120-95"><a href="#cb120-95" aria-hidden="true" tabindex="-1"></a><span class="co"># cache_configs = [</span></span>
<span id="cb120-96"><a href="#cb120-96" aria-hidden="true" tabindex="-1"></a><span class="co">#     {'block_size': 4 * 1024 * 1024, 'cache_type': 'blockcache'},   # 4MB</span></span>
<span id="cb120-97"><a href="#cb120-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     {'block_size': 8 * 1024 * 1024, 'cache_type': 'blockcache'},   # 8MB  </span></span>
<span id="cb120-98"><a href="#cb120-98" aria-hidden="true" tabindex="-1"></a><span class="co">#     {'block_size': 16 * 1024 * 1024, 'cache_type': 'blockcache'},  # 16MB</span></span>
<span id="cb120-99"><a href="#cb120-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     {'block_size': 32 * 1024 * 1024, 'cache_type': 'blockcache'}, # 32MB</span></span>
<span id="cb120-100"><a href="#cb120-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ]</span></span>
<span id="cb120-101"><a href="#cb120-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-102"><a href="#cb120-102" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nTesting different cache configurations:")</span></span>
<span id="cb120-103"><a href="#cb120-103" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, config in enumerate(cache_configs):</span></span>
<span id="cb120-104"><a href="#cb120-104" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"\nConfig {i+1}: {config}")</span></span>
<span id="cb120-105"><a href="#cb120-105" aria-hidden="true" tabindex="-1"></a><span class="co">#     files_test = earthaccess.open([viirs_data[0]], </span></span>
<span id="cb120-106"><a href="#cb120-106" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 open_kwargs=config, </span></span>
<span id="cb120-107"><a href="#cb120-107" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 show_progress=False)</span></span>
<span id="cb120-108"><a href="#cb120-108" aria-hidden="true" tabindex="-1"></a><span class="co">#     file_test = files_test[0]</span></span>
<span id="cb120-109"><a href="#cb120-109" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"Cache: {file_test.f.cache}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="3347bef4" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> earthaccess</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dask.delayed <span class="im">import</span> delayed</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dask.diagnostics <span class="im">import</span> ProgressBar</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract individual bounding box values</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> aoi.to_crs(<span class="dv">4326</span>).bounds.iloc[<span class="dv">0</span>]</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>minx, miny, maxx, maxy <span class="op">=</span> bbox</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for VIIRS data</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>viirs_data <span class="op">=</span> earthaccess.search_data(</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>    short_name<span class="op">=</span><span class="st">"VNP14A1"</span>,</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>    bounding_box<span class="op">=</span>(minx, miny, maxx, maxy),</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>    cloud_hosted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>    temporal<span class="op">=</span>(<span class="st">"2020-01"</span>, <span class="st">"2021-01"</span>),</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(viirs_data)<span class="sc">}</span><span class="ss"> granules"</span>)</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coordinate system and find exact pixel bounds</span></span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> earthaccess.<span class="bu">open</span>([viirs_data[<span class="dv">0</span>]], show_progress<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> files[<span class="dv">0</span>]</span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> h5py.File(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>    xdim <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/XDim'</span>][:]</span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>    ydim <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/YDim'</span>][:]</span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform AOI to sinusoidal projection</span></span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a>aoi_sinusoidal <span class="op">=</span> aoi.to_crs(<span class="st">"EPSG:4326"</span>).to_crs(<span class="st">"+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>aoi_bounds <span class="op">=</span> aoi_sinusoidal.bounds.iloc[<span class="dv">0</span>]</span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Find exact pixel indices for your AOI</span></span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a>x_indices <span class="op">=</span> np.where((xdim <span class="op">&gt;=</span> aoi_bounds.iloc[<span class="dv">0</span>]) <span class="op">&amp;</span> (xdim <span class="op">&lt;=</span> aoi_bounds.iloc[<span class="dv">2</span>]))[<span class="dv">0</span>]</span>
<span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a>y_indices <span class="op">=</span> np.where((ydim <span class="op">&gt;=</span> aoi_bounds.iloc[<span class="dv">1</span>]) <span class="op">&amp;</span> (ydim <span class="op">&lt;=</span> aoi_bounds.iloc[<span class="dv">3</span>]))[<span class="dv">0</span>]</span>
<span id="cb121-37"><a href="#cb121-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cropping to </span><span class="sc">{</span><span class="bu">len</span>(y_indices)<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span><span class="bu">len</span>(x_indices)<span class="sc">}</span><span class="ss"> pixels instead of full </span><span class="sc">{</span><span class="bu">len</span>(ydim)<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span><span class="bu">len</span>(xdim)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Efficient lazy function that only loads the cropped area</span></span>
<span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a><span class="at">@delayed</span></span>
<span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_granule_cropped(granule):</span>
<span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a>        files <span class="op">=</span> earthaccess.<span class="bu">open</span>([granule], show_progress<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> files[<span class="dv">0</span>]</span>
<span id="cb121-46"><a href="#cb121-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb121-47"><a href="#cb121-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> h5py.File(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use advanced indexing to load only the pixels we need</span></span>
<span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a>            fire_mask <span class="op">=</span> f[<span class="st">'HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'</span>][y_indices, :][:, x_indices]</span>
<span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (fire_mask <span class="op">&gt;=</span> <span class="dv">7</span>).astype(np.int8)</span>
<span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error processing granule: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Create lazy arrays for cropped data only</span></span>
<span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Creating lazy arrays for </span><span class="sc">{</span><span class="bu">len</span>(viirs_data)<span class="sc">}</span><span class="ss"> granules..."</span>)</span>
<span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a>lazy_arrays <span class="op">=</span> [process_granule_cropped(granule) <span class="cf">for</span> granule <span class="kw">in</span> viirs_data]</span>
<span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-59"><a href="#cb121-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack into dask array with correct cropped dimensions</span></span>
<span id="cb121-60"><a href="#cb121-60" aria-hidden="true" tabindex="-1"></a>fire_stack <span class="op">=</span> da.stack([da.from_delayed(arr, dtype<span class="op">=</span>np.int8, shape<span class="op">=</span>(<span class="bu">len</span>(y_indices), <span class="bu">len</span>(x_indices))) </span>
<span id="cb121-61"><a href="#cb121-61" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">for</span> arr <span class="kw">in</span> lazy_arrays <span class="cf">if</span> arr <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb121-62"><a href="#cb121-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-63"><a href="#cb121-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum across time dimension</span></span>
<span id="cb121-64"><a href="#cb121-64" aria-hidden="true" tabindex="-1"></a>fire_count_map <span class="op">=</span> da.<span class="bu">sum</span>(fire_stack, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb121-65"><a href="#cb121-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-66"><a href="#cb121-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute with progress bar</span></span>
<span id="cb121-67"><a href="#cb121-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Computing fire count map..."</span>)</span>
<span id="cb121-68"><a href="#cb121-68" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ProgressBar():</span>
<span id="cb121-69"><a href="#cb121-69" aria-hidden="true" tabindex="-1"></a>    fire_count_result <span class="op">=</span> fire_count_map.compute()  <span class="co"># Fixed: was fire_count_result.compute()</span></span>
<span id="cb121-70"><a href="#cb121-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-71"><a href="#cb121-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot directly (no need to crop again)</span></span>
<span id="cb121-72"><a href="#cb121-72" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb121-73"><a href="#cb121-73" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> plt.imshow(fire_count_result, cmap<span class="op">=</span><span class="st">'Reds'</span>, </span>
<span id="cb121-74"><a href="#cb121-74" aria-hidden="true" tabindex="-1"></a>               extent<span class="op">=</span>[xdim[x_indices].<span class="bu">min</span>(), xdim[x_indices].<span class="bu">max</span>(), </span>
<span id="cb121-75"><a href="#cb121-75" aria-hidden="true" tabindex="-1"></a>                      ydim[y_indices].<span class="bu">min</span>(), ydim[y_indices].<span class="bu">max</span>()])</span>
<span id="cb121-76"><a href="#cb121-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-77"><a href="#cb121-77" aria-hidden="true" tabindex="-1"></a>aoi_sinusoidal.boundary.plot(ax<span class="op">=</span>plt.gca(), color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb121-78"><a href="#cb121-78" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Fire Observation Count (</span><span class="sc">{</span><span class="bu">len</span>(viirs_data)<span class="sc">}</span><span class="ss"> days)'</span>)</span>
<span id="cb121-79"><a href="#cb121-79" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'X (meters)'</span>)</span>
<span id="cb121-80"><a href="#cb121-80" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Y (meters)'</span>)</span>
<span id="cb121-81"><a href="#cb121-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-82"><a href="#cb121-82" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im)</span>
<span id="cb121-83"><a href="#cb121-83" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Number of Fire Observations'</span>)</span>
<span id="cb121-84"><a href="#cb121-84" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb121-85"><a href="#cb121-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-86"><a href="#cb121-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maximum fire observations: </span><span class="sc">{</span>fire_count_result<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ac8c8823" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import earthaccess</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import h5py</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import dask.array as da</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from dask.delayed import delayed</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from dask.diagnostics import ProgressBar</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract individual bounding box values</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a><span class="co"># bbox = aoi.to_crs(4326).bounds.iloc[0]</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="co"># minx, miny, maxx, maxy = bbox</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Search for VIIRS data</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a><span class="co"># viirs_data = earthaccess.search_data(</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     short_name="VNP14A1",</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     bounding_box=(minx, miny, maxx, maxy),</span></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     cloud_hosted=True,</span></span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     temporal=("2001-01", "2021-01"),</span></span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Found {len(viirs_data)} granules")</span></span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get coordinate system and find exact pixel bounds</span></span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a><span class="co"># files = earthaccess.open([viirs_data[0]], show_progress=False)</span></span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a><span class="co"># file_path = files[0]</span></span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-26"><a href="#cb122-26" aria-hidden="true" tabindex="-1"></a><span class="co"># with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb122-27"><a href="#cb122-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     xdim = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/XDim'][:]</span></span>
<span id="cb122-28"><a href="#cb122-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     ydim = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/YDim'][:]</span></span>
<span id="cb122-29"><a href="#cb122-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-30"><a href="#cb122-30" aria-hidden="true" tabindex="-1"></a><span class="co"># # Transform AOI to sinusoidal projection</span></span>
<span id="cb122-31"><a href="#cb122-31" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_sinusoidal = aoi.to_crs("EPSG:4326").to_crs("+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs")</span></span>
<span id="cb122-32"><a href="#cb122-32" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_bounds = aoi_sinusoidal.bounds.iloc[0]</span></span>
<span id="cb122-33"><a href="#cb122-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-34"><a href="#cb122-34" aria-hidden="true" tabindex="-1"></a><span class="co"># # Find exact pixel indices for your AOI</span></span>
<span id="cb122-35"><a href="#cb122-35" aria-hidden="true" tabindex="-1"></a><span class="co"># x_indices = np.where((xdim &gt;= aoi_bounds.iloc[0]) &amp; (xdim &lt;= aoi_bounds.iloc[2]))[0]</span></span>
<span id="cb122-36"><a href="#cb122-36" aria-hidden="true" tabindex="-1"></a><span class="co"># y_indices = np.where((ydim &gt;= aoi_bounds.iloc[1]) &amp; (ydim &lt;= aoi_bounds.iloc[3]))[0]</span></span>
<span id="cb122-37"><a href="#cb122-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-38"><a href="#cb122-38" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Cropping to {len(y_indices)} x {len(x_indices)} pixels instead of full {len(ydim)} x {len(xdim)}")</span></span>
<span id="cb122-39"><a href="#cb122-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-40"><a href="#cb122-40" aria-hidden="true" tabindex="-1"></a><span class="co"># # Efficient lazy function that only loads the cropped area</span></span>
<span id="cb122-41"><a href="#cb122-41" aria-hidden="true" tabindex="-1"></a><span class="co"># @delayed</span></span>
<span id="cb122-42"><a href="#cb122-42" aria-hidden="true" tabindex="-1"></a><span class="co"># def process_granule_cropped(granule):</span></span>
<span id="cb122-43"><a href="#cb122-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     try:</span></span>
<span id="cb122-44"><a href="#cb122-44" aria-hidden="true" tabindex="-1"></a><span class="co">#         files = earthaccess.open([granule], show_progress=False)</span></span>
<span id="cb122-45"><a href="#cb122-45" aria-hidden="true" tabindex="-1"></a><span class="co">#         file_path = files[0]</span></span>
<span id="cb122-46"><a href="#cb122-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb122-47"><a href="#cb122-47" aria-hidden="true" tabindex="-1"></a><span class="co">#         with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb122-48"><a href="#cb122-48" aria-hidden="true" tabindex="-1"></a><span class="co">#             # Use advanced indexing to load only the pixels we need</span></span>
<span id="cb122-49"><a href="#cb122-49" aria-hidden="true" tabindex="-1"></a><span class="co">#             fire_mask = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'][y_indices, :][:, x_indices]</span></span>
<span id="cb122-50"><a href="#cb122-50" aria-hidden="true" tabindex="-1"></a><span class="co">#             return (fire_mask &gt;= 7).astype(np.int8)</span></span>
<span id="cb122-51"><a href="#cb122-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     except Exception as e:</span></span>
<span id="cb122-52"><a href="#cb122-52" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Error processing granule: {e}")</span></span>
<span id="cb122-53"><a href="#cb122-53" aria-hidden="true" tabindex="-1"></a><span class="co">#         return None</span></span>
<span id="cb122-54"><a href="#cb122-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-55"><a href="#cb122-55" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create lazy arrays for cropped data only</span></span>
<span id="cb122-56"><a href="#cb122-56" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Creating lazy arrays for {len(viirs_data)} granules...")</span></span>
<span id="cb122-57"><a href="#cb122-57" aria-hidden="true" tabindex="-1"></a><span class="co"># lazy_arrays = [process_granule_cropped(granule) for granule in viirs_data]</span></span>
<span id="cb122-58"><a href="#cb122-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-59"><a href="#cb122-59" aria-hidden="true" tabindex="-1"></a><span class="co"># # Stack into dask array with correct cropped dimensions</span></span>
<span id="cb122-60"><a href="#cb122-60" aria-hidden="true" tabindex="-1"></a><span class="co"># fire_stack = da.stack([da.from_delayed(arr, dtype=np.int8, shape=(len(y_indices), len(x_indices))) </span></span>
<span id="cb122-61"><a href="#cb122-61" aria-hidden="true" tabindex="-1"></a><span class="co">#                       for arr in lazy_arrays if arr is not None])</span></span>
<span id="cb122-62"><a href="#cb122-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-63"><a href="#cb122-63" aria-hidden="true" tabindex="-1"></a><span class="co"># # Sum across time dimension</span></span>
<span id="cb122-64"><a href="#cb122-64" aria-hidden="true" tabindex="-1"></a><span class="co"># fire_count_map = da.sum(fire_stack, axis=0)</span></span>
<span id="cb122-65"><a href="#cb122-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-66"><a href="#cb122-66" aria-hidden="true" tabindex="-1"></a><span class="co"># # Compute with progress bar</span></span>
<span id="cb122-67"><a href="#cb122-67" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Computing fire count map...")</span></span>
<span id="cb122-68"><a href="#cb122-68" aria-hidden="true" tabindex="-1"></a><span class="co"># with ProgressBar():</span></span>
<span id="cb122-69"><a href="#cb122-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     fire_count_result = fire_count_map.compute()  # Fixed: was fire_count_result.compute()</span></span>
<span id="cb122-70"><a href="#cb122-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-71"><a href="#cb122-71" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot directly (no need to crop again)</span></span>
<span id="cb122-72"><a href="#cb122-72" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(12, 8))</span></span>
<span id="cb122-73"><a href="#cb122-73" aria-hidden="true" tabindex="-1"></a><span class="co"># im = plt.imshow(fire_count_result, cmap='Reds', </span></span>
<span id="cb122-74"><a href="#cb122-74" aria-hidden="true" tabindex="-1"></a><span class="co">#                extent=[xdim[x_indices].min(), xdim[x_indices].max(), </span></span>
<span id="cb122-75"><a href="#cb122-75" aria-hidden="true" tabindex="-1"></a><span class="co">#                       ydim[y_indices].min(), ydim[y_indices].max()])</span></span>
<span id="cb122-76"><a href="#cb122-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-77"><a href="#cb122-77" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_sinusoidal.boundary.plot(ax=plt.gca(), color='black', linewidth=2)</span></span>
<span id="cb122-78"><a href="#cb122-78" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title(f'Fire Observation Count ({len(viirs_data)} days)')</span></span>
<span id="cb122-79"><a href="#cb122-79" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('X (meters)')</span></span>
<span id="cb122-80"><a href="#cb122-80" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Y (meters)')</span></span>
<span id="cb122-81"><a href="#cb122-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-82"><a href="#cb122-82" aria-hidden="true" tabindex="-1"></a><span class="co"># cbar = plt.colorbar(im)</span></span>
<span id="cb122-83"><a href="#cb122-83" aria-hidden="true" tabindex="-1"></a><span class="co"># cbar.set_label('Number of Fire Observations')</span></span>
<span id="cb122-84"><a href="#cb122-84" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb122-85"><a href="#cb122-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-86"><a href="#cb122-86" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Maximum fire observations: {fire_count_result.max()}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="b0cef246" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import dask.array as da</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import h5py</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co"># import geopandas as gpd</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from dask.delayed import delayed</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co"># import warnings</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Use context manager to ensure no progress bars</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="co"># from dask.diagnostics import ProgressBar</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="co"># import dask</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # Suppress warnings</span></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a><span class="co"># warnings.filterwarnings('ignore', category=FutureWarning)</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="co"># @delayed</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="co"># def process_granule_lazy(granule):</span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     """Lazy processing of a single granule"""</span></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     try:</span></span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         files = earthaccess.open([granule])</span></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a><span class="co">#         file_path = files[0]</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a><span class="co">#         with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a><span class="co">#             fire_mask = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/Data Fields/FireMask'][:]</span></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a><span class="co">#             return (fire_mask &gt;= 7).astype(np.int8)</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     except Exception as e:</span></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Error processing granule: {e}")</span></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         return None</span></span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create lazy arrays for all granules</span></span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Creating lazy arrays for {len(viirs_data)} granules...")</span></span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a><span class="co"># lazy_arrays = [process_granule_lazy(granule) for granule in viirs_data]</span></span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a><span class="co"># # Stack into a single dask array (lazy - no computation yet)</span></span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Stacking lazy arrays...")</span></span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a><span class="co"># fire_stack = da.stack([da.from_delayed(arr, dtype=np.int8, shape=(1200, 1200)) </span></span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a><span class="co">#                       for arr in lazy_arrays if arr is not None])</span></span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a><span class="co"># # Sum across time dimension (still lazy!)</span></span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Computing fire count map (lazy)...")</span></span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a><span class="co"># fire_count_map = da.sum(fire_stack, axis=0)</span></span>
<span id="cb123-43"><a href="#cb123-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-44"><a href="#cb123-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get coordinate info from first granule</span></span>
<span id="cb123-45"><a href="#cb123-45" aria-hidden="true" tabindex="-1"></a><span class="co"># files = earthaccess.open([viirs_data[0]])</span></span>
<span id="cb123-46"><a href="#cb123-46" aria-hidden="true" tabindex="-1"></a><span class="co"># file_path = files[0]</span></span>
<span id="cb123-47"><a href="#cb123-47" aria-hidden="true" tabindex="-1"></a><span class="co"># with h5py.File(file_path, 'r') as f:</span></span>
<span id="cb123-48"><a href="#cb123-48" aria-hidden="true" tabindex="-1"></a><span class="co">#     xdim = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/XDim'][:]</span></span>
<span id="cb123-49"><a href="#cb123-49" aria-hidden="true" tabindex="-1"></a><span class="co">#     ydim = f['HDFEOS/GRIDS/VIIRS_Grid_Daily_Fire/YDim'][:]</span></span>
<span id="cb123-50"><a href="#cb123-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-51"><a href="#cb123-51" aria-hidden="true" tabindex="-1"></a><span class="co"># # Transform AOI and crop</span></span>
<span id="cb123-52"><a href="#cb123-52" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_sinusoidal = aoi.to_crs("EPSG:4326").to_crs("+proj=sinu +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs")</span></span>
<span id="cb123-53"><a href="#cb123-53" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_bounds = aoi_sinusoidal.bounds.iloc[0]</span></span>
<span id="cb123-54"><a href="#cb123-54" aria-hidden="true" tabindex="-1"></a><span class="co"># x_mask = (xdim &gt;= aoi_bounds.iloc[0]) &amp; (xdim &lt;= aoi_bounds.iloc[2])</span></span>
<span id="cb123-55"><a href="#cb123-55" aria-hidden="true" tabindex="-1"></a><span class="co"># y_mask = (ydim &gt;= aoi_bounds.iloc[1]) &amp; (ydim &lt;= aoi_bounds.iloc[3])</span></span>
<span id="cb123-56"><a href="#cb123-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-57"><a href="#cb123-57" aria-hidden="true" tabindex="-1"></a><span class="co"># # Crop the lazy array</span></span>
<span id="cb123-58"><a href="#cb123-58" aria-hidden="true" tabindex="-1"></a><span class="co"># fire_count_cropped = fire_count_map[y_mask][:, x_mask]</span></span>
<span id="cb123-59"><a href="#cb123-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-60"><a href="#cb123-60" aria-hidden="true" tabindex="-1"></a><span class="co"># # Now compute the result with NO progress bars</span></span>
<span id="cb123-61"><a href="#cb123-61" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Computing final result...")</span></span>
<span id="cb123-62"><a href="#cb123-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-63"><a href="#cb123-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-64"><a href="#cb123-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-65"><a href="#cb123-65" aria-hidden="true" tabindex="-1"></a><span class="co"># # Temporarily disable all callbacks</span></span>
<span id="cb123-66"><a href="#cb123-66" aria-hidden="true" tabindex="-1"></a><span class="co"># original_callbacks = dask.callbacks.Callback.active.copy()</span></span>
<span id="cb123-67"><a href="#cb123-67" aria-hidden="true" tabindex="-1"></a><span class="co"># dask.callbacks.Callback.active.clear()</span></span>
<span id="cb123-68"><a href="#cb123-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-69"><a href="#cb123-69" aria-hidden="true" tabindex="-1"></a><span class="co"># try:</span></span>
<span id="cb123-70"><a href="#cb123-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     fire_count_result = fire_count_cropped.compute()</span></span>
<span id="cb123-71"><a href="#cb123-71" aria-hidden="true" tabindex="-1"></a><span class="co"># finally:</span></span>
<span id="cb123-72"><a href="#cb123-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Restore original callbacks</span></span>
<span id="cb123-73"><a href="#cb123-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     dask.callbacks.Callback.active.update(original_callbacks)</span></span>
<span id="cb123-74"><a href="#cb123-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-75"><a href="#cb123-75" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot</span></span>
<span id="cb123-76"><a href="#cb123-76" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(12, 8))</span></span>
<span id="cb123-77"><a href="#cb123-77" aria-hidden="true" tabindex="-1"></a><span class="co"># im = plt.imshow(fire_count_result, cmap='Reds', </span></span>
<span id="cb123-78"><a href="#cb123-78" aria-hidden="true" tabindex="-1"></a><span class="co">#                extent=[xdim[x_mask].min(), xdim[x_mask].max(), </span></span>
<span id="cb123-79"><a href="#cb123-79" aria-hidden="true" tabindex="-1"></a><span class="co">#                       ydim[y_mask].min(), ydim[y_mask].max()])</span></span>
<span id="cb123-80"><a href="#cb123-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-81"><a href="#cb123-81" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_sinusoidal.boundary.plot(ax=plt.gca(), color='black', linewidth=2)</span></span>
<span id="cb123-82"><a href="#cb123-82" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title(f'Fire Observation Count ({len(viirs_data)} days)')</span></span>
<span id="cb123-83"><a href="#cb123-83" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlabel('X (meters)')</span></span>
<span id="cb123-84"><a href="#cb123-84" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylabel('Y (meters)')</span></span>
<span id="cb123-85"><a href="#cb123-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-86"><a href="#cb123-86" aria-hidden="true" tabindex="-1"></a><span class="co"># cbar = plt.colorbar(im)</span></span>
<span id="cb123-87"><a href="#cb123-87" aria-hidden="true" tabindex="-1"></a><span class="co"># cbar.set_label('Number of Fire Observations')</span></span>
<span id="cb123-88"><a href="#cb123-88" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb123-89"><a href="#cb123-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-90"><a href="#cb123-90" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Maximum fire observations: {fire_count_result.max()}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
</section>
<section id="cobertura-del-suelo" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="cobertura-del-suelo"><span class="header-section-number">14.3</span> Cobertura del suelo</h2>
<div id="c00cc2b6" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="71cc64af" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the cloud GeoTIFF clipped to your GeoDataFrame</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>suelo_2022_ruta <span class="op">=</span> <span class="st">"https://storage.googleapis.com/mapbiomas-public/initiatives/argentina/collection-1/coverage/argentina_coverage_2022.tif"</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>suelo_2022 <span class="op">=</span> rio.open_rasterio(</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    suelo_2022_ruta,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="3a59b301" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip with from_disk=True for memory efficiency</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>suelo_2022 <span class="op">=</span> suelo_2022.rio.clip(</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    aoi.geometry.values, </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># aoi.buffer(1000 * 20).geometry.values, # clip to 200km buffer: </span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    aoi.crs,</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    from_disk<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="18da402b" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>suelo_2022.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-105-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="villa-del-rosario_files/figure-html/cell-105-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="7a07face" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># suelo_2022.rio.to_raster("/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/suelo_2022.tif")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="96088502" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the detailed categories and colors</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>categories_detailed <span class="op">=</span> {</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LeÃ±osa cerrada'</span>: {<span class="st">'ids'</span>: [<span class="dv">3</span>], <span class="st">'color'</span>: <span class="st">'#1f8d49'</span>},</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LeÃ±osa abierta'</span>: {<span class="st">'ids'</span>: [<span class="dv">4</span>], <span class="st">'color'</span>: <span class="st">'#7dc975'</span>},</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LeÃ±osa dispersa'</span>: {<span class="st">'ids'</span>: [<span class="dv">45</span>], <span class="st">'color'</span>: <span class="st">'#807a40'</span>},</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LeÃ±osa inundable'</span>: {<span class="st">'ids'</span>: [<span class="dv">6</span>], <span class="st">'color'</span>: <span class="st">'#026975'</span>},</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'VegetaciÃ³n no leÃ±osa inundable'</span>: {<span class="st">'ids'</span>: [<span class="dv">11</span>], <span class="st">'color'</span>: <span class="st">'#519799'</span>},</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pastizal'</span>: {<span class="st">'ids'</span>: [<span class="dv">12</span>], <span class="st">'color'</span>: <span class="st">'#d6bc74'</span>},</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Estepa'</span>: {<span class="st">'ids'</span>: [<span class="dv">63</span>], <span class="st">'color'</span>: <span class="st">'#ebf8b5'</span>},</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pastura'</span>: {<span class="st">'ids'</span>: [<span class="dv">15</span>], <span class="st">'color'</span>: <span class="st">'#edde8e'</span>},</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Agricultura'</span>: {<span class="st">'ids'</span>: [<span class="dv">18</span>], <span class="st">'color'</span>: <span class="st">'#e974ed'</span>},</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PlantaciÃ³n forestal'</span>: {<span class="st">'ids'</span>: [<span class="dv">9</span>], <span class="st">'color'</span>: <span class="st">'#7a5900'</span>},</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Cultivo arbustivo'</span>: {<span class="st">'ids'</span>: [<span class="dv">36</span>], <span class="st">'color'</span>: <span class="st">'#d082de'</span>},</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mosaico agropecuario'</span>: {<span class="st">'ids'</span>: [<span class="dv">21</span>], <span class="st">'color'</span>: <span class="st">'#ffefc3'</span>},</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ãrea sin vegetaciÃ³n'</span>: {<span class="st">'ids'</span>: [<span class="dv">22</span>], <span class="st">'color'</span>: <span class="st">'#d4271e'</span>},</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RÃ­o, lago u ocÃ©ano'</span>: {<span class="st">'ids'</span>: [<span class="dv">33</span>], <span class="st">'color'</span>: <span class="st">'#2532e4'</span>},</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Hielo y nieve en superficie'</span>: {<span class="st">'ids'</span>: [<span class="dv">34</span>], <span class="st">'color'</span>: <span class="st">'#93dfe6'</span>},</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No observado'</span>: {<span class="st">'ids'</span>: [<span class="dv">27</span>], <span class="st">'color'</span>: <span class="st">'#ffffff'</span>}</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a><span class="co"># You can also create grouped categories for broader analysis</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>categories_grouped <span class="op">=</span> {</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'VegetaciÃ³n leÃ±osa'</span>: {</span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ids'</span>: [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">45</span>, <span class="dv">6</span>], </span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'#1f8d49'</span>,</span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subcategories'</span>: [<span class="st">'LeÃ±osa cerrada'</span>, <span class="st">'LeÃ±osa abierta'</span>, <span class="st">'LeÃ±osa dispersa'</span>, <span class="st">'LeÃ±osa inundable'</span>]</span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'VegetaciÃ³n no leÃ±osa'</span>: {</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ids'</span>: [<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">63</span>], </span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'#d6bc74'</span>,</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subcategories'</span>: [<span class="st">'VegetaciÃ³n no leÃ±osa inundable'</span>, <span class="st">'Pastizal'</span>, <span class="st">'Estepa'</span>]</span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ãrea agropecuaria'</span>: {</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ids'</span>: [<span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">9</span>, <span class="dv">36</span>, <span class="dv">21</span>], </span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'#ffefc3'</span>,</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subcategories'</span>: [<span class="st">'Pastura'</span>, <span class="st">'Agricultura'</span>, <span class="st">'PlantaciÃ³n forestal'</span>, <span class="st">'Cultivo arbustivo'</span>, <span class="st">'Mosaico agropecuario'</span>]</span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ãrea sin vegetaciÃ³n'</span>: {</span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ids'</span>: [<span class="dv">22</span>], </span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'#d4271e'</span>,</span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subcategories'</span>: [<span class="st">'Ãrea sin vegetaciÃ³n'</span>]</span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Cuerpo de agua'</span>: {</span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ids'</span>: [<span class="dv">33</span>, <span class="dv">34</span>], </span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'#2532e3'</span>,</span>
<span id="cb129-46"><a href="#cb129-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subcategories'</span>: [<span class="st">'RÃ­o, lago u ocÃ©ano'</span>, <span class="st">'Hielo y nieve en superficie'</span>]</span>
<span id="cb129-47"><a href="#cb129-47" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb129-48"><a href="#cb129-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No observado'</span>: {</span>
<span id="cb129-49"><a href="#cb129-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ids'</span>: [<span class="dv">27</span>], </span>
<span id="cb129-50"><a href="#cb129-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'#ffffff'</span>,</span>
<span id="cb129-51"><a href="#cb129-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subcategories'</span>: [<span class="st">'No observado'</span>]</span>
<span id="cb129-52"><a href="#cb129-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb129-53"><a href="#cb129-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-54"><a href="#cb129-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-55"><a href="#cb129-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to categorize pixels</span></span>
<span id="cb129-56"><a href="#cb129-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_pixel_detailed(value, categories):</span>
<span id="cb129-57"><a href="#cb129-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convert pixel value to detailed category name"""</span></span>
<span id="cb129-58"><a href="#cb129-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category, info <span class="kw">in</span> categories.items():</span>
<span id="cb129-59"><a href="#cb129-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb129-60"><a href="#cb129-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> category</span>
<span id="cb129-61"><a href="#cb129-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb129-62"><a href="#cb129-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-63"><a href="#cb129-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_pixel_grouped(value, categories):</span>
<span id="cb129-64"><a href="#cb129-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convert pixel value to grouped category name"""</span></span>
<span id="cb129-65"><a href="#cb129-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category, info <span class="kw">in</span> categories.items():</span>
<span id="cb129-66"><a href="#cb129-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb129-67"><a href="#cb129-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> category</span>
<span id="cb129-68"><a href="#cb129-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'Other'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="05c5e3a1" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create colormap from detailed categories</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {}</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, info <span class="kw">in</span> categories_detailed.items():</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pixel_id <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>        colors[pixel_id] <span class="op">=</span> info[<span class="st">'color'</span>]</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> mcolors.ListedColormap([colors[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">sorted</span>(colors.keys())])</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> <span class="bu">sorted</span>(colors.keys())</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> mcolors.BoundaryNorm(bounds, cmap.N)</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the raster</span></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> suelo_2022.plot(</span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>cmap,</span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>    norm<span class="op">=</span>norm,</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>    add_colorbar<span class="op">=</span><span class="va">False</span></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom legend from detailed categories</span></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="op">=</span> {}</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, info <span class="kw">in</span> categories_detailed.items():</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>    legend_labels[info[<span class="st">'color'</span>]] <span class="op">=</span> category</span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend below the map</span></span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [plt.Rectangle((<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">1</span>,<span class="dv">1</span>, facecolor<span class="op">=</span>color, label<span class="op">=</span>label) </span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> color, label <span class="kw">in</span> legend_labels.items()]</span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_elements, loc<span class="op">=</span><span class="st">'lower center'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.1</span>), </span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a>          ncol<span class="op">=</span><span class="dv">3</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Cobertura del Suelo - MapBiomas 2022'</span>)</span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb130-39"><a href="#cb130-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-108-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="villa-del-rosario_files/figure-html/cell-108-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="538a1f0d" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="2159dcac" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pixel counts for each category</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>unique_values, counts <span class="op">=</span> np.unique(suelo_2022.values[<span class="dv">0</span>], return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping from pixel IDs to category names</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>id_to_category <span class="op">=</span> {}</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, info <span class="kw">in</span> categories_detailed.items():</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pixel_id <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>        id_to_category[pixel_id] <span class="op">=</span> category</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total pixels excluding no-data (ID 0)</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>valid_pixels <span class="op">=</span> counts[unique_values <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>valid_values <span class="op">=</span> unique_values[unique_values <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>total_pixels <span class="op">=</span> np.<span class="bu">sum</span>(valid_pixels)</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>pixel_area_hectares <span class="op">=</span> <span class="fl">0.09</span>  <span class="co"># 30m x 30m = 900 mÂ² = 0.09 hectares</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create results list</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pixel_id, count <span class="kw">in</span> <span class="bu">zip</span>(valid_values, valid_pixels):</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pixel_id <span class="kw">in</span> id_to_category:</span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> id_to_category[pixel_id]</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>        area_hectares <span class="op">=</span> count <span class="op">*</span> pixel_area_hectares</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a>        percentage <span class="op">=</span> (count <span class="op">/</span> total_pixels) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CategorÃ­a'</span>: category,</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ID'</span>: pixel_id,</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Ãrea (hectÃ¡reas)'</span>: <span class="ss">f"</span><span class="sc">{</span>area_hectares<span class="sc">:,.1f}</span><span class="ss">"</span>,</span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Porcentaje (%)'</span>: <span class="ss">f"</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by area (descending)</span></span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>results.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="bu">float</span>(x[<span class="st">'Ãrea (hectÃ¡reas)'</span>].replace(<span class="st">','</span>, <span class="st">''</span>)), reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame and display</span></span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Cobertura del Suelo - MapBiomas 2022"</span>)</span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total Ã¡rea: </span><span class="sc">{</span>total_pixels <span class="op">*</span> pixel_area_hectares<span class="sc">:,.1f}</span><span class="ss"> hectÃ¡reas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cobertura del Suelo - MapBiomas 2022
==================================================
                     CategorÃ­a  ID Ãrea (hectÃ¡reas) Porcentaje (%)
                   Agricultura  18         54,481.7           77.6
                       Pastura  15          8,458.7           12.1
                      Pastizal  12          2,922.2            4.2
                LeÃ±osa cerrada   3          1,473.0            2.1
                LeÃ±osa abierta   4          1,430.6            2.0
           Ãrea sin vegetaciÃ³n  22            865.5            1.2
VegetaciÃ³n no leÃ±osa inundable  11            513.1            0.7
           PlantaciÃ³n forestal   9             32.4            0.0
            RÃ­o, lago u ocÃ©ano  33             18.6            0.0

Total Ã¡rea: 70,195.9 hectÃ¡reas</code></pre>
</div>
</div>
<div id="443218da" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rio</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Process data for all years</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2000</span>, <span class="dv">2023</span>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>yearly_data <span class="op">=</span> []</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Processing MapBiomas data for all years..."</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> tqdm(years):</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load the cloud GeoTIFF for the year</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>        suelo_ruta <span class="op">=</span> <span class="ss">f"https://storage.googleapis.com/mapbiomas-public/initiatives/argentina/collection-1/coverage/argentina_coverage_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.tif"</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>        suelo <span class="op">=</span> rio.open_rasterio(</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>            suelo_ruta,</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>            chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clip with from_disk=True for memory efficiency</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>        suelo_clipped <span class="op">=</span> suelo.rio.clip(</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>            aoi.geometry.values,</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>            aoi.crs,</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>            from_disk<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get unique values and their counts</span></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>        values, counts <span class="op">=</span> np.unique(suelo_clipped.values.flatten(), return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude no-data values (pixel ID 0)</span></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>        valid_mask <span class="op">=</span> values <span class="op">!=</span> <span class="dv">0</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>        valid_values <span class="op">=</span> values[valid_mask]</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>        valid_counts <span class="op">=</span> counts[valid_mask]</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a mapping from pixel value to category</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>        value_to_category <span class="op">=</span> {}</span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> value <span class="kw">in</span> valid_values:</span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> np.isnan(value):</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>                value_to_category[<span class="bu">int</span>(value)] <span class="op">=</span> categorize_pixel_grouped(<span class="bu">int</span>(value), categories_grouped)</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate percentages for each category (excluding no-data)</span></span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>        total_pixels <span class="op">=</span> valid_counts.<span class="bu">sum</span>()</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>        year_percentages <span class="op">=</span> {}</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category <span class="kw">in</span> categories_grouped.keys():</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>            category_pixels <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> value, count <span class="kw">in</span> <span class="bu">zip</span>(valid_values, valid_counts):</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> np.isnan(value) <span class="kw">and</span> value_to_category.get(<span class="bu">int</span>(value)) <span class="op">==</span> category:</span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>                    category_pixels <span class="op">+=</span> count</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>            year_percentages[category] <span class="op">=</span> (category_pixels <span class="op">/</span> total_pixels) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a>        year_percentages[<span class="st">'year'</span>] <span class="op">=</span> year</span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>        yearly_data.append(year_percentages)</span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean up memory</span></span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> suelo, suelo_clipped</span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error processing year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb134-63"><a href="#cb134-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-64"><a href="#cb134-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb134-65"><a href="#cb134-65" aria-hidden="true" tabindex="-1"></a>df_yearly <span class="op">=</span> pd.DataFrame(yearly_data)</span>
<span id="cb134-66"><a href="#cb134-66" aria-hidden="true" tabindex="-1"></a>df_yearly <span class="op">=</span> df_yearly.set_index(<span class="st">'year'</span>)</span>
<span id="cb134-67"><a href="#cb134-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-68"><a href="#cb134-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data processing complete!"</span>)</span>
<span id="cb134-69"><a href="#cb134-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Processed </span><span class="sc">{</span><span class="bu">len</span>(df_yearly)<span class="sc">}</span><span class="ss"> years"</span>)</span>
<span id="cb134-70"><a href="#cb134-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample data:"</span>)</span>
<span id="cb134-71"><a href="#cb134-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_yearly.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Processing MapBiomas data for all years...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 23/23 [01:33&lt;00:00,  4.05s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Data processing complete!
Processed 23 years

Sample data:
      VegetaciÃ³n leÃ±osa  VegetaciÃ³n no leÃ±osa  Ãrea agropecuaria  \
year                                                               
2000           6.144970              5.184145          88.022258   
2001           5.985345              5.017213          88.323685   
2002           5.655198              5.393388          88.296248   
2003           6.153817              4.694373          88.553570   
2004           4.742068              4.236526          90.387522   

      Ãrea sin vegetaciÃ³n  Cuerpo de agua  No observado  
year                                                     
2000             0.645165        0.003462           0.0  
2001             0.673500        0.000256           0.0  
2002             0.654910        0.000256           0.0  
2003             0.598240        0.000000           0.0  
2004             0.633883        0.000000           0.0  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
<div id="c678bd25" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set text as text objects, not paths</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'svg.fonttype'</span>] <span class="op">=</span> <span class="st">'none'</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create stacked 100% bar chart</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out categories with no data and exclude bodies of water</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>categories_with_data <span class="op">=</span> []</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>colors_with_data <span class="op">=</span> []</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> categories_grouped.keys():</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> category <span class="op">!=</span> <span class="st">'Cuerpo de agua'</span> <span class="kw">and</span> df_yearly[category].<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:  <span class="co"># Exclude bodies of water</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>        categories_with_data.append(category)</span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>        colors_with_data.append(categories_grouped[category][<span class="st">'color'</span>])</span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder categories to put 'Ãrea agropecuaria' on top (reverse order for stacking)</span></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>category_order <span class="op">=</span> [<span class="st">'Other'</span>, <span class="st">'No observado'</span>, <span class="st">'Ãrea sin vegetaciÃ³n'</span>, <span class="st">'VegetaciÃ³n no leÃ±osa'</span>, </span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'VegetaciÃ³n leÃ±osa'</span>, <span class="st">'Ãrea agropecuaria'</span>]</span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>ordered_categories <span class="op">=</span> []</span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>ordered_colors <span class="op">=</span> []</span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat <span class="kw">in</span> category_order:</span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cat <span class="kw">in</span> categories_with_data:</span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> categories_with_data.index(cat)</span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>        ordered_categories.append(cat)</span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a>        ordered_colors.append(colors_with_data[idx])</span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add any remaining categories not in the order</span></span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat <span class="kw">in</span> categories_with_data:</span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cat <span class="kw">not</span> <span class="kw">in</span> ordered_categories:</span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> categories_with_data.index(cat)</span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a>        ordered_categories.append(cat)</span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a>        ordered_colors.append(colors_with_data[idx])</span>
<span id="cb139-37"><a href="#cb139-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-38"><a href="#cb139-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create stacked bars</span></span>
<span id="cb139-39"><a href="#cb139-39" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="bu">len</span>(df_yearly))</span>
<span id="cb139-40"><a href="#cb139-40" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> []</span>
<span id="cb139-41"><a href="#cb139-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-42"><a href="#cb139-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, category <span class="kw">in</span> <span class="bu">enumerate</span>(ordered_categories):</span>
<span id="cb139-43"><a href="#cb139-43" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> df_yearly[category].values</span>
<span id="cb139-44"><a href="#cb139-44" aria-hidden="true" tabindex="-1"></a>    bars.append(ax.bar(df_yearly.index, values, bottom<span class="op">=</span>bottom, </span>
<span id="cb139-45"><a href="#cb139-45" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span>ordered_colors[i], alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span>category))</span>
<span id="cb139-46"><a href="#cb139-46" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> values</span>
<span id="cb139-47"><a href="#cb139-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-48"><a href="#cb139-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb139-49"><a href="#cb139-49" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'AÃ±o'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb139-50"><a href="#cb139-50" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Porcentaje (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb139-51"><a href="#cb139-51" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'EvoluciÃ³n Temporal de Cobertura del Suelo</span><span class="ch">\n</span><span class="st">Villa del Rosario (2000-2022)'</span>, </span>
<span id="cb139-52"><a href="#cb139-52" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb139-53"><a href="#cb139-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-54"><a href="#cb139-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axis to 100%</span></span>
<span id="cb139-55"><a href="#cb139-55" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb139-56"><a href="#cb139-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-57"><a href="#cb139-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb139-58"><a href="#cb139-58" aria-hidden="true" tabindex="-1"></a>ax.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb139-59"><a href="#cb139-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-60"><a href="#cb139-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove top and right spines for minimalist look</span></span>
<span id="cb139-61"><a href="#cb139-61" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb139-62"><a href="#cb139-62" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb139-63"><a href="#cb139-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-64"><a href="#cb139-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Set grid</span></span>
<span id="cb139-65"><a href="#cb139-65" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb139-66"><a href="#cb139-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-67"><a href="#cb139-67" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb139-68"><a href="#cb139-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-69"><a href="#cb139-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as SVG</span></span>
<span id="cb139-70"><a href="#cb139-70" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/land_cover_timeseries.svg', </span></span>
<span id="cb139-71"><a href="#cb139-71" aria-hidden="true" tabindex="-1"></a><span class="co">#             format='svg', dpi=300, bbox_inches='tight')</span></span>
<span id="cb139-72"><a href="#cb139-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-73"><a href="#cb139-73" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-112-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="villa-del-rosario_files/figure-html/cell-112-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="393ce1ae" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rio</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the cloud GeoTIFF clipped to your GeoDataFrame</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>suelo_2000_ruta <span class="op">=</span> <span class="st">"https://storage.googleapis.com/mapbiomas-public/initiatives/argentina/collection-1/coverage/argentina_coverage_2000.tif"</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>suelo_2000 <span class="op">=</span> rio.open_rasterio(</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    suelo_2000_ruta,</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip with from_disk=True for memory efficiency</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>suelo_2000 <span class="op">=</span> suelo_2000.rio.clip(</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>    aoi.geometry.values,</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    aoi.crs,</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    from_disk<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="20ca68f1" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both rasters have the same shape by clipping to the same extent</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>suelo_2000_clipped <span class="op">=</span> suelo_2000.rio.clip(aoi.geometry.values, aoi.crs, from_disk<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>suelo_2022_clipped <span class="op">=</span> suelo_2022.rio.clip(aoi.geometry.values, aoi.crs, from_disk<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert pixel values to grouped categories for both years</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>suelo_2000_cat <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: categorize_pixel_grouped(x, categories_grouped))(suelo_2000_clipped.values[<span class="dv">0</span>])</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>suelo_2022_cat <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: categorize_pixel_grouped(x, categories_grouped))(suelo_2022_clipped.values[<span class="dv">0</span>])</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique categories (excluding no-data and bodies of water)</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>unique_2000 <span class="op">=</span> np.unique(suelo_2000_cat)</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>unique_2022 <span class="op">=</span> np.unique(suelo_2022_cat)</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out unwanted categories</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>valid_categories <span class="op">=</span> [<span class="st">'Ãrea agropecuaria'</span>, <span class="st">'VegetaciÃ³n leÃ±osa'</span>, <span class="st">'VegetaciÃ³n no leÃ±osa'</span>, <span class="st">'Ãrea sin vegetaciÃ³n'</span>]</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>existing_2000 <span class="op">=</span> [cat <span class="cf">for</span> cat <span class="kw">in</span> unique_2000 <span class="cf">if</span> cat <span class="kw">in</span> valid_categories]</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>existing_2022 <span class="op">=</span> [cat <span class="cf">for</span> cat <span class="kw">in</span> unique_2022 <span class="cf">if</span> cat <span class="kw">in</span> valid_categories]</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total pixels for percentage calculations</span></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>total_2000 <span class="op">=</span> np.<span class="bu">sum</span>([np.<span class="bu">sum</span>(suelo_2000_cat <span class="op">==</span> cat) <span class="cf">for</span> cat <span class="kw">in</span> existing_2000])</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>total_2022 <span class="op">=</span> np.<span class="bu">sum</span>([np.<span class="bu">sum</span>(suelo_2022_cat <span class="op">==</span> cat) <span class="cf">for</span> cat <span class="kw">in</span> existing_2022])</span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create transition matrix</span></span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="op">=</span> {}</span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_2000 <span class="kw">in</span> existing_2000:</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>    transition_matrix[cat_2000] <span class="op">=</span> {}</span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>    mask_2000 <span class="op">=</span> (suelo_2000_cat <span class="op">==</span> cat_2000)</span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat_2022 <span class="kw">in</span> existing_2022:</span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a>        mask_2022 <span class="op">=</span> (suelo_2022_cat <span class="op">==</span> cat_2022)</span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a>        transition_count <span class="op">=</span> np.<span class="bu">sum</span>(mask_2000 <span class="op">&amp;</span> mask_2022)</span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> transition_count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb141-34"><a href="#cb141-34" aria-hidden="true" tabindex="-1"></a>            transition_matrix[cat_2000][cat_2022] <span class="op">=</span> transition_count</span>
<span id="cb141-35"><a href="#cb141-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-36"><a href="#cb141-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Sankey data</span></span>
<span id="cb141-37"><a href="#cb141-37" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> []</span>
<span id="cb141-38"><a href="#cb141-38" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> []</span>
<span id="cb141-39"><a href="#cb141-39" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> []</span>
<span id="cb141-40"><a href="#cb141-40" aria-hidden="true" tabindex="-1"></a>node_labels <span class="op">=</span> []</span>
<span id="cb141-41"><a href="#cb141-41" aria-hidden="true" tabindex="-1"></a>node_colors <span class="op">=</span> []</span>
<span id="cb141-42"><a href="#cb141-42" aria-hidden="true" tabindex="-1"></a>link_colors <span class="op">=</span> []</span>
<span id="cb141-43"><a href="#cb141-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-44"><a href="#cb141-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 2000 nodes with percentages</span></span>
<span id="cb141-45"><a href="#cb141-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, cat <span class="kw">in</span> <span class="bu">enumerate</span>(existing_2000):</span>
<span id="cb141-46"><a href="#cb141-46" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> np.<span class="bu">sum</span>(suelo_2000_cat <span class="op">==</span> cat)</span>
<span id="cb141-47"><a href="#cb141-47" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> (count <span class="op">/</span> total_2000) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb141-48"><a href="#cb141-48" aria-hidden="true" tabindex="-1"></a>    node_labels.append(<span class="ss">f"</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">&lt;br&gt;2000&lt;br&gt;(</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb141-49"><a href="#cb141-49" aria-hidden="true" tabindex="-1"></a>    node_colors.append(categories_grouped[cat][<span class="st">'color'</span>])</span>
<span id="cb141-50"><a href="#cb141-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-51"><a href="#cb141-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 2022 nodes with percentages</span></span>
<span id="cb141-52"><a href="#cb141-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, cat <span class="kw">in</span> <span class="bu">enumerate</span>(existing_2022):</span>
<span id="cb141-53"><a href="#cb141-53" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> np.<span class="bu">sum</span>(suelo_2022_cat <span class="op">==</span> cat)</span>
<span id="cb141-54"><a href="#cb141-54" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> (count <span class="op">/</span> total_2022) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb141-55"><a href="#cb141-55" aria-hidden="true" tabindex="-1"></a>    node_labels.append(<span class="ss">f"</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">&lt;br&gt;2022&lt;br&gt;(</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb141-56"><a href="#cb141-56" aria-hidden="true" tabindex="-1"></a>    node_colors.append(categories_grouped[cat][<span class="st">'color'</span>])</span>
<span id="cb141-57"><a href="#cb141-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-58"><a href="#cb141-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Create links based on actual transitions</span></span>
<span id="cb141-59"><a href="#cb141-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_2000, transitions <span class="kw">in</span> transition_matrix.items():</span>
<span id="cb141-60"><a href="#cb141-60" aria-hidden="true" tabindex="-1"></a>    source_idx <span class="op">=</span> existing_2000.index(cat_2000)</span>
<span id="cb141-61"><a href="#cb141-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat_2022, count <span class="kw">in</span> transitions.items():</span>
<span id="cb141-62"><a href="#cb141-62" aria-hidden="true" tabindex="-1"></a>        target_idx <span class="op">=</span> <span class="bu">len</span>(existing_2000) <span class="op">+</span> existing_2022.index(cat_2022)</span>
<span id="cb141-63"><a href="#cb141-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb141-64"><a href="#cb141-64" aria-hidden="true" tabindex="-1"></a>        source.append(source_idx)</span>
<span id="cb141-65"><a href="#cb141-65" aria-hidden="true" tabindex="-1"></a>        target.append(target_idx)</span>
<span id="cb141-66"><a href="#cb141-66" aria-hidden="true" tabindex="-1"></a>        value.append(count)</span>
<span id="cb141-67"><a href="#cb141-67" aria-hidden="true" tabindex="-1"></a>        link_colors.append(categories_grouped[cat_2000][<span class="st">'color'</span>])</span>
<span id="cb141-68"><a href="#cb141-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-69"><a href="#cb141-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram</span></span>
<span id="cb141-70"><a href="#cb141-70" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Sankey(</span>
<span id="cb141-71"><a href="#cb141-71" aria-hidden="true" tabindex="-1"></a>    node<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb141-72"><a href="#cb141-72" aria-hidden="true" tabindex="-1"></a>        pad<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb141-73"><a href="#cb141-73" aria-hidden="true" tabindex="-1"></a>        thickness<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb141-74"><a href="#cb141-74" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, width<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb141-75"><a href="#cb141-75" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>node_labels,</span>
<span id="cb141-76"><a href="#cb141-76" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>node_colors</span>
<span id="cb141-77"><a href="#cb141-77" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb141-78"><a href="#cb141-78" aria-hidden="true" tabindex="-1"></a>    link<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb141-79"><a href="#cb141-79" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>source,</span>
<span id="cb141-80"><a href="#cb141-80" aria-hidden="true" tabindex="-1"></a>        target<span class="op">=</span>target,</span>
<span id="cb141-81"><a href="#cb141-81" aria-hidden="true" tabindex="-1"></a>        value<span class="op">=</span>value,</span>
<span id="cb141-82"><a href="#cb141-82" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>link_colors</span>
<span id="cb141-83"><a href="#cb141-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb141-84"><a href="#cb141-84" aria-hidden="true" tabindex="-1"></a>)])</span>
<span id="cb141-85"><a href="#cb141-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-86"><a href="#cb141-86" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb141-87"><a href="#cb141-87" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Transiciones Reales de Cobertura del Suelo (2000 â†’ 2022)"</span>,</span>
<span id="cb141-88"><a href="#cb141-88" aria-hidden="true" tabindex="-1"></a>    font_size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb141-89"><a href="#cb141-89" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb141-90"><a href="#cb141-90" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">800</span></span>
<span id="cb141-91"><a href="#cb141-91" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-92"><a href="#cb141-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-93"><a href="#cb141-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to save as PDF</span></span>
<span id="cb141-94"><a href="#cb141-94" aria-hidden="true" tabindex="-1"></a><span class="co"># try:</span></span>
<span id="cb141-95"><a href="#cb141-95" aria-hidden="true" tabindex="-1"></a><span class="co">#     fig.write_image('/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/sankey_transitions.pdf', </span></span>
<span id="cb141-96"><a href="#cb141-96" aria-hidden="true" tabindex="-1"></a><span class="co">#                     format='pdf', width=800, height=800)</span></span>
<span id="cb141-97"><a href="#cb141-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     print("PDF saved successfully!")</span></span>
<span id="cb141-98"><a href="#cb141-98" aria-hidden="true" tabindex="-1"></a><span class="co"># except Exception as e:</span></span>
<span id="cb141-99"><a href="#cb141-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"PDF export failed: {e}")</span></span>
<span id="cb141-100"><a href="#cb141-100" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Try SVG as fallback</span></span>
<span id="cb141-101"><a href="#cb141-101" aria-hidden="true" tabindex="-1"></a><span class="co">#     try:</span></span>
<span id="cb141-102"><a href="#cb141-102" aria-hidden="true" tabindex="-1"></a><span class="co">#         fig.write_image('/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/sankey_transitions.svg', </span></span>
<span id="cb141-103"><a href="#cb141-103" aria-hidden="true" tabindex="-1"></a><span class="co">#                         format='svg', width=800, height=800)</span></span>
<span id="cb141-104"><a href="#cb141-104" aria-hidden="true" tabindex="-1"></a><span class="co">#         print("SVG saved successfully!")</span></span>
<span id="cb141-105"><a href="#cb141-105" aria-hidden="true" tabindex="-1"></a><span class="co">#     except Exception as e2:</span></span>
<span id="cb141-106"><a href="#cb141-106" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"SVG also failed: {e2}")</span></span>
<span id="cb141-107"><a href="#cb141-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-108"><a href="#cb141-108" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/nissim/Documents/dev/fulbright/ciut-riesgo/.venv/lib/python3.12/site-packages/xarray/core/duck_array_ops.py:237: RuntimeWarning: invalid value encountered in cast
  return data.astype(dtype, **kwargs)
/home/nissim/Documents/dev/fulbright/ciut-riesgo/.venv/lib/python3.12/site-packages/xarray/core/duck_array_ops.py:237: RuntimeWarning: invalid value encountered in cast
  return data.astype(dtype, **kwargs)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="8ff5ef0d" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total hectares for each major class</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>pixel_area_hectares <span class="op">=</span> <span class="fl">0.09</span>  <span class="co"># 30m x 30m = 900 mÂ² = 0.09 hectares</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TOTAL HECTARES POR CLASE PRINCIPAL"</span>)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2000:"</span>)</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat <span class="kw">in</span> existing_2000:</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> np.<span class="bu">sum</span>(suelo_2000_cat <span class="op">==</span> cat)</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>    hectares <span class="op">=</span> count <span class="op">*</span> pixel_area_hectares</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> (count <span class="op">/</span> total_2000) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>hectares<span class="sc">:,.1f}</span><span class="ss"> ha (</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2022:"</span>)</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat <span class="kw">in</span> existing_2022:</span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> np.<span class="bu">sum</span>(suelo_2022_cat <span class="op">==</span> cat)</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>    hectares <span class="op">=</span> count <span class="op">*</span> pixel_area_hectares</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> (count <span class="op">/</span> total_2022) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>hectares<span class="sc">:,.1f}</span><span class="ss"> ha (</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total area</span></span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a>total_hectares_2000 <span class="op">=</span> total_2000 <span class="op">*</span> pixel_area_hectares</span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a>total_hectares_2022 <span class="op">=</span> total_2022 <span class="op">*</span> pixel_area_hectares</span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">TOTAL ÃREA:"</span>)</span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"2000: </span><span class="sc">{</span>total_hectares_2000<span class="sc">:,.1f}</span><span class="ss"> ha"</span>)</span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"2022: </span><span class="sc">{</span>total_hectares_2022<span class="sc">:,.1f}</span><span class="ss"> ha"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>TOTAL HECTARES POR CLASE PRINCIPAL
==================================================

2000:
VegetaciÃ³n leÃ±osa: 4,313.5 ha (6.1%)
VegetaciÃ³n no leÃ±osa: 3,639.1 ha (5.2%)
Ãrea agropecuaria: 61,788.1 ha (88.0%)
Ãrea sin vegetaciÃ³n: 452.9 ha (0.6%)

2022:
VegetaciÃ³n leÃ±osa: 2,903.7 ha (4.1%)
VegetaciÃ³n no leÃ±osa: 3,435.3 ha (4.9%)
Ãrea agropecuaria: 62,972.8 ha (89.7%)
Ãrea sin vegetaciÃ³n: 865.5 ha (1.2%)

TOTAL ÃREA:
2000: 70,193.5 ha
2022: 70,177.3 ha</code></pre>
</div>
</div>
<div id="4200205c" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create colormap from detailed categories</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {}</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, info <span class="kw">in</span> categories_detailed.items():</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pixel_id <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>        colors[pixel_id] <span class="op">=</span> info[<span class="st">'color'</span>]</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> mcolors.ListedColormap([colors[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">sorted</span>(colors.keys())])</span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> <span class="bu">sorted</span>(colors.keys())</span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> mcolors.BoundaryNorm(bounds, cmap.N)</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the raster</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> suelo_2000.plot(</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>cmap,</span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>    norm<span class="op">=</span>norm,</span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>    add_colorbar<span class="op">=</span><span class="va">False</span></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom legend from detailed categories</span></span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="op">=</span> {}</span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, info <span class="kw">in</span> categories_detailed.items():</span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a>    legend_labels[info[<span class="st">'color'</span>]] <span class="op">=</span> category</span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend below the map</span></span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [plt.Rectangle((<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">1</span>,<span class="dv">1</span>, facecolor<span class="op">=</span>color, label<span class="op">=</span>label) </span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> color, label <span class="kw">in</span> legend_labels.items()]</span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_elements, loc<span class="op">=</span><span class="st">'lower center'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.1</span>), </span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a>          ncol<span class="op">=</span><span class="dv">3</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb146-36"><a href="#cb146-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-37"><a href="#cb146-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Cobertura del Suelo - MapBiomas 2000'</span>)</span>
<span id="cb146-38"><a href="#cb146-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb146-39"><a href="#cb146-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="588333b7" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pixel counts for each category</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>unique_values, counts <span class="op">=</span> np.unique(suelo_2000.values[<span class="dv">0</span>], return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping from pixel IDs to category names</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>id_to_category <span class="op">=</span> {}</span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, info <span class="kw">in</span> categories_detailed.items():</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pixel_id <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>        id_to_category[pixel_id] <span class="op">=</span> category</span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total pixels and area per pixel (assuming 100m resolution)</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>total_pixels <span class="op">=</span> np.<span class="bu">sum</span>(counts)</span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>pixel_area_hectares <span class="op">=</span> <span class="fl">0.01</span>  <span class="co"># 100m x 100m = 1 hectare</span></span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create results list</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pixel_id, count <span class="kw">in</span> <span class="bu">zip</span>(unique_values, counts):</span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pixel_id <span class="kw">in</span> id_to_category:</span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> id_to_category[pixel_id]</span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>        area_hectares <span class="op">=</span> count <span class="op">*</span> pixel_area_hectares</span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a>        percentage <span class="op">=</span> (count <span class="op">/</span> total_pixels) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CategorÃ­a'</span>: category,</span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ID'</span>: pixel_id,</span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Ãrea (hectÃ¡reas)'</span>: <span class="ss">f"</span><span class="sc">{</span>area_hectares<span class="sc">:,.1f}</span><span class="ss">"</span>,</span>
<span id="cb147-28"><a href="#cb147-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Porcentaje (%)'</span>: <span class="ss">f"</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">"</span></span>
<span id="cb147-29"><a href="#cb147-29" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb147-30"><a href="#cb147-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-31"><a href="#cb147-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by area (descending)</span></span>
<span id="cb147-32"><a href="#cb147-32" aria-hidden="true" tabindex="-1"></a>results.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="bu">float</span>(x[<span class="st">'Ãrea (hectÃ¡reas)'</span>].replace(<span class="st">','</span>, <span class="st">''</span>)), reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb147-33"><a href="#cb147-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-34"><a href="#cb147-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame and display</span></span>
<span id="cb147-35"><a href="#cb147-35" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb147-36"><a href="#cb147-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Cobertura del Suelo - MapBiomas 2000"</span>)</span>
<span id="cb147-37"><a href="#cb147-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb147-38"><a href="#cb147-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb147-39"><a href="#cb147-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total Ã¡rea: </span><span class="sc">{</span>total_pixels <span class="op">*</span> pixel_area_hectares<span class="sc">:,.1f}</span><span class="ss"> hectÃ¡reas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8c00fadd" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_pixel_grouped(value, categories):</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convert pixel value to grouped category name"""</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category, info <span class="kw">in</span> categories.items():</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> category</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the raw pixel values</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>suelo_2000_values <span class="op">=</span> suelo_2000.values[<span class="dv">0</span>]</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>suelo_2022_values <span class="op">=</span> suelo_2022.values[<span class="dv">0</span>]</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to grouped categories</span></span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>suelo_2000_cat <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: categorize_pixel_grouped(x, categories_grouped))(suelo_2000_values)</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>suelo_2022_cat <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: categorize_pixel_grouped(x, categories_grouped))(suelo_2022_values)</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create transition map</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>transition_map <span class="op">=</span> np.zeros_like(suelo_2000_cat, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Only process pixels that actually changed</span></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>changed_mask <span class="op">=</span> (suelo_2000_values <span class="op">!=</span> suelo_2022_values)</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 1: Agriculture/non-vegetated â†’ Forest/natural (natural regrowth)</span></span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>mask1 <span class="op">=</span> changed_mask <span class="op">&amp;</span> ((suelo_2000_cat <span class="op">==</span> <span class="st">'Ãrea agropecuaria'</span>) <span class="op">|</span> </span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>                       (suelo_2000_cat <span class="op">==</span> <span class="st">'Ãrea sin vegetaciÃ³n'</span>)) <span class="op">&amp;</span> <span class="op">\</span></span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a>        ((suelo_2022_cat <span class="op">==</span> <span class="st">'VegetaciÃ³n leÃ±osa'</span>) <span class="op">|</span> </span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a>         (suelo_2022_cat <span class="op">==</span> <span class="st">'VegetaciÃ³n no leÃ±osa'</span>))</span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a>transition_map[mask1] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 2: Forest/natural â†’ Agriculture/non-vegetated</span></span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a>mask2 <span class="op">=</span> changed_mask <span class="op">&amp;</span> ((suelo_2000_cat <span class="op">==</span> <span class="st">'VegetaciÃ³n leÃ±osa'</span>) <span class="op">|</span> </span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a>                       (suelo_2000_cat <span class="op">==</span> <span class="st">'VegetaciÃ³n no leÃ±osa'</span>)) <span class="op">&amp;</span> <span class="op">\</span></span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a>        ((suelo_2022_cat <span class="op">==</span> <span class="st">'Ãrea agropecuaria'</span>) <span class="op">|</span> </span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a>         (suelo_2022_cat <span class="op">==</span> <span class="st">'Ãrea sin vegetaciÃ³n'</span>))</span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a>transition_map[mask2] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 3: Water gain</span></span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a>mask3 <span class="op">=</span> changed_mask <span class="op">&amp;</span> (suelo_2000_cat <span class="op">!=</span> <span class="st">'Cuerpo de agua'</span>) <span class="op">&amp;</span> (suelo_2022_cat <span class="op">==</span> <span class="st">'Cuerpo de agua'</span>)</span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a>transition_map[mask3] <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-44"><a href="#cb148-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 4: Water loss</span></span>
<span id="cb148-45"><a href="#cb148-45" aria-hidden="true" tabindex="-1"></a>mask4 <span class="op">=</span> changed_mask <span class="op">&amp;</span> (suelo_2000_cat <span class="op">==</span> <span class="st">'Cuerpo de agua'</span>) <span class="op">&amp;</span> (suelo_2022_cat <span class="op">!=</span> <span class="st">'Cuerpo de agua'</span>)</span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a>transition_map[mask4] <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 5: Forest plantation gain (only specific plantation types)</span></span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a>mask5 <span class="op">=</span> changed_mask <span class="op">&amp;</span> (suelo_2000_cat <span class="op">==</span> <span class="st">'Ãrea agropecuaria'</span>) <span class="op">&amp;</span> (suelo_2022_cat <span class="op">==</span> <span class="st">'VegetaciÃ³n leÃ±osa'</span>) <span class="op">&amp;</span> (suelo_2022_values <span class="op">==</span> <span class="dv">9</span>)</span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a>transition_map[mask5] <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 6: Other changes (catch-all for remaining changed pixels)</span></span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a>mask6 <span class="op">=</span> changed_mask <span class="op">&amp;</span> (transition_map <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a>transition_map[mask6] <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb148-55"><a href="#cb148-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-56"><a href="#cb148-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 7: No change</span></span>
<span id="cb148-57"><a href="#cb148-57" aria-hidden="true" tabindex="-1"></a>transition_map[<span class="op">~</span>changed_mask] <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb148-58"><a href="#cb148-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-59"><a href="#cb148-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors</span></span>
<span id="cb148-60"><a href="#cb148-60" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb148-61"><a href="#cb148-61" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: <span class="st">'#cccccc'</span>,  <span class="co"># Unclassified</span></span>
<span id="cb148-62"><a href="#cb148-62" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">'#06ff00'</span>,  <span class="co"># Agriculture â†’ Forest/natural (regeneration)</span></span>
<span id="cb148-63"><a href="#cb148-63" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="st">'#ff0000'</span>,  <span class="co"># Forest/natural â†’ Agriculture</span></span>
<span id="cb148-64"><a href="#cb148-64" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">'#0066cc'</span>,  <span class="co"># Water gain</span></span>
<span id="cb148-65"><a href="#cb148-65" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="st">'#ff6600'</span>,  <span class="co"># Water loss</span></span>
<span id="cb148-66"><a href="#cb148-66" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="st">'#8a2be2'</span>,  <span class="co"># Forest plantation gain</span></span>
<span id="cb148-67"><a href="#cb148-67" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="st">'#ffa500'</span>,  <span class="co"># Other changes</span></span>
<span id="cb148-68"><a href="#cb148-68" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>: <span class="st">'#aaa9a9'</span>   <span class="co"># No change</span></span>
<span id="cb148-69"><a href="#cb148-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-70"><a href="#cb148-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-71"><a href="#cb148-71" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> {</span>
<span id="cb148-72"><a href="#cb148-72" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: <span class="st">'No clasificado'</span>,</span>
<span id="cb148-73"><a href="#cb148-73" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">'Agricultura â†’ Forestal/natural'</span>,</span>
<span id="cb148-74"><a href="#cb148-74" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="st">'Forestal/natural â†’ Agricultura'</span>,</span>
<span id="cb148-75"><a href="#cb148-75" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">'Ganancia de agua'</span>,</span>
<span id="cb148-76"><a href="#cb148-76" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="st">'PÃ©rdida de agua'</span>,</span>
<span id="cb148-77"><a href="#cb148-77" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="st">'Ganancia plantaciÃ³n forestal'</span>,</span>
<span id="cb148-78"><a href="#cb148-78" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="st">'Otros cambios'</span>,</span>
<span id="cb148-79"><a href="#cb148-79" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>: <span class="st">'Sin cambio'</span></span>
<span id="cb148-80"><a href="#cb148-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-81"><a href="#cb148-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-82"><a href="#cb148-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Create colormap</span></span>
<span id="cb148-83"><a href="#cb148-83" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> mcolors.ListedColormap([colors[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">sorted</span>(colors.keys())])</span>
<span id="cb148-84"><a href="#cb148-84" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> <span class="bu">sorted</span>(colors.keys())</span>
<span id="cb148-85"><a href="#cb148-85" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> mcolors.BoundaryNorm(bounds, cmap.N)</span>
<span id="cb148-86"><a href="#cb148-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-87"><a href="#cb148-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb148-88"><a href="#cb148-88" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb148-89"><a href="#cb148-89" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ax.imshow(transition_map, cmap<span class="op">=</span>cmap, norm<span class="op">=</span>norm)</span>
<span id="cb148-90"><a href="#cb148-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-91"><a href="#cb148-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend</span></span>
<span id="cb148-92"><a href="#cb148-92" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [plt.Rectangle((<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">1</span>,<span class="dv">1</span>, facecolor<span class="op">=</span>colors[i], label<span class="op">=</span>labels[i]) </span>
<span id="cb148-93"><a href="#cb148-93" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">sorted</span>(colors.keys())]</span>
<span id="cb148-94"><a href="#cb148-94" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_elements, loc<span class="op">=</span><span class="st">'lower center'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.1</span>), </span>
<span id="cb148-95"><a href="#cb148-95" aria-hidden="true" tabindex="-1"></a>          ncol<span class="op">=</span><span class="dv">2</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb148-96"><a href="#cb148-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-97"><a href="#cb148-97" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Transiciones de Cobertura del Suelo (2000-2022)'</span>)</span>
<span id="cb148-98"><a href="#cb148-98" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb148-99"><a href="#cb148-99" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="025361f3" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_pixel_grouped(value, categories):</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convert pixel value to grouped category name"""</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category, info <span class="kw">in</span> categories.items():</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="kw">in</span> info[<span class="st">'ids'</span>]:</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> category</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert pixel values to grouped categories</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>suelo_2000_cat <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: categorize_pixel_grouped(x, categories_grouped))(suelo_2000.values[<span class="dv">0</span>])</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>suelo_2022_cat <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: categorize_pixel_grouped(x, categories_grouped))(suelo_2022.values[<span class="dv">0</span>])</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pixel counts for each category</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>unique_2000, counts_2000 <span class="op">=</span> np.unique(suelo_2000_cat, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>unique_2022, counts_2022 <span class="op">=</span> np.unique(suelo_2022_cat, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out 'Other' and get only categories that exist</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>existing_2000 <span class="op">=</span> unique_2000[unique_2000 <span class="op">!=</span> <span class="st">'Other'</span>]</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>existing_2022 <span class="op">=</span> unique_2022[unique_2022 <span class="op">!=</span> <span class="st">'Other'</span>]</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total pixels</span></span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>total_2000 <span class="op">=</span> <span class="bu">sum</span>(counts_2000[unique_2000 <span class="op">!=</span> <span class="st">'Other'</span>])</span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>total_2022 <span class="op">=</span> <span class="bu">sum</span>(counts_2022[unique_2022 <span class="op">!=</span> <span class="st">'Other'</span>])</span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create transition matrix</span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="op">=</span> {}</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_2000 <span class="kw">in</span> existing_2000:</span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>    transition_matrix[cat_2000] <span class="op">=</span> {}</span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>    mask_2000 <span class="op">=</span> (suelo_2000_cat <span class="op">==</span> cat_2000)</span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat_2022 <span class="kw">in</span> existing_2022:</span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>        mask_2022 <span class="op">=</span> (suelo_2022_cat <span class="op">==</span> cat_2022)</span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a>        transition_count <span class="op">=</span> np.<span class="bu">sum</span>(mask_2000 <span class="op">&amp;</span> mask_2022)</span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> transition_count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a>            transition_matrix[cat_2000][cat_2022] <span class="op">=</span> transition_count</span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for Sankey diagram</span></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> []</span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> []</span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> []</span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a>node_labels <span class="op">=</span> []</span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a>node_colors <span class="op">=</span> []</span>
<span id="cb149-44"><a href="#cb149-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-45"><a href="#cb149-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 2000 categories</span></span>
<span id="cb149-46"><a href="#cb149-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat <span class="kw">in</span> existing_2000:</span>
<span id="cb149-47"><a href="#cb149-47" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> counts_2000[unique_2000 <span class="op">==</span> cat][<span class="dv">0</span>]</span>
<span id="cb149-48"><a href="#cb149-48" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> (count <span class="op">/</span> total_2000) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb149-49"><a href="#cb149-49" aria-hidden="true" tabindex="-1"></a>    node_labels.append(<span class="ss">f"</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">&lt;br&gt;(</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb149-50"><a href="#cb149-50" aria-hidden="true" tabindex="-1"></a>    node_colors.append(categories_grouped[cat][<span class="st">'color'</span>])</span>
<span id="cb149-51"><a href="#cb149-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-52"><a href="#cb149-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 2022 categories</span></span>
<span id="cb149-53"><a href="#cb149-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat <span class="kw">in</span> existing_2022:</span>
<span id="cb149-54"><a href="#cb149-54" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> counts_2022[unique_2022 <span class="op">==</span> cat][<span class="dv">0</span>]</span>
<span id="cb149-55"><a href="#cb149-55" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> (count <span class="op">/</span> total_2022) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb149-56"><a href="#cb149-56" aria-hidden="true" tabindex="-1"></a>    node_labels.append(<span class="ss">f"</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">&lt;br&gt;(</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb149-57"><a href="#cb149-57" aria-hidden="true" tabindex="-1"></a>    node_colors.append(categories_grouped[cat][<span class="st">'color'</span>])</span>
<span id="cb149-58"><a href="#cb149-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-59"><a href="#cb149-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Create links</span></span>
<span id="cb149-60"><a href="#cb149-60" aria-hidden="true" tabindex="-1"></a>link_colors <span class="op">=</span> []</span>
<span id="cb149-61"><a href="#cb149-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cat_2000, transitions <span class="kw">in</span> transition_matrix.items():</span>
<span id="cb149-62"><a href="#cb149-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat_2022, count <span class="kw">in</span> transitions.items():</span>
<span id="cb149-63"><a href="#cb149-63" aria-hidden="true" tabindex="-1"></a>        source_idx <span class="op">=</span> node_labels.index(<span class="ss">f"</span><span class="sc">{</span>cat_2000<span class="sc">}</span><span class="ss">&lt;br&gt;(</span><span class="sc">{</span>(counts_2000[unique_2000 <span class="op">==</span> cat_2000][<span class="dv">0</span>] <span class="op">/</span> total_2000) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb149-64"><a href="#cb149-64" aria-hidden="true" tabindex="-1"></a>        target_idx <span class="op">=</span> node_labels.index(<span class="ss">f"</span><span class="sc">{</span>cat_2022<span class="sc">}</span><span class="ss">&lt;br&gt;(</span><span class="sc">{</span>(counts_2022[unique_2022 <span class="op">==</span> cat_2022][<span class="dv">0</span>] <span class="op">/</span> total_2022) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb149-65"><a href="#cb149-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb149-66"><a href="#cb149-66" aria-hidden="true" tabindex="-1"></a>        source.append(source_idx)</span>
<span id="cb149-67"><a href="#cb149-67" aria-hidden="true" tabindex="-1"></a>        target.append(target_idx)</span>
<span id="cb149-68"><a href="#cb149-68" aria-hidden="true" tabindex="-1"></a>        value.append(count)</span>
<span id="cb149-69"><a href="#cb149-69" aria-hidden="true" tabindex="-1"></a>        link_colors.append(categories_grouped[cat_2000][<span class="st">'color'</span>])</span>
<span id="cb149-70"><a href="#cb149-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-71"><a href="#cb149-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram</span></span>
<span id="cb149-72"><a href="#cb149-72" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Sankey(</span>
<span id="cb149-73"><a href="#cb149-73" aria-hidden="true" tabindex="-1"></a>    node<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb149-74"><a href="#cb149-74" aria-hidden="true" tabindex="-1"></a>        pad<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb149-75"><a href="#cb149-75" aria-hidden="true" tabindex="-1"></a>        thickness<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb149-76"><a href="#cb149-76" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, width<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb149-77"><a href="#cb149-77" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>node_labels,</span>
<span id="cb149-78"><a href="#cb149-78" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>node_colors</span>
<span id="cb149-79"><a href="#cb149-79" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb149-80"><a href="#cb149-80" aria-hidden="true" tabindex="-1"></a>    link<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb149-81"><a href="#cb149-81" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>source,</span>
<span id="cb149-82"><a href="#cb149-82" aria-hidden="true" tabindex="-1"></a>        target<span class="op">=</span>target,</span>
<span id="cb149-83"><a href="#cb149-83" aria-hidden="true" tabindex="-1"></a>        value<span class="op">=</span>value,</span>
<span id="cb149-84"><a href="#cb149-84" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>link_colors</span>
<span id="cb149-85"><a href="#cb149-85" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb149-86"><a href="#cb149-86" aria-hidden="true" tabindex="-1"></a>)])</span>
<span id="cb149-87"><a href="#cb149-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-88"><a href="#cb149-88" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb149-89"><a href="#cb149-89" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Transiciones de Cobertura del Suelo (2000-2022)"</span>,</span>
<span id="cb149-90"><a href="#cb149-90" aria-hidden="true" tabindex="-1"></a>    font_size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb149-91"><a href="#cb149-91" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb149-92"><a href="#cb149-92" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span></span>
<span id="cb149-93"><a href="#cb149-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-94"><a href="#cb149-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-95"><a href="#cb149-95" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="loss-to-fire" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="loss-to-fire"><span class="header-section-number">14.4</span> Loss to fire</h2>
<div id="eed7f998" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rio</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the cloud GeoTIFF clipped to your GeoDataFrame</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego_ruta <span class="op">=</span> <span class="st">"https://glad.umd.edu/users/Alexandra/Fire_GFL_data/2001-24/LAM_fire_forest_loss_2001-24.tif"</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego <span class="op">=</span> rio.open_rasterio(</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    perdida_a_fuego_ruta,</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip with from_disk=True for memory efficiency</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego <span class="op">=</span> perdida_a_fuego.rio.clip(</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>    aoi.<span class="bu">buffer</span>(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">20</span>).geometry.values,</span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>    aoi.crs,</span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>    from_disk<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="92402b58" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego.rio.to_raster(<span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/datos/bosque_perdido_a_fuego_2001-24.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="1a354356" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "â–º";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "â–¼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray (band: 1, y: 979, x: 1845)&gt; Size: 2MB
array([[[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]]], shape=(1, 979, 1845), dtype=uint8)
Coordinates:
  * x            (x) float64 15kB -63.7 -63.7 -63.7 ... -63.24 -63.24 -63.24
  * y            (y) float64 8kB -31.45 -31.45 -31.45 ... -31.7 -31.7 -31.7
  * band         (band) int64 8B 1
    spatial_ref  int64 8B 0
Attributes:
    AREA_OR_POINT:  Area
    LAYER_TYPE:     athematic
    scale_factor:   1.0
    add_offset:     0.0
    long_name:      Layer_1</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name"></div><ul class="xr-dim-list"><li><span class="xr-has-index">band</span>: 1</li><li><span class="xr-has-index">y</span>: 979</li><li><span class="xr-has-index">x</span>: 1845</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-ce5d7223-9692-4361-9899-a29cdc54c67f" class="xr-array-in" type="checkbox" checked=""><label for="section-ce5d7223-9692-4361-9899-a29cdc54c67f" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></div><div class="xr-array-data"><pre>array([[[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]]], shape=(1, 979, 1845), dtype=uint8)</pre></div></div></li><li class="xr-section-item"><input id="section-fc12a966-9fe1-405b-ad55-ef27a925d1f5" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-fc12a966-9fe1-405b-ad55-ef27a925d1f5" class="xr-section-summary">Coordinates: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-63.7 -63.7 -63.7 ... -63.24 -63.24</div><input id="attrs-7fda0b1c-0d75-482d-b1ad-e078649f5b77" class="xr-var-attrs-in" type="checkbox"><label for="attrs-7fda0b1c-0d75-482d-b1ad-e078649f5b77" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-cbb2de06-fc36-4e4b-af87-11c82f1f09ea" class="xr-var-data-in" type="checkbox"><label for="data-cbb2de06-fc36-4e4b-af87-11c82f1f09ea" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class="xr-var-data"><pre>array([-63.701875, -63.701625, -63.701375, ..., -63.241375, -63.241125,
       -63.240875], shape=(1845,))</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-31.45 -31.45 ... -31.7 -31.7</div><input id="attrs-495ead72-7f3e-4ea4-9794-5cd3fd55c353" class="xr-var-attrs-in" type="checkbox"><label for="attrs-495ead72-7f3e-4ea4-9794-5cd3fd55c353" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-6c680b34-6247-428f-b905-0a224cd1d9d3" class="xr-var-data-in" type="checkbox"><label for="data-6c680b34-6247-428f-b905-0a224cd1d9d3" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class="xr-var-data"><pre>array([-31.454375, -31.454625, -31.454875, ..., -31.698375, -31.698625,
       -31.698875], shape=(979,))</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">band</span></div><div class="xr-var-dims">(band)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1</div><input id="attrs-65aa0dd6-c137-4df1-9359-c9a801278d3b" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-65aa0dd6-c137-4df1-9359-c9a801278d3b" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-f847f4df-d7ab-4bf5-a04d-efd5bcab8155" class="xr-var-data-in" type="checkbox"><label for="data-f847f4df-d7ab-4bf5-a04d-efd5bcab8155" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>spatial_ref</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-9e9e1c2b-0e5e-486d-ae23-36615093be72" class="xr-var-attrs-in" type="checkbox"><label for="attrs-9e9e1c2b-0e5e-486d-ae23-36615093be72" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c3f30ce8-4348-46dd-a1f6-d3ce736c8b77" class="xr-var-data-in" type="checkbox"><label for="data-c3f30ce8-4348-46dd-a1f6-d3ce736c8b77" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AXIS["Latitude",NORTH],AXIS["Longitude",EAST],AUTHORITY["EPSG","4326"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984</dd><dt><span>grid_mapping_name :</span></dt><dd>latitude_longitude</dd><dt><span>spatial_ref :</span></dt><dd>GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AXIS["Latitude",NORTH],AXIS["Longitude",EAST],AUTHORITY["EPSG","4326"]]</dd><dt><span>GeoTransform :</span></dt><dd>-63.702 0.0002499999999999992 0.0 -31.454250000000002 0.0 -0.0002499999999999986</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-f8c719ac-bb4a-406c-b914-fcb7538bc592" class="xr-section-summary-in" type="checkbox"><label for="section-f8c719ac-bb4a-406c-b914-fcb7538bc592" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><input type="checkbox" disabled=""><label></label><input id="index-70ca40f3-445f-4748-a78e-6eb3e91446d0" class="xr-index-data-in" type="checkbox"><label for="index-70ca40f3-445f-4748-a78e-6eb3e91446d0" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([         -63.701875,          -63.701625,          -63.701375,
       -63.701125000000005,          -63.700875,          -63.700625,
                -63.700375,          -63.700125,          -63.699875,
       -63.699625000000005,
       ...
                -63.243125,          -63.242875, -63.242625000000004,
                -63.242375,          -63.242125,          -63.241875,
                -63.241625,          -63.241375, -63.241125000000004,
                -63.240875],
      dtype='float64', name='x', length=1845))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><input type="checkbox" disabled=""><label></label><input id="index-039a15b7-4802-4e00-a5b9-247fe224f015" class="xr-index-data-in" type="checkbox"><label for="index-039a15b7-4802-4e00-a5b9-247fe224f015" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([-31.454375000000002, -31.454625000000004,          -31.454875,
       -31.455125000000002, -31.455375000000004,          -31.455625,
       -31.455875000000002, -31.456125000000004,          -31.456375,
       -31.456625000000003,
       ...
                -31.696625, -31.696875000000002, -31.697125000000003,
                -31.697375, -31.697625000000002, -31.697875000000003,
                -31.698125, -31.698375000000002, -31.698625000000003,
                -31.698875],
      dtype='float64', name='y', length=979))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>band</div></div><div class="xr-index-preview">PandasIndex</div><input type="checkbox" disabled=""><label></label><input id="index-c2f9cf7c-6496-413f-b145-e4bf1e0faf4c" class="xr-index-data-in" type="checkbox"><label for="index-c2f9cf7c-6496-413f-b145-e4bf1e0faf4c" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1], dtype='int64', name='band'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-333ccaec-27ec-4b1b-8d7d-57e070545367" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-333ccaec-27ec-4b1b-8d7d-57e070545367" class="xr-section-summary">Attributes: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>LAYER_TYPE :</span></dt><dd>athematic</dd><dt><span>scale_factor :</span></dt><dd>1.0</dd><dt><span>add_offset :</span></dt><dd>0.0</dd><dt><span>long_name :</span></dt><dd>Layer_1</dd></dl></div></li></ul></div></div>
</div>
</div>
<div id="fa068652" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego.band.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array([1])</code></pre>
</div>
</div>
<div id="f3193c22" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>np.unique(perdida_a_fuego)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array([0, 1, 2, 3, 4], dtype=uint8)</code></pre>
</div>
</div>
<div id="aec435ca" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>perdida_a_fuego.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-125-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="villa-del-rosario_files/figure-html/cell-125-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="35063f8b" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the color map and labels based on the classification</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'white'</span>, <span class="st">'lightgray'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>, <span class="st">'darkred'</span>]</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No forest loss (0)'</span>,</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Forest loss - other drivers (1)'</span>, </span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fire loss - low certainty (2)'</span>,</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fire loss - medium certainty (3)'</span>,</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fire loss - high certainty (4)'</span>,</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fire loss - Africa (5)'</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom colormap</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> mcolors.ListedColormap(colors)</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> mcolors.BoundaryNorm(bounds, cmap.N)</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> perdida_a_fuego.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span>cmap, norm<span class="op">=</span>norm, add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add colorbar with custom labels</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>ax, ticks<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>])</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>cbar.set_ticklabels(labels)</span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Forest Loss Classification'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title</span></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Forest Loss Due to Fire vs Other Drivers</span><span class="ch">\n</span><span class="st">(Hansen et al. 2013, 2001-2024)'</span>)</span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-126-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="villa-del-rosario_files/figure-html/cell-126-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="db0b895f" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pixel counts for each category</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>unique_values, counts <span class="op">=</span> np.unique(perdida_a_fuego, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate areas (assuming 30m resolution from Hansen data)</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>pixel_area <span class="op">=</span> <span class="dv">30</span> <span class="op">*</span> <span class="dv">30</span>  <span class="co"># 30m x 30m = 900 mÂ²</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>areas_hectares <span class="op">=</span> counts <span class="op">*</span> pixel_area <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># Convert to hectares</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Group into fire vs non-fire categories (ONLY actual forest loss)</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>fire_categories <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]  <span class="co"># Low, medium, high certainty fire, Africa fire</span></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>non_fire_categories <span class="op">=</span> [<span class="dv">1</span>]       <span class="co"># Other drivers (excluding no loss = 0)</span></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>fire_area <span class="op">=</span> <span class="bu">sum</span>(areas_hectares[i] <span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(unique_values) <span class="cf">if</span> val <span class="kw">in</span> fire_categories)</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>non_fire_area <span class="op">=</span> <span class="bu">sum</span>(areas_hectares[i] <span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(unique_values) <span class="cf">if</span> val <span class="kw">in</span> non_fire_categories)</span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create labels in Spanish</span></span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>category_labels <span class="op">=</span> [<span class="st">'PÃ©rdida por fuego'</span>, <span class="st">'Otras causas'</span>]</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>areas <span class="op">=</span> [fire_area, non_fire_area]</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#d4271e'</span>, <span class="st">'#808080'</span>]  <span class="co"># Red for fire, gray for other</span></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar plot</span></span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.bar(category_labels, areas, color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels on top of bars</span></span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar, area <span class="kw">in</span> <span class="bu">zip</span>(bars, areas):</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> bar.get_height()</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>    ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="bu">max</span>(areas)<span class="op">*</span><span class="fl">0.01</span>,</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'</span><span class="sc">{</span>area<span class="sc">:.0f}</span><span class="ss"> ha'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Ãrea (hectÃ¡reas)'</span>)</span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'PÃ©rdida de Bosque, 2001-2024'</span>)</span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-38"><a href="#cb159-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb159-39"><a href="#cb159-39" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/mapas/forest_loss_fire_vs_other.svg'</span>, </span>
<span id="cb159-40"><a href="#cb159-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'svg'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb159-41"><a href="#cb159-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-42"><a href="#cb159-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb159-43"><a href="#cb159-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-44"><a href="#cb159-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary statistics</span></span>
<span id="cb159-45"><a href="#cb159-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Resumen de PÃ©rdida de Bosque:"</span>)</span>
<span id="cb159-46"><a href="#cb159-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">35</span>)</span>
<span id="cb159-47"><a href="#cb159-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'PÃ©rdida por fuego'</span><span class="sc">:25}</span><span class="ss">: </span><span class="sc">{</span>fire_area<span class="sc">:8.0f}</span><span class="ss"> ha"</span>)</span>
<span id="cb159-48"><a href="#cb159-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Otras causas'</span><span class="sc">:25}</span><span class="ss">: </span><span class="sc">{</span>non_fire_area<span class="sc">:8.0f}</span><span class="ss"> ha"</span>)</span>
<span id="cb159-49"><a href="#cb159-49" aria-hidden="true" tabindex="-1"></a>total_loss <span class="op">=</span> fire_area <span class="op">+</span> non_fire_area</span>
<span id="cb159-50"><a href="#cb159-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Total pÃ©rdida'</span><span class="sc">:25}</span><span class="ss">: </span><span class="sc">{</span>total_loss<span class="sc">:8.0f}</span><span class="ss"> ha"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-127-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="villa-del-rosario_files/figure-html/cell-127-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Resumen de PÃ©rdida de Bosque:
===================================
PÃ©rdida por fuego        :       13 ha
Otras causas             :      867 ha
Total pÃ©rdida            :      880 ha</code></pre>
</div>
</div>
<div id="a14eca8f" class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div id="087b42bf" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate urban area (Ãrea sin vegetaciÃ³n) for both years</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>urban_2000 <span class="op">=</span> np.<span class="bu">sum</span>(suelo_2000_cat <span class="op">==</span> <span class="st">'Ãrea sin vegetaciÃ³n'</span>) <span class="op">*</span> pixel_area_hectares</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>urban_2022 <span class="op">=</span> np.<span class="bu">sum</span>(suelo_2022_cat <span class="op">==</span> <span class="st">'Ãrea sin vegetaciÃ³n'</span>) <span class="op">*</span> pixel_area_hectares</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate change</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>urban_change <span class="op">=</span> urban_2022 <span class="op">-</span> urban_2000</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>percent_change <span class="op">=</span> (urban_change <span class="op">/</span> urban_2000) <span class="op">*</span> <span class="dv">100</span> <span class="cf">if</span> urban_2000 <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar chart</span></span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="st">'2000'</span>, <span class="st">'2022'</span>]</span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>urban_areas <span class="op">=</span> [urban_2000, urban_2022]</span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#d4271e'</span>, <span class="st">'#d4271e'</span>]  <span class="co"># Same color for both bars</span></span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.bar(years, urban_areas, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels on top of bars</span></span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar, area <span class="kw">in</span> <span class="bu">zip</span>(bars, urban_areas):</span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> bar.get_height()</span>
<span id="cb163-24"><a href="#cb163-24" aria-hidden="true" tabindex="-1"></a>    ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="bu">max</span>(urban_areas)<span class="op">*</span><span class="fl">0.01</span>,</span>
<span id="cb163-25"><a href="#cb163-25" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'</span><span class="sc">{</span>area<span class="sc">:,.1f}</span><span class="ss"> ha'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb163-26"><a href="#cb163-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-27"><a href="#cb163-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add change annotation</span></span>
<span id="cb163-28"><a href="#cb163-28" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="ss">f'Change: </span><span class="sc">{</span>urban_change<span class="sc">:+,.1f}</span><span class="ss"> ha</span><span class="ch">\n</span><span class="ss">(</span><span class="sc">{</span>percent_change<span class="sc">:+.1f}</span><span class="ss">%)'</span>, </span>
<span id="cb163-29"><a href="#cb163-29" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(<span class="fl">0.5</span>, <span class="bu">max</span>(urban_areas)<span class="op">*</span><span class="fl">0.7</span>), xytext<span class="op">=</span>(<span class="fl">0.5</span>, <span class="bu">max</span>(urban_areas)<span class="op">*</span><span class="fl">0.9</span>),</span>
<span id="cb163-30"><a href="#cb163-30" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb163-31"><a href="#cb163-31" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round,pad=0.3'</span>, facecolor<span class="op">=</span><span class="st">'lightgray'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>),</span>
<span id="cb163-32"><a href="#cb163-32" aria-hidden="true" tabindex="-1"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-&gt;'</span>, connectionstyle<span class="op">=</span><span class="st">'arc3,rad=0'</span>))</span>
<span id="cb163-33"><a href="#cb163-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-34"><a href="#cb163-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb163-35"><a href="#cb163-35" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Urban Area (hectares)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb163-36"><a href="#cb163-36" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Urban Area Change in AOI</span><span class="ch">\n</span><span class="st">(2000 vs 2022)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb163-37"><a href="#cb163-37" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb163-38"><a href="#cb163-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-39"><a href="#cb163-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Format y-axis to show thousands separator</span></span>
<span id="cb163-40"><a href="#cb163-40" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(plt.FuncFormatter(<span class="kw">lambda</span> x, p: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span>))</span>
<span id="cb163-41"><a href="#cb163-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-42"><a href="#cb163-42" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb163-43"><a href="#cb163-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-44"><a href="#cb163-44" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'/home/nissim/Documents/dev/fulbright/ciut-riesgo/data/villa_del_rosario/mapas/urban_expansion.svg'</span>, </span>
<span id="cb163-45"><a href="#cb163-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'svg'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb163-46"><a href="#cb163-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-47"><a href="#cb163-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb163-48"><a href="#cb163-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-49"><a href="#cb163-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb163-50"><a href="#cb163-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"URBAN AREA CHANGE SUMMARY"</span>)</span>
<span id="cb163-51"><a href="#cb163-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb163-52"><a href="#cb163-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"2000: </span><span class="sc">{</span>urban_2000<span class="sc">:,.1f}</span><span class="ss"> ha"</span>)</span>
<span id="cb163-53"><a href="#cb163-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"2022: </span><span class="sc">{</span>urban_2022<span class="sc">:,.1f}</span><span class="ss"> ha"</span>)</span>
<span id="cb163-54"><a href="#cb163-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Change: </span><span class="sc">{</span>urban_change<span class="sc">:+,.1f}</span><span class="ss"> ha (</span><span class="sc">{</span>percent_change<span class="sc">:+.1f}</span><span class="ss">%)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="villa-del-rosario_files/figure-html/cell-129-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="villa-del-rosario_files/figure-html/cell-129-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>URBAN AREA CHANGE SUMMARY
==============================
2000: 452.9 ha
2022: 865.5 ha
Change: +412.6 ha (+91.1%)</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nlebovits\.github\.io\/datos-escala-humana\/en\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../en/cookbooks/la-plata.html" class="pagination-link" aria-label="La Plata">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">La Plata</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../en/conclusion.html" class="pagination-link" aria-label="Conclusion">
        <span class="nav-page-text">Conclusion</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Â© <a href="https://nlebovits.github.io">Nissim Lebovits</a>, 2025</p>
</div>   
    <div class="nav-footer-center">
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></p>
</div>
    <div class="nav-footer-right">
<p>This page is built with â¤ï¸ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","openEffect":"zoom","loop":false,"descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>